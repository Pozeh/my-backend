<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoLoop Kenya - Modern E-Commerce Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- MongoDB Integration -->
    <script src="assets/js/mongodb-integration.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary-color: #6366f1;
            --accent-color: #8b5cf6;
            --light-bg: #f8fafc;
            --dark-bg: #1e293b;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Styles */
        .top-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            color: var(--white);
            padding: 12px 0;
            font-size: 0.875rem;
            box-shadow: var(--shadow-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .top-header .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .top-header .contact-info {
            display: flex;
            gap: 20px;
        }

        .top-header .user-actions {
            display: flex;
            gap: 15px;
        }

        .top-header a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }

        .top-header a:hover {
            color: var(--vibrant-yellow);
        }

        /* Main Header */
        .main-header {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        .logo:hover {
            color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .logo i {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-bar {
            flex: 1;
            display: flex;
            max-width: 600px;
            position: relative;
        }

        .search-bar input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
            font-size: 1rem;
            background: var(--light-bg);
            transition: all 0.3s ease;
            outline: none;
        }

        .search-bar input:focus {
            border-color: var(--primary-color);
            background: var(--card-bg);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-bar button {
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--white);
            border: none;
            border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .search-bar button:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .header-actions {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .header-action {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            position: relative;
            padding: 8px 12px;
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .header-action:hover {
            color: var(--primary-color);
            background: rgba(37, 99, 235, 0.1);
            transform: translateY(-2px);
        }

        .header-action i {
            font-size: 1.25rem;
            margin-right: 8px;
            color: var(--primary-color);
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--card-bg);
        }

        /* Account Dropdown Styles */
        .user-info {
            position: relative;
        }

        .header-action.user-account {
            cursor: pointer;
            transition: all 0.3s;
        }

        .header-action.user-account:hover {
            background: var(--primary-light);
            color: white;
        }

        .account-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            padding: 0;
            min-width: 320px;
            max-width: 380px;
            display: none;
            z-index: 1000;
            overflow: hidden;
            margin-top: 10px;
        }

        .account-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .account-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 24px;
            text-align: center;
        }

        .account-avatar-large {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 28px;
            margin: 0 auto 12px;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: var(--shadow-md);
        }

        .account-name-large {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .account-email {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .account-type-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .account-details {
            padding: 24px;
        }

        .account-section {
            margin-bottom: 24px;
        }

        .account-section:last-child {
            margin-bottom: 0;
        }

        .account-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-section-title i {
            font-size: 14px;
        }

        .account-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .account-info-item:last-child {
            border-bottom: none;
        }

        .account-info-label {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-info-label i {
            font-size: 12px;
            opacity: 0.6;
        }

        .account-info-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            text-align: right;
        }

        .account-actions {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--light-bg);
        }

        .account-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .account-button:last-child {
            margin-bottom: 0;
        }

        .account-button.primary {
            background: var(--primary-color);
            color: white;
        }

        .account-button.primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .account-button.secondary {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .account-button.secondary:hover {
            background: var(--light-bg);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .account-button.danger {
            background: var(--danger-color);
            color: white;
        }

        .account-button.danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .shopping-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .stat-card {
            background: var(--light-bg);
            padding: 12px;
            border-radius: var(--radius-md);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Cart and Wishlist Items */
        .cart-item, .wishlist-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }

        .cart-item:last-child, .wishlist-item:last-child {
            border-bottom: none;
        }

        .cart-item-details, .wishlist-item-details {
            flex: 1;
        }

        .cart-item-details h4, .wishlist-item-details h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: var(--text-primary);
        }

        .cart-item-details p, .wishlist-item-details p {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .quantity-controls, .wishlist-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-controls button {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-controls button:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
        }

        .quantity-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quantity-controls span {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
        }

        .wishlist-item-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .wishlist-item-actions .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .wishlist-item-actions .btn-primary:hover {
            background: var(--primary-dark);
        }

        .wishlist-item-actions .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .wishlist-item-actions .btn-danger:hover {
            background: #dc2626;
        }

        .cart-summary {
            padding: 20px;
            border-top: 2px solid var(--border-color);
            background: var(--light-bg);
        }

        .cart-total {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: right;
        }

        .cart-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .cart-actions .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .cart-actions .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .cart-actions .btn-primary:hover {
            background: var(--primary-dark);
        }

        .cart-actions .btn-secondary {
            background: var(--text-muted);
            color: white;
        }

        .cart-actions .btn-secondary:hover {
            background: var(--text-secondary);
        }

        /* Wishlist Button States */
        .add-to-wishlist {
            background: var(--light-bg);
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .add-to-wishlist:hover {
            background: #fef2f2;
            color: #ef4444;
            border-color: #ef4444;
            transform: scale(1.05);
        }

        .add-to-wishlist.in-wishlist {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .add-to-wishlist.in-wishlist:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .add-to-wishlist i {
            transition: transform 0.3s ease;
        }

        .add-to-wishlist:hover i {
            transform: scale(1.2);
        }

        .add-to-wishlist.in-wishlist i {
            animation: heartBeat 0.6s ease;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1); }
            75% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Wishlist Badge Animation */
        .wishlist-badge-update {
            animation: badgePulse 0.6s ease;
        }

        @keyframes badgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Navigation */
        .main-nav {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-list {
            display: flex;
            list-style: none;
            gap: 0;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            display: block;
            padding: 16px 24px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
        }

        .nav-link:hover {
            color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 80%;
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, #4a148c 0%, #1565c0 50%, #0d47a1 100%);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            min-height: 50vh;
            display: flex;
            align-items: center;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(30, 144, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(123, 31, 162, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 191, 255, 0.2) 0%, transparent 50%);
            animation: floatingOrbs 20s ease-in-out infinite;
        }

        .hero-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%),
                linear-gradient(-45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes floatingOrbs {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -30px) rotate(90deg); }
            50% { transform: translate(-10px, 20px) rotate(180deg); }
            75% { transform: translate(-20px, -10px) rotate(270deg); }
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; transform: translateX(-100%); }
            50% { opacity: 0.6; transform: translateX(100%); }
        }

        .hero-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            text-align: center;
            position: relative;
            z-index: 2;
            backdrop-filter: blur(2px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .hero-title {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-weight: 800;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(138, 43, 226, 0.5);
            animation: fadeInUp 0.8s ease;
            background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .hero-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            border-radius: 2px;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.95;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            animation: fadeInUp 0.8s ease 0.2s both;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            color: rgba(255, 255, 255, 0.9);
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            animation: fadeInUp 0.8s ease 0.4s both;
            flex-wrap: wrap;
        }

        .hero-buttons .btn {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 14px 32px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .hero-buttons .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .hero-buttons .btn:hover::before {
            left: 100%;
        }

        .hero-buttons .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .hero-buttons .btn-primary {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.8), rgba(30, 144, 255, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .hero-buttons .btn-primary:hover {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.9), rgba(30, 144, 255, 0.9));
        }

        .hero-buttons .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .hero-buttons .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Responsive Hero Section */
        @media (max-width: 768px) {
            .hero-section {
                padding: 40px 0;
                min-height: 40vh;
            }

            .hero-content {
                padding: 30px 20px;
                margin: 0 10px;
            }

            .hero-title {
                font-size: 2.2rem;
                margin-bottom: 15px;
            }

            .hero-title::after {
                width: 80px;
                bottom: -8px;
            }

            .hero-subtitle {
                font-size: 1.1rem;
                margin-bottom: 30px;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .hero-buttons .btn {
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 1.8rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .hero-content {
                padding: 25px 15px;
            }
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-md);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--light-bg);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* Products Section */
        .products-section {
            padding: 60px 0;
            background: var(--card-bg);
        }

        .section-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .section-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Categories */
        .categories-section {
            max-width: 1400px;
            margin: 60px auto 80px;
            padding: 0 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .categories-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .categories-header .section-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            position: relative;
            display: inline-block;
        }

        .categories-header .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-top: 16px;
            font-weight: 400;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .category-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .category-card:hover::before {
            transform: scaleX(1);
        }

        .category-icon {
            font-size: 2.2rem;
            margin-bottom: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 16px;
            color: white;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .category-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .category-icon::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color), var(--primary-color));
            border-radius: 18px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .category-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            transition: color 0.3s ease;
        }

        .category-card:hover .category-name {
            color: var(--primary-color);
        }

        .category-count {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .category-card:hover .category-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
        }

        .category-card:hover .category-icon::before {
            opacity: 1;
        }

        .category-card:hover .category-icon::after {
            opacity: 0.7;
        }

        /* Category-specific color themes */
        .category-card[data-category="Electronics"] .category-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .category-card[data-category="Fashion"] .category-icon {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }

        .category-card[data-category="Gaming"] .category-icon {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .category-card[data-category="Home & Kitchen"] .category-icon {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
        }

        .category-card[data-category="Sports"] .category-icon {
            background: linear-gradient(135deg, #fa709a, #fee140);
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.3);
        }

        .category-card[data-category="Books"] .category-icon {
            background: linear-gradient(135deg, #30cfd0, #330867);
            box-shadow: 0 4px 15px rgba(48, 207, 208, 0.3);
        }

        /* Enhanced category icon animations */
        .category-icon {
            animation: iconFloat 3s ease-in-out infinite;
        }

        .category-card[data-category="Electronics"] .category-icon {
            animation-delay: 0s;
        }

        .category-card[data-category="Fashion"] .category-icon {
            animation-delay: 0.5s;
        }

        .category-card[data-category="Gaming"] .category-icon {
            animation-delay: 1s;
        }

        .category-card[data-category="Home & Kitchen"] .category-icon {
            animation-delay: 1.5s;
        }

        .category-card[data-category="Sports"] .category-icon {
            animation-delay: 2s;
        }

        .category-card[data-category="Books"] .category-icon {
            animation-delay: 2.5s;
        }

        @keyframes iconFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-3px);
            }
        }

        /* Icon pulse on hover */
        .category-card:hover .category-icon {
            animation: iconPulse 0.6s ease-in-out;
        }

        @keyframes iconPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.15);
            }
            100% {
                transform: scale(1.1);
            }
        }

        /* Enhanced category card glow effect */
        .category-card:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(37, 99, 235, 0.1);
        }

        .category-card[data-category="Electronics"]:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(102, 126, 234, 0.2);
        }

        .category-card[data-category="Fashion"]:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(240, 147, 251, 0.2);
        }

        .category-card[data-category="Gaming"]:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(79, 172, 254, 0.2);
        }

        .category-card[data-category="Home & Kitchen"]:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(67, 233, 123, 0.2);
        }

        .category-card[data-category="Sports"]:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(250, 112, 154, 0.2);
        }

        .category-card[data-category="Books"]:hover {
            box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 0 20px rgba(48, 207, 208, 0.2);
        }

        /* Professional hover effects */
        .category-card:active {
            transform: translateY(-2px);
        }

        /* Responsive design for categories */
        @media (max-width: 768px) {
            .categories-section {
                margin: 40px auto 60px;
                padding: 30px 20px;
            }

            .categories-header .section-title {
                font-size: 1.8rem;
            }

            .section-subtitle {
                font-size: 1rem;
            }

            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 16px;
            }

            .category-card {
                padding: 20px 16px;
            }

            .category-icon {
                font-size: 1.5rem;
                width: 50px;
                height: 50px;
            }
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 32px;
            margin-top: 40px;
        }

        .product-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .product-image {
            width: 100%;
            height: 240px;
            object-fit: cover;
            background: var(--light-bg);
        }

        .product-info {
            padding: 24px;
        }

        .product-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 16px;
        }

        .product-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .product-actions {
            display: flex;
            gap: 12px;
        }

        .btn-add-cart {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add-cart:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
        }

        .product-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--danger-color);
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        /* Modal Styles - Consolidated */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-xl);
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        /* Professional Login Modal Styles */
        .login-modal {
            max-width: 450px;
            padding: 0;
            overflow: hidden;
        }

        .login-modal .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
        }

        .login-modal .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
        }

        .login-modal .modal-close:hover {
            color: white;
        }

        .modal-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .modal-logo i {
            font-size: 2.5rem;
            color: white;
        }

        .modal-logo h2 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .modal-logo p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.95rem;
        }

        /* Login Type Selector */
        .login-type-selector {
            padding: 20px 40px 0;
        }

        .selector-tabs {
            display: flex;
            background: var(--background-light);
            border-radius: var(--radius-lg);
            padding: 4px;
            gap: 4px;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
        }

        .tab-btn i {
            font-size: 1rem;
        }

        .tab-btn span {
            font-size: 0.9rem;
        }

        /* Login Form Styles */
        .login-modal .modal-content form {
            padding: 30px 40px 40px;
        }

        .login-modal .form-group {
            margin-bottom: 20px;
        }

        .login-modal label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .login-modal label i {
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .login-modal input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--background-light);
        }

        .login-modal input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .password-input-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        .input-error {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .input-error.show {
            display: block;
        }

        /* Form Options */
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .checkbox-wrapper input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkbox-wrapper input[type="checkbox"]:checked + .checkmark {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .checkbox-wrapper input[type="checkbox"]:checked + .checkmark::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .forgot-password {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .forgot-password:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* Login Button */
        .login-btn {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .spinner {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .login-btn.loading .spinner {
            display: block;
        }

        .login-btn.loading #loginBtnText {
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Login Divider */
        .login-divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .login-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-color);
        }

        .login-divider span {
            background: var(--card-bg);
            padding: 0 15px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            position: relative;
        }

        /* Social Login */
        .social-login {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            border: 2px solid var(--border-color);
            background: white;
            color: var(--text-primary);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .google-btn:hover {
            border-color: #4285f4;
            color: #4285f4;
        }

        .facebook-btn:hover {
            border-color: #1877f2;
            color: #1877f2;
        }

        .social-btn i {
            font-size: 1.1rem;
        }

        /* Form Footer */
        .form-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .form-footer p {
            margin: 8px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .form-footer a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .modal-header {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-home {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .modal-home:hover {
            color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--light-bg);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--card-bg);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .user-type-toggle {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .user-type-toggle button {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-type-toggle button.btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-color: var(--primary-color);
        }

        .form-footer {
            margin-top: 24px;
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        /* Professional Toast Notifications - Top Right Position */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98));
            color: #1f2937;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25), 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-200px) scale(0.9);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 99999;
            font-weight: 600;
            font-size: 14px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.3);
            max-width: 380px;
            min-width: 250px;
            display: flex;
            align-items: center;
            opacity: 0;
            pointer-events: auto;
        }

        .toast.show {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .toast.hide {
            transform: translateY(-200px) scale(0.9);
            opacity: 0;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }

        .toast-message {
            flex: 1;
            line-height: 1.4;
            font-weight: 500;
        }

        /* Toast type variations - Enhanced visibility */
        .toast.success {
            background: linear-gradient(135deg, rgba(34,197,94,0.98), rgba(16,185,129,0.98));
            color: white;
            border: 2px solid rgba(34,197,94,0.4);
            box-shadow: 0 8px 32px rgba(34,197,94,0.3), 0 4px 16px rgba(0,0,0,0.15);
        }

        .toast.success .toast-icon {
            color: #f0fdf4;
        }

        .toast.error {
            background: linear-gradient(135deg, rgba(239,68,68,0.98), rgba(220,38,38,0.98));
            color: white;
            border: 2px solid rgba(239,68,68,0.4);
            box-shadow: 0 8px 32px rgba(239,68,68,0.3), 0 4px 16px rgba(0,0,0,0.15);
        }

        .toast.error .toast-icon {
            color: #fef2f2;
        }

        .toast.warning {
            background: linear-gradient(135deg, rgba(245,158,11,0.98), rgba(217,119,6,0.98));
            color: white;
            border: 2px solid rgba(245,158,11,0.4);
            box-shadow: 0 8px 32px rgba(245,158,11,0.3), 0 4px 16px rgba(0,0,0,0.15);
        }

        .toast.warning .toast-icon {
            color: #fffbeb;
        }

        .toast.info {
            background: linear-gradient(135deg, rgba(59,130,246,0.98), rgba(37,99,235,0.98));
            color: white;
            border: 2px solid rgba(59,130,246,0.4);
            box-shadow: 0 8px 32px rgba(59,130,246,0.3), 0 4px 16px rgba(0,0,0,0.15);
        }

        .toast.info .toast-icon {
            color: #eff6ff;
        }

        .toast.cart {
            background: linear-gradient(135deg, rgba(255,107,53,0.98), rgba(247,147,30,0.98));
            color: white;
            border: 2px solid rgba(255,107,53,0.4);
            box-shadow: 0 8px 32px rgba(255,107,53,0.3), 0 4px 16px rgba(0,0,0,0.15);
        }

        .toast.cart .toast-icon {
            color: #fff7ed;
        }

        .toast.wishlist {
            background: linear-gradient(135deg, rgba(236,72,153,0.98), rgba(244,63,94,0.98));
            color: white;
            border: 2px solid rgba(236,72,153,0.4);
            box-shadow: 0 8px 32px rgba(236,72,153,0.3), 0 4px 16px rgba(0,0,0,0.15);
        }

        .toast.wishlist .toast-icon {
            color: #fdf2f8;
        }

        /* Ensure notifications appear above all modals and overlays */
        .toast {
            z-index: 10002;
        }

        /* Responsive adjustments for top positioning */
        @media (max-width: 768px) {
            .toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                min-width: auto;
                padding: 14px 20px;
            }
            
            .toast-icon {
                font-size: 18px;
                width: 20px;
            }
            
            .toast-message {
                font-size: 13px;
            }
        }

        /* Ensure visibility during scroll */
        .toast.sticky {
            position: fixed;
            top: 10px !important;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .search-bar {
                max-width: 100%;
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 16px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 24px;
            }

            .modal-content {
                padding: 30px 20px;
                margin: 20px;
            }
        }

        /* Products */
        .products-section {
            max-width: 1200px;
            margin: 0 auto 40px;
            padding: 0 15px;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
        }

        .filter-tab {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--dark-color);
        }

        .filter-tab.active,
        .filter-tab:hover {
            background: var(--vibrant-yellow);
            color: var(--kenyan-black);
            border-color: var(--vibrant-yellow);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            justify-items: center;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e5e5;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            width: 220px;
            height: 300px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin: 0;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #ff6b35;
        }

        .product-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .product-image-container {
            position: relative;
            width: 100%;
            height: 220px;
            overflow: hidden;
            background: #fafafa;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-info {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            justify-content: space-between;
        }

        .product-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: #222;
            line-height: 1.3;
            min-height: 2.6em;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            word-wrap: break-word;
        }

        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .product-actions button {
            flex: 1;
            padding: 10px 4px;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-weight: 500;
        }

        .btn-add-cart {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
        }

        .btn-add-cart:hover {
            background: linear-gradient(135deg, #e55a2b, #e67e17);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .btn-wishlist {
            background: #fff;
            color: #ff6b35;
            border: 1px solid #ff6b35;
        }

        .btn-wishlist:hover {
            background: #ff6b35;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .btn-wishlist.in-wishlist {
            background: #ff6b35;
            color: white;
            border-color: #ff6b35;
        }

        .btn-wishlist.in-wishlist:hover {
            background: #e55a2b;
            border-color: #e55a2b;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 8px;
        }

        .stars {
            color: #ffc107;
            font-size: 0.85rem;
        }

        .rating-count {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .current-price {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--bright-orange);
        }

        .original-price {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .discount-percent {
            font-size: 0.8rem;
            color: var(--mint-green);
            font-weight: 600;
        }

        .product-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: space-between;
        }

        .btn-message {
            width: 36px;
            height: 36px;
            background: var(--card-bg);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .btn-message:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .btn-add-cart {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 13px;
            min-height: 36px;
        }

        .btn-add-cart:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-add-cart:active {
            transform: translateY(0);
        }

        .btn-add-cart.added {
            background: linear-gradient(135deg, var(--success-color), #16a34a);
        }

        .btn-wishlist {
            width: 36px;
            height: 36px;
            background: var(--card-bg);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .btn-wishlist:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-color: var(--danger-color);
            transform: translateY(-2px);
        }

        .btn-wishlist.in-wishlist {
            background: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }

        .btn-wishlist.in-wishlist:hover {
            background: #dc2626;
            border-color: #dc2626;
        }

        /* Wishlist Modal Styles */
        .wishlist-items {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .wishlist-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--card-bg);
            transition: all 0.3s ease;
        }

        .wishlist-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .wishlist-item-details {
            flex: 1;
        }

        .wishlist-item-details h4 {
            margin: 0 0 5px 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .wishlist-item-price {
            text-align: right;
            display: flex;
            align-items: center;
            color: var(--primary-color);
            font-weight: bold;
        }

        .wishlist-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .wishlist-item-actions .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .wishlist-item-actions .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .wishlist-item-actions .btn-primary:hover {
            background: var(--primary-dark);
        }

        .wishlist-item-actions .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .wishlist-item-actions .btn-danger:hover {
            background: #dc2626;
        }

        .wishlist-summary {
            border-top: 2px solid var(--border-color);
            padding-top: 20px;
            margin-top: 20px;
        }

        .wishlist-actions {
            display: flex;
            gap: 10px;
        }

        .wishlist-actions .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .wishlist-actions .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .wishlist-actions .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
        }

        .wishlist-actions .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
        }

        .wishlist-actions .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, var(--danger-color));
            transform: translateY(-2px);
        }

        /* Cart Modal Styles */
        .cart-items {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--card-bg);
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-details h4 {
            margin: 0 0 5px 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .cart-item-total {
            text-align: right;
            display: flex;
            align-items: center;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-quantity {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-quantity:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-quantity:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quantity-display {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            color: var(--text-primary);
        }

        .btn-remove {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .btn-remove:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .cart-summary {
            border-top: 2px solid var(--border-color);
            padding-top: 20px;
            margin-top: 20px;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .cart-actions {
            display: flex;
            gap: 10px;
        }

        .cart-actions .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-checkout {
            background: linear-gradient(135deg, var(--success-color), #16a34a);
            color: white;
        }

        .btn-checkout:hover {
            background: linear-gradient(135deg, #16a34a, var(--success-color));
            transform: translateY(-2px);
        }

        .btn-clear-cart {
            background: var(--card-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-clear-cart:hover {
            background: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }

        .add-to-wishlist {
            padding: 10px;
            background: var(--vibrant-yellow);
            color: var(--kenyan-black);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .add-to-wishlist:hover {
            background: #fbbf24;
        }

        .message-seller {
            padding: 10px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }

        .message-seller:hover {
            background: var(--primary-dark);
        }

        /* Message Seller Modal Styles */
        .seller-info {
            padding: 10px;
            background: var(--light-bg);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .seller-info strong {
            display: block;
            color: var(--dark-color);
        }

        .seller-info span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Chat Modal Styles */
        .chat-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background: var(--light-bg);
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
            min-height: 300px;
        }

        .chat-message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .chat-message.sent {
            align-items: flex-end;
        }

        .chat-message.received {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            word-wrap: break-word;
        }

        .chat-message.sent .message-bubble {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .chat-message.received .message-bubble {
            background: white;
            color: var(--dark-color);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 5px;
            padding: 0 5px;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input textarea {
            flex: 1;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            resize: none;
            max-height: 80px;
        }

        .chat-input button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
        }

        .chat-input button:hover {
            background: var(--primary-dark);
        }

        /* Login Modal - Styles moved to main modal section */

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--bright-orange);
        }

        /* Enhanced Form Styles for Product Submission */
        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-subtitle {
            color: var(--text-muted);
            margin-top: 10px;
            font-size: 0.95rem;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 107, 53, 0.02);
            border-radius: 8px;
            border: 1px solid rgba(255, 107, 53, 0.1);
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--bright-orange);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-item label {
            font-weight: 600;
            color: var(--dark-color);
        }

        .info-item span {
            color: var(--text-muted);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .modal-content {
                margin: 20px;
                max-width: calc(100% - 40px) !important;
            }
        }

        .guide-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .guide-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .guide-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .guide-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .guide-section li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .guide-section li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: var(--bright-orange);
            font-weight: bold;
        }

        /* Image Upload Styles */
        .image-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            background: var(--light-bg);
        }

        .image-upload-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .image-upload-box {
            border: 2px dashed var(--primary-color);
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .image-upload-box:hover,
        .image-upload-box.drag-over {
            border-color: var(--bright-orange);
            background: rgba(255, 107, 53, 0.05);
        }

        .upload-placeholder {
            color: var(--text-muted);
        }

        .upload-placeholder i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: block;
        }

        .upload-placeholder p {
            margin: 10px 0 5px 0;
            font-weight: 600;
            color: var(--dark-color);
        }

        .upload-placeholder small {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-preview {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: white;
        }

        .image-preview img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--danger-color);
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .remove-image:hover {
            background: var(--danger-color);
            color: white;
            transform: scale(1.1);
        }

        .image-url-option {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            margin-top: 15px;
        }

        .image-url-option .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .form-footer {
            text-align: center;
            margin-top: 20px;
        }

        .form-footer a {
            color: var(--bright-orange);
            text-decoration: none;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        /* Footer */
        .footer {
            background: var(--deep-purple);
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-section h3 {
            margin-bottom: 20px;
            color: var(--vibrant-yellow);
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: var(--vibrant-yellow);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid #444;
            color: #ccc;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .top-header .contact-info {
                display: none;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .search-bar {
                max-width: 100%;
            }

            .hero-title {
                font-size: 1.8rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .products-header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }

            .filter-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--bright-orange);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Cart Modal Styles */
        .cart-items {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            align-items: center;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-details h4 {
            margin: 0 0 5px 0;
            font-size: 0.9rem;
            color: var(--kenyan-black);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .quantity-controls button {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .quantity-controls button:hover:not(:disabled) {
            background: var(--vibrant-yellow);
            border-color: var(--vibrant-yellow);
        }

        .quantity-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quantity-controls span {
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }

        .cart-summary {
            border-top: 2px solid var(--border-color);
            padding-top: 20px;
            margin-top: 20px;
        }

        .cart-total {
            font-size: 1.2rem;
            color: var(--bright-orange);
            text-align: right;
            margin-bottom: 15px;
        }

        .cart-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger-color);
        }

        .toast.warning {
            background: var(--secondary-color);
        }

        /* Sell Your Products Dashboard */
        .sell-dashboard {
            background: linear-gradient(135deg, #4a148c 0%, #1565c0 50%, #0d47a1 100%);
            padding: 30px 0;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .sell-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 25% 40%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 75% 30%, rgba(30, 144, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 35% 85%, rgba(123, 31, 162, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 65% 75%, rgba(0, 191, 255, 0.2) 0%, transparent 50%);
            animation: floatingOrbs 20s ease-in-out infinite;
        }

        .sell-dashboard::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%),
                linear-gradient(-45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        .sell-dashboard-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 2;
        }

        .sell-dashboard-header {
            text-align: center;
            margin-bottom: 25px;
            backdrop-filter: blur(2px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .sell-dashboard-title {
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(138, 43, 226, 0.5);
            background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .sell-dashboard-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            border-radius: 2px;
        }

        .sell-dashboard-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            margin-bottom: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .sell-dashboard-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            backdrop-filter: blur(2px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .sell-dashboard-btn {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .sell-dashboard-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .sell-dashboard-btn:hover::before {
            left: 100%;
        }

        .sell-dashboard-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .sell-dashboard-btn-primary {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.8), rgba(30, 144, 255, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .sell-dashboard-btn-primary:hover {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.9), rgba(30, 144, 255, 0.9));
        }

        .sell-dashboard-btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .sell-dashboard-btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .sell-dashboard-btn-secondary:hover::before {
            left: 100%;
        }

        .sell-dashboard-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .sell-dashboard-btn-outline {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .sell-dashboard-btn-outline::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .sell-dashboard-btn-outline:hover::before {
            left: 100%;
        }

        .sell-dashboard-btn-outline:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .sell-dashboard-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            backdrop-filter: blur(2px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .mini-stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 100px;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .mini-stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .mini-stat-label {
            display: block;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsive Sell Dashboard */
        @media (max-width: 768px) {
            .sell-dashboard {
                padding: 20px 0;
                margin: 20px 0;
            }

            .sell-dashboard-header {
                padding: 20px;
                margin-bottom: 20px;
            }

            .sell-dashboard-title {
                font-size: 1.5rem;
            }

            .sell-dashboard-title::after {
                width: 60px;
                bottom: -6px;
            }

            .sell-dashboard-subtitle {
                font-size: 0.9rem;
            }

            .sell-dashboard-actions {
                padding: 15px;
                margin-bottom: 20px;
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            .sell-dashboard-btn,
            .sell-dashboard-btn-secondary,
            .sell-dashboard-btn-outline {
                width: 100%;
                max-width: 250px;
                justify-content: center;
            }

            .sell-dashboard-stats {
                padding: 15px;
                gap: 15px;
            }

            .mini-stat {
                padding: 12px 20px;
                min-width: 80px;
            }

            .mini-stat-number {
                font-size: 1.3rem;
            }

            .mini-stat-label {
                font-size: 0.7rem;
            }
        }

        @media (max-width: 480px) {
            .sell-dashboard-title {
                font-size: 1.3rem;
            }

            .sell-dashboard-subtitle {
                font-size: 0.85rem;
            }

            .sell-dashboard-header {
                padding: 15px;
            }

            .mini-stat {
                padding: 10px 15px;
                min-width: 70px;
            }

            .mini-stat-number {
                font-size: 1.2rem;
            }

            .mini-stat-label {
                font-size: 0.65rem;
            }
        }

        /* ========================================
           WEBSITE MODE STYLES
        ======================================== */
        
        /* Mode-specific body classes */
        body.mode-guest {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        body.mode-user {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        body.mode-seller {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
        }
        
        /* Guest mode specific styles */
        .mode-guest .guest-only {
            display: block !important;
        }
        
        .mode-guest .user-only,
        .mode-guest .seller-only {
            display: none !important;
        }
        
        .mode-guest .site-title::after {
            content: " (Guest Mode)";
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        /* User mode specific styles */
        .mode-user .user-only {
            display: block !important;
        }
        
        .mode-user .guest-only,
        .mode-user .seller-only {
            display: none !important;
        }
        
        .mode-user .site-title::after {
            content: " (User Mode)";
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        /* Seller mode specific styles */
        .mode-seller .seller-only {
            display: block !important;
        }
        
        .mode-seller .guest-only,
        .mode-seller .user-only {
            display: none !important;
        }
        
        .mode-seller .site-title::after {
            content: " (Seller Mode)";
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        /* Mode-specific navigation styles */
        .mode-guest .login-btn,
        .mode-guest .register-btn {
            display: inline-block !important;
        }
        
        .mode-guest .logout-btn,
        .mode-guest .account-btn {
            display: none !important;
        }
        
        .mode-user .login-btn,
        .mode-user .register-btn {
            display: none !important;
        }
        
        .mode-user .logout-btn,
        .mode-user .account-btn {
            display: inline-block !important;
        }
        
        .mode-seller .login-btn,
        .mode-seller .register-btn {
            display: none !important;
        }
        
        .mode-seller .logout-btn,
        .mode-seller .account-btn,
        .mode-seller .seller-dashboard-link {
            display: inline-block !important;
        }
        
        /* Mode-specific product card styles */
        .mode-guest .add-to-cart,
        .mode-guest .wishlist-btn {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .mode-guest .add-to-cart:hover,
        .mode-guest .wishlist-btn:hover {
            transform: none;
            box-shadow: none;
        }
        
        .mode-seller .add-to-cart {
            display: none !important;
        }
        
        .mode-seller .seller-controls {
            display: flex !important;
            gap: 5px;
        }
        
        /* Mode transitions */
        body {
            transition: background 0.5s ease;
        }
        
        .mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .mode-guest .mode-indicator {
            background: var(--info-color);
            color: white;
        }
        
        .mode-user .mode-indicator {
            background: var(--success-color);
            color: white;
        }
        
        .mode-seller .mode-indicator {
            background: var(--warning-color);
            color: white;
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            /* Base responsive adjustments */
            body {
                font-size: 14px;
                line-height: 1.5;
            }

            /* Header responsive */
            .top-header .container {
                padding: 0 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .top-header .contact-info {
                display: none;
            }

            .top-header .user-actions {
                gap: 10px;
                font-size: 0.8rem;
            }

            .header-content {
                padding: 12px 15px;
                gap: 15px;
                flex-wrap: wrap;
            }

            .logo {
                font-size: 1.5rem;
                gap: 8px;
            }

            .logo i {
                font-size: 1.7rem;
            }

            .search-bar {
                order: 3;
                max-width: 100%;
                flex-basis: 100%;
            }

            .search-bar input {
                padding: 12px 15px;
                font-size: 14px;
            }

            .search-bar button {
                padding: 12px 18px;
                font-size: 14px;
            }

            .header-actions {
                gap: 15px;
            }

            .header-action {
                padding: 6px 8px;
                font-size: 0.9rem;
            }

            .header-action .badge {
                position: absolute;
                top: 0;
                right: 0;
                transform: translate(25%, -25%);
                font-size: 0.7rem;
                padding: 2px 4px;
            }

            /* Navigation responsive */
            .main-nav .container {
                padding: 0 15px;
            }

            .nav-menu {
                flex-direction: column;
                gap: 5px;
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .nav-menu li {
                flex-shrink: 0;
            }

            .nav-menu a {
                padding: 10px 12px;
                font-size: 0.85rem;
                white-space: nowrap;
            }

            /* Hero section responsive */
            .hero-section {
                padding: 40px 15px;
                min-height: 60vh;
            }

            .hero-content {
                gap: 30px;
                flex-direction: column;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 2rem;
                line-height: 1.2;
            }

            .hero-text p {
                font-size: 1rem;
                margin-bottom: 25px;
            }

            .hero-buttons {
                flex-direction: column;
                gap: 15px;
                width: 100%;
            }

            .hero-buttons .btn {
                width: 100%;
                padding: 15px 20px;
                font-size: 1rem;
            }

            .hero-features {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }

            .hero-feature {
                padding: 20px;
            }

            /* Product grid responsive */
            .products-section {
                padding: 40px 15px;
            }

            .section-header {
                text-align: center;
                margin-bottom: 30px;
            }

            .section-header h2 {
                font-size: 1.8rem;
            }

            .section-header p {
                font-size: 0.95rem;
            }

            .filter-tabs {
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 25px;
            }

            .filter-tabs .tab {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }

            .product-card {
                padding: 15px;
            }

            .product-image {
                height: 150px;
            }

            .product-title {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .product-price {
                font-size: 1rem;
                margin-bottom: 12px;
            }

            .product-actions {
                flex-direction: column;
                gap: 8px;
            }

            .product-actions .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            /* Features section responsive */
            .features-section {
                padding: 40px 15px;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }

            .feature-card {
                padding: 25px;
                text-align: center;
            }

            .feature-icon {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }

            .feature-title {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }

            /* Categories responsive */
            .categories-section {
                padding: 40px 15px;
            }

            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .category-card {
                padding: 20px;
            }

            .category-icon {
                font-size: 2rem;
                margin-bottom: 10px;
            }

            .category-name {
                font-size: 1rem;
            }

            /* Newsletter responsive */
            .newsletter-section {
                padding: 40px 15px;
            }

            .newsletter-content {
                text-align: center;
            }

            .newsletter-form {
                flex-direction: column;
                gap: 15px;
                max-width: 100%;
            }

            .newsletter-form input {
                padding: 12px 15px;
                font-size: 1rem;
            }

            .newsletter-form button {
                padding: 12px 20px;
                font-size: 1rem;
            }

            /* Footer responsive */
            .footer {
                padding: 40px 15px 20px;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
                text-align: center;
            }

            .footer-section h3 {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }

            .footer-section ul {
                gap: 8px;
            }

            .footer-section ul li {
                font-size: 0.9rem;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding-top: 20px;
            }

            .social-links {
                justify-content: center;
            }

            /* Modal responsive */
            .modal-content {
                margin: 10px;
                padding: 20px;
                max-width: calc(100% - 20px);
            }

            .modal-header {
                padding: 0 0 15px 0;
            }

            .modal-header h2 {
                font-size: 1.3rem;
            }

            .modal-body {
                padding: 0 0 20px 0;
            }

            .modal-footer {
                padding: 15px 0 0 0;
                flex-direction: column;
                gap: 10px;
            }

            /* Forms responsive */
            .form-group {
                margin-bottom: 20px;
            }

            .form-label {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .form-input,
            .form-select,
            .form-textarea {
                padding: 12px 15px;
                font-size: 1rem;
            }

            .form-checkbox {
                margin-bottom: 15px;
            }

            .form-checkbox label {
                font-size: 0.9rem;
            }

            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }

            /* Cart responsive */
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }

            .cart-sidebar.open {
                right: 0;
            }

            .cart-header {
                padding: 15px;
            }

            .cart-items {
                padding: 15px;
            }

            .cart-item {
                padding: 15px;
                gap: 15px;
            }

            .cart-item-image {
                width: 60px;
                height: 60px;
            }

            .cart-item-info {
                flex: 1;
            }

            .cart-item-title {
                font-size: 0.9rem;
            }

            .cart-item-price {
                font-size: 0.85rem;
            }

            .cart-footer {
                padding: 15px;
            }

            /* Toast notifications responsive */
            .toast {
                left: 10px;
                right: 10px;
                margin: 0;
                max-width: none;
            }

            /* Help modal responsive */
            .help-content {
                padding: 20px;
            }

            .help-section {
                margin-bottom: 25px;
            }

            .help-section h3 {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }

            .help-section p,
            .help-section ul li {
                font-size: 0.9rem;
            }

            .help-actions {
                flex-direction: column;
                gap: 10px;
            }

            .help-actions .btn {
                width: 100%;
            }

            /* Loading spinner responsive */
            .loading-spinner {
                width: 40px;
                height: 40px;
                border-width: 3px;
            }

            /* Responsive containers */
            .container {
                padding: 0 15px;
            }

            /* Responsive text */
            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            h3 {
                font-size: 1.3rem;
            }

            /* Responsive spacing */
            .section {
                padding: 40px 15px;
            }

            /* Responsive grid layouts */
            .grid-2 {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .grid-3 {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            /* Responsive cards */
            .card {
                padding: 20px;
            }

            /* Responsive buttons */
            .btn-group {
                flex-direction: column;
                gap: 10px;
            }

            .btn-group .btn {
                width: 100%;
            }

            /* Responsive tables */
            .table-responsive {
                overflow-x: auto;
            }

            table {
                font-size: 0.85rem;
            }

            th,
            td {
                padding: 8px;
            }

            /* Responsive images */
            img {
                max-width: 100%;
                height: auto;
            }

            /* Responsive utilities */
            .hide-mobile {
                display: none !important;
            }

            .show-mobile {
                display: block !important;
            }

            .text-center-mobile {
                text-align: center !important;
            }

            .full-width-mobile {
                width: 100% !important;
            }
        }

        /* Tablet responsive */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: 0 20px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }

            .hero-text h1 {
                font-size: 2.5rem;
            }

            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .categories-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Large mobile landscape */
        @media (max-width: 768px) and (orientation: landscape) {
            .hero-section {
                min-height: 80vh;
            }

            .hero-features {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }

            .hero-feature {
                padding: 15px;
            }
        }

        /* Small mobile devices */
        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 12px;
            }

            .product-card {
                padding: 12px;
            }

            .product-image {
                height: 120px;
            }

            .categories-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .filter-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .filter-tabs .tab {
                flex-shrink: 0;
            }
        }

        /* Ensure no horizontal scrolling */
        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
            }

            * {
                max-width: 100%;
                box-sizing: border-box;
            }

            .products-grid,
            .features-grid,
            .categories-grid,
            .footer-content {
                overflow: hidden;
            }
        }
    </style>
</head>
<body>
    <!-- Mode Indicator -->
    <div class="mode-indicator" id="modeIndicator">Guest Mode</div>
    
    <!-- Top Header -->
    <div class="top-header">
        <div class="container">
            <div class="contact-info">
                <span><i class="fas fa-phone"></i> +254 705 424364</span>
                <span><i class="fas fa-envelope"></i> pmuiruri9657@gmail.com</span>
            </div>
            <div class="user-actions">
                <a href="login.html" onclick="console.log('Login button clicked - navigating to login page');"><i class="fas fa-user"></i> Login</a>
                <a href="register.html" onclick="console.log('Register button clicked - navigating to register page');"><i class="fas fa-user-plus"></i> Register</a>
                <a href="register.html?type=seller" onclick="console.log('Sell button clicked - navigating to seller registration page');"><i class="fas fa-store"></i> Sell</a>
                <a href="#" onclick="console.log('Help button clicked'); showHelpModal(); return false;"><i class="fas fa-question-circle"></i> Help</a>
                <a href="admin/admin-login.html" onclick="console.log('Admin button clicked');" style="font-size: 0.8rem; opacity: 0.6; color: var(--primary-color); text-decoration: none; margin-left: 8px; font-weight: 500;" title="EcoLoop Admin Access"><i class="fas fa-leaf"></i> Admin</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="header-content">
            <a href="#" class="logo">
                <i class="fas fa-shopping-cart"></i>
                EcoLoop Kenya
            </a>
            
            <div class="search-bar">
                <input type="text" placeholder="Search for products, brands and categories..." id="searchInput">
                <button type="button" onclick="performSearch()">
                    <i class="fas fa-search"></i>
                </button>
            </div>

            <div class="header-actions">
                <a href="messages.html" class="header-action">
                    <i class="fas fa-envelope"></i>
                    <span>Messages</span>
                    <span class="cart-count" id="messageCount" style="background: var(--info-color);">0</span>
                </a>
                <a href="#" class="header-action" onclick="showWishlistModal(); return false;">
                    <i class="fas fa-heart"></i>
                    <span>Wishlist</span>
                    <span class="cart-count" id="wishlistCount" style="background: var(--warning-color);">0</span>
                </a>
                <div class="user-info">
                    <a href="#" class="header-action user-account" onclick="if (window.userAuth && userAuth.isAuthenticated()) { userAuth.showAccountDropdown(); } else { window.location.href = 'login.html'; } return false;">
                        <i class="fas fa-user"></i>
                        <span>Account</span>
                    </a>
                    
                    <!-- Account Dropdown -->
                    <div class="account-dropdown" id="accountDropdown">
                        <div class="account-header">
                            <div class="account-avatar-large" id="accountAvatarLarge">U</div>
                            <div class="account-name-large" id="accountNameLarge">Loading...</div>
                            <div class="account-email" id="accountEmail">Loading...</div>
                            <div class="account-type-badge" id="accountTypeBadge">Loading...</div>
                        </div>
                        
                        <div class="account-details">
                            <div class="account-section">
                                <div class="account-section-title">
                                    <i class="fas fa-user-circle"></i>
                                    Account Information
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-id-badge"></i>
                                        User ID
                                    </span>
                                    <span class="account-info-value" id="accountUserId">-</span>
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-calendar"></i>
                                        Member Since
                                    </span>
                                    <span class="account-info-value" id="accountMemberSince">-</span>
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-check-circle"></i>
                                        Status
                                    </span>
                                    <span class="account-info-value" id="accountStatus">Active</span>
                                </div>
                            </div>
                            
                            <div class="account-section" id="sellerSection" style="display: none;">
                                <div class="account-section-title">
                                    <i class="fas fa-store"></i>
                                    Business Information
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-building"></i>
                                        Business Name
                                    </span>
                                    <span class="account-info-value" id="accountBusinessName">-</span>
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-phone"></i>
                                        Phone
                                    </span>
                                    <span class="account-info-value" id="accountPhone">-</span>
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-map-marker-alt"></i>
                                        Location
                                    </span>
                                    <span class="account-info-value" id="accountLocation">-</span>
                                </div>
                            </div>
                            
                            <div class="account-section">
                                <div class="account-section-title">
                                    <i class="fas fa-shopping-bag"></i>
                                    Shopping Statistics
                                </div>
                                <div class="shopping-stats">
                                    <div class="stat-card">
                                        <div class="stat-value" id="statOrders">0</div>
                                        <div class="stat-label">Orders</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="statWishlist">0</div>
                                        <div class="stat-label">Wishlist</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="statReviews">0</div>
                                        <div class="stat-label">Reviews</div>
                                    </div>
                                </div>
                                <div class="account-info-item" style="margin-top: 12px;">
                                    <span class="account-info-label">
                                        <i class="fas fa-dollar-sign"></i>
                                        Total Spent
                                    </span>
                                    <span class="account-info-value" id="accountTotalSpent">KES 0</span>
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-box"></i>
                                        Items Purchased
                                    </span>
                                    <span class="account-info-value" id="accountItemsPurchased">0</span>
                                </div>
                            </div>
                            
                            <div class="account-section">
                                <div class="account-section-title">
                                    <i class="fas fa-chart-line"></i>
                                    Recent Activity
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-eye"></i>
                                        Last Viewed
                                    </span>
                                    <span class="account-info-value" id="accountLastViewed">No items</span>
                                </div>
                                <div class="account-info-item">
                                    <span class="account-info-label">
                                        <i class="fas fa-search"></i>
                                        Searches
                                    </span>
                                    <span class="account-info-value" id="accountSearches">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="account-actions">
                            <button class="account-button primary" onclick="viewOrders()">
                                <i class="fas fa-shopping-bag"></i>
                                My Orders
                            </button>
                            <button class="account-button secondary" onclick="viewWishlist()">
                                <i class="fas fa-heart"></i>
                                My Wishlist
                            </button>
                            <button class="account-button secondary" onclick="editProfile()">
                                <i class="fas fa-user-edit"></i>
                                Edit Profile
                            </button>
                            <button class="account-button secondary" onclick="viewSettings()">
                                <i class="fas fa-cog"></i>
                                Settings
                            </button>
                            <button class="account-button danger" onclick="if (confirm('Are you sure you want to logout?')) { window.userAuth.logout(); }">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
                <a href="#" class="header-action" onclick="showCartModal(); return false;">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Cart</span>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-content">
            <ul class="nav-list">
                <li class="nav-item"><a href="#" class="nav-link" onclick="filterByCategory('all'); return false;">All Categories</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="showTodaysDeals(); return false;">Today's Deals</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="filterByCategory('Electronics'); return false;">Electronics</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="filterByCategory('Fashion'); return false;">Fashion</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="filterByCategory('Home & Kitchen'); return false;">Home & Kitchen</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="filterByCategory('Sports'); return false;">Sports</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="filterByCategory('Books'); return false;">Books</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="showAllCategories(); return false;">More</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Black Friday Mega Sale!</h1>
            <p class="hero-subtitle">Up to 70% off on selected items. Limited time offer!</p>
            <div class="hero-buttons">
                <a href="#products" class="btn btn-primary">Shop Now</a>
                <a href="#" class="btn btn-secondary">View All Deals</a>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section" id="products">
        <div class="products-header">
            <h2 class="section-title">Featured Products</h2>
            <div class="filter-tabs">
                <a href="#" class="filter-tab active" onclick="filterProducts('all')">All</a>
                <a href="#" class="filter-tab" onclick="filterProducts('sale')">Sale</a>
                <a href="#" class="filter-tab" onclick="filterProducts('trending')">Trending</a>
                <a href="#" class="filter-tab" onclick="filterProducts('new')">New</a>
                <a href="#" class="filter-tab" onclick="filterProducts('Electronics')">Electronics</a>
                <a href="#" class="filter-tab" onclick="filterProducts('Fashion')">Fashion</a>
                <a href="#" class="filter-tab" onclick="filterProducts('Gaming')">Gaming</a>
            </div>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <!-- Products will be loaded here -->
        </div>
    </section>

    <!-- Sell Your Products Dashboard -->
    <section class="sell-dashboard sell-dashboard-compact">
        <div class="sell-dashboard-content">
            <div class="sell-dashboard-header">
                <h2 class="sell-dashboard-title">
                    <i class="fas fa-store"></i> Sell Your Products
                </h2>
                <p class="sell-dashboard-subtitle">Join 50K+ sellers reaching millions of buyers</p>
            </div>
            <div class="sell-dashboard-actions">
                <a href="admin/seller-dashboard.html" class="btn btn-primary">
                    <i class="fas fa-store"></i> Go to Seller Dashboard
                </a>
            </div>
            <div class="sell-dashboard-stats">
                <div class="mini-stat">
                    <span class="mini-stat-number">50K+</span>
                    <span class="mini-stat-label">Sellers</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-number">2M+</span>
                    <span class="mini-stat-label">Buyers</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-number">100K+</span>
                    <span class="mini-stat-label">Products</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section">
        <div class="categories-header">
            <h2 class="section-title">Shop by Category</h2>
            <p class="section-subtitle">Browse our wide selection of products across different categories</p>
        </div>
        <div class="categories-grid" id="categoriesGrid">
            <!-- Categories will be loaded here dynamically -->
        </div>
    </section>

    <!-- Register Modal - Moved to separate register.html page -->

    <!-- Seller Register Modal - Moved to separate register.html page -->

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About EcoLoop Kenya</h3>
                <p>Your trusted online shopping destination for quality pre-owned items with secure payment options.</p>
                <div style="margin-top: 20px;">
                    <a href="#" style="margin-right: 10px;"><i class="fab fa-facebook fa-lg"></i></a>
                    <a href="#" style="margin-right: 10px;"><i class="fab fa-twitter fa-lg"></i></a>
                    <a href="#" style="margin-right: 10px;"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#"><i class="fab fa-youtube fa-lg"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Customer Service</h3>
                <ul>
                    <li><a href="#" onclick="showContactModal(); return false;">Contact Us</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Shipping Info</a></li>
                    <li><a href="#">Returns</a></li>
                    <li><a href="#">Track Order</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Careers</h3>
                <div style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; margin-top: 10px;">
                    <i class="fas fa-briefcase" style="font-size: 2rem; color: var(--vibrant-yellow); margin-bottom: 10px;"></i>
                    <p style="margin: 10px 0; font-style: italic;">"Our team is complete, but our doors are always open to amazing talent!</p>
                    <p style="margin: 10px 0; font-size: 0.9rem;">No careers available at the moment, but we're always growing.</p>
                    <div style="margin-top: 15px;">
                        <button onclick="showCareerNotification()" style="background: var(--vibrant-yellow); color: var(--kenyan-black); border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 500;">
                            <i class="fas fa-bell"></i> Notify Me When Available
                        </button>
                    </div>
                </div>
            </div>
            <div class="footer-section">
                <h3>Payment Methods</h3>
                <p>We accept all major payment methods:</p>
                <div style="margin-top: 15px;">
                    <i class="fab fa-cc-visa fa-2x" style="margin-right: 10px;"></i>
                    <i class="fab fa-cc-mastercard fa-2x" style="margin-right: 10px;"></i>
                    <i class="fab fa-cc-paypal fa-2x" style="margin-right: 10px;"></i>
                    <i class="fab fa-mpesa fa-2x"></i>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 EcoLoop Kenya. All rights reserved. | Privacy Policy | Terms of Service</p>
        </div>
    </footer>

    <!-- Toast Notification -->
    <!-- Message Seller Modal -->
    <div class="modal" id="messageModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('messageModal')">&times;</button>
            <h2 class="modal-title">Message Seller</h2>
            <div class="message-form">
                <div class="form-group">
                    <label>Seller:</label>
                    <div class="seller-info">
                        <strong id="sellerName">Seller Name</strong>
                        <span id="sellerEmail">seller@example.com</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="messageSubject">Subject:</label>
                    <input type="text" id="messageSubject" placeholder="Enter message subject">
                </div>
                <div class="form-group">
                    <label for="messageContent">Message:</label>
                    <textarea id="messageContent" rows="4" placeholder="Type your message here..."></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal('messageModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="sendMessage()">Send Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div class="modal" id="chatModal">
        <div class="modal-content" style="max-width: 600px; height: 500px; display: flex; flex-direction: column;">
            <button class="modal-close" onclick="closeModal('chatModal')">&times;</button>
            <div class="chat-header">
                <h2 class="modal-title">Chat with <span id="chatSellerName">Seller</span></h2>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be loaded here -->
            </div>
            <div class="chat-input">
                <textarea id="chatInput" placeholder="Type your message..." rows="2"></textarea>
                <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <style>
        /* Help Modal Specific Styles */
        .help-modal .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: #000;
        }

        .modal-title {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2rem;
            text-align: center;
        }

        .help-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .help-section p, .help-section li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .help-section ul {
            margin-left: 20px;
        }

        .help-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .contact-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .help-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .contact-form {
            margin-bottom: 20px;
        }

        .form-actions .btn,
        .help-actions .btn {
            min-width: 120px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-actions {
                flex-direction: column;
            }
            
            .help-actions .btn,
            .form-actions .btn {
                width: 100%;
            }
        }
    </style>
    
    <script>
        // Categories data
        // Intelligent Category Assignment System
        function autoAssignCategory(productName, description, manualCategory) {
            // If manual category is provided and valid, use it
            const validCategories = ["Electronics", "Fashion", "Gaming", "Home & Kitchen", "Sports", "Books"];
            if (manualCategory && validCategories.includes(manualCategory)) {
                return manualCategory;
            }

            // Combine all text for analysis
            const textToAnalyze = `${productName} ${description} ${manualCategory || ''}`.toLowerCase();
            
            // Electronics keywords
            const electronicsKeywords = [
                'phone', 'smartphone', 'iphone', 'samsung', 'laptop', 'computer', 'tablet', 'ipad',
                'headphone', 'speaker', 'camera', 'tv', 'television', 'monitor', 'keyboard', 'mouse',
                'charger', 'cable', 'usb', 'bluetooth', 'wifi', 'router', 'modem', 'printer',
                'scanner', 'hard drive', 'ssd', 'memory', 'ram', 'processor', 'gpu', 'graphics',
                'gaming console', 'playstation', 'xbox', 'nintendo', 'watch', 'smartwatch',
                'fitbit', 'apple watch', 'airpods', 'earbuds', 'microphone', 'webcam',
                'drone', 'gadget', 'electronic', 'digital', 'battery', 'power bank'
            ];

            // Fashion keywords
            const fashionKeywords = [
                'shirt', 't-shirt', 'dress', 'pants', 'jeans', 'trousers', 'skirt', 'shorts',
                'jacket', 'coat', 'blazer', 'suit', 'tie', 'belt', 'shoes', 'boots', 'sandals',
                'sneakers', 'heels', 'flip flops', 'bag', 'handbag', 'purse', 'wallet',
                'hat', 'cap', 'scarf', 'gloves', 'sunglasses', 'watch', 'jewelry', 'ring',
                'necklace', 'bracelet', 'earrings', 'perfume', 'cosmetics', 'makeup',
                'lipstick', 'foundation', 'mascara', 'clothing', 'apparel', 'outfit',
                'fashion', 'style', 'wear', 'fabric', 'cotton', 'silk', 'leather', 'denim'
            ];

            // Gaming keywords
            const gamingKeywords = [
                'game', 'gaming', 'playstation', 'ps4', 'ps5', 'xbox', 'nintendo', 'switch',
                'console', 'controller', 'joystick', 'gaming chair', 'desk', 'monitor',
                'headset', 'gaming mouse', 'gaming keyboard', 'rgb', 'led', 'gaming pc',
                'graphics card', 'gpu', 'gaming laptop', 'steam', 'epic games', 'game pass',
                'gaming headset', 'gaming mouse pad', 'gaming desk', 'gaming chair',
                'video game', 'pc game', 'board game', 'card game', 'gaming accessories'
            ];

            // Home & Kitchen keywords
            const homeKeywords = [
                'furniture', 'sofa', 'chair', 'table', 'bed', 'mattress', 'couch', 'wardrobe',
                'shelf', 'cabinet', 'desk', 'kitchen', 'cookware', 'pan', 'pot', 'utensil',
                'knife', 'cutting board', 'blender', 'mixer', 'oven', 'microwave', 'refrigerator',
                'dishwasher', 'coffee maker', 'toaster', 'kettle', 'appliance', 'vacuum',
                'cleaner', 'mop', 'broom', 'decor', 'curtain', 'rug', 'carpet', 'lamp',
                'lighting', 'mirror', 'picture frame', 'vase', 'plant', 'home', 'house',
                'living room', 'bedroom', 'bathroom', 'kitchenware', 'dinnerware', 'plates'
            ];

            // Sports keywords
            const sportsKeywords = [
                'sport', 'fitness', 'gym', 'workout', 'exercise', 'weights', 'dumbbell', 'barbell',
                'treadmill', 'bike', 'bicycle', 'elliptical', 'yoga', 'mat', 'ball', 'basketball',
                'football', 'soccer', 'tennis', 'racket', 'golf', 'clubs', 'running', 'shoes',
                'athletic', 'jersey', 'helmet', 'protective gear', 'skateboard', 'surfboard',
                'ski', 'snowboard', 'camping', 'hiking', 'tent', 'sleeping bag', 'backpack',
                'fishing', 'rod', 'reel', 'hunting', 'outdoor', 'adventure', 'sports equipment'
            ];

            // Books keywords
            const booksKeywords = [
                'book', 'novel', 'textbook', 'magazine', 'comic', 'manga', 'ebook', 'kindle',
                'author', 'fiction', 'non-fiction', 'biography', 'history', 'science', 'math',
                'education', 'study', 'guide', 'manual', 'cookbook', 'recipe', 'art', 'photography',
                'music', 'sheet music', 'dictionary', 'encyclopedia', 'children', 'kids',
                'educational', 'learning', 'school', 'college', 'university', 'paperback', 'hardcover'
            ];

            // Score each category based on keyword matches
            const scores = {
                'Electronics': 0,
                'Fashion': 0,
                'Gaming': 0,
                'Home & Kitchen': 0,
                'Sports': 0,
                'Books': 0
            };

            // Count keyword matches
            electronicsKeywords.forEach(keyword => {
                if (textToAnalyze.includes(keyword)) scores.Electronics++;
            });

            fashionKeywords.forEach(keyword => {
                if (textToAnalyze.includes(keyword)) scores.Fashion++;
            });

            gamingKeywords.forEach(keyword => {
                if (textToAnalyze.includes(keyword)) scores.Gaming++;
            });

            homeKeywords.forEach(keyword => {
                if (textToAnalyze.includes(keyword)) scores['Home & Kitchen']++;
            });

            sportsKeywords.forEach(keyword => {
                if (textToAnalyze.includes(keyword)) scores.Sports++;
            });

            booksKeywords.forEach(keyword => {
                if (textToAnalyze.includes(keyword)) scores.Books++;
            });

            // Find the category with the highest score
            let maxScore = 0;
            let assignedCategory = 'Electronics'; // Default category

            for (const [category, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    assignedCategory = category;
                }
            }

            // If no keywords match, use manual category or default
            if (maxScore === 0) {
                assignedCategory = manualCategory && validCategories.includes(manualCategory) 
                    ? manualCategory 
                    : 'Electronics';
            }

            console.log(`ðŸ·ï¸ Auto-assigned category: ${assignedCategory} (Score: ${maxScore})`);
            console.log(`ðŸ“ Analyzed text: "${textToAnalyze.substring(0, 100)}..."`);
            
            return assignedCategory;
        }

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDemoKey-ReplaceWithActualKey",
            authDomain: "ecoloop-kenya-website.firebaseapp.com",
            projectId: "ecoloop-kenya-website",
            storageBucket: "ecoloop-kenya-website.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const functions = firebase.functions();

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            // Auto-cleanup unapproved products on page load
            autoCleanupUnapproved();
            
            loadCategories();
            await loadProducts('all');
            updateCartCount();
            updateWishlistCount();
            updateMessageCount();
            initializeAuth();
            updateAccountStats();
            
            // Load user-specific cart and wishlist
            if (currentUser) {
                // User is logged in - load their data
                updateCartCount();
                updateWishlistCount();
            } else {
                // Guest user - load guest data
                updateCartCount();
                updateWishlistCount();
            }
            
            // Refresh wishlist buttons after a short delay to ensure all products are loaded
            setTimeout(() => {
                refreshWishlistButtons();
            }, 1000);
            
            // Check for existing user session
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateAuthUI();
            }
            
            // Initialize website mode based on authentication state
            const detectedMode = detectWebsiteMode();
            switchWebsiteMode(detectedMode);
            
            // Update message count every 5 seconds
            setInterval(() => {
                updateMessageCount();
            }, 5000);
            
            // Listen for storage changes (admin-approved products)
            window.addEventListener('storage', async function(e) {
                if (e.key === 'products' || e.key === 'sellerProducts') {
                    console.log('ðŸ”„ Storage change detected, refreshing products...');
                    await loadProducts('all');
                    updateCategoryCounts(); // Update category counts when products change
                }
            });
            
            // Check for new approved products every 10 seconds
            setInterval(async () => {
                const currentApprovedCount = document.querySelectorAll('.product-card').length;
                const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
                const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
                const totalApproved = adminProducts.filter(p => p.status === 'approved').length + 
                                   sellerProducts.filter(p => p.status === 'approved').length;
                
                if (totalApproved > currentApprovedCount) {
                    console.log('New approved products found, refreshing...');
                    await loadProducts('all');
                }
            }, 10000);
        });

        // Load categories
        function loadCategories() {
            const grid = document.getElementById('categoriesGrid');
            if (!grid) return;
            
            // Update category counts based on products
            categories.forEach(category => {
                category.count = products.filter(p => p.category === category.name).length;
            });
            
            grid.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }

        // Create category card HTML
        // Update category counts based on products
        function updateCategoryCounts() {
            // Get all products from approved seller products only
            const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
            const registeredSellerEmails = new Set(registeredSellers.map(s => s.email));
            
            const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
            const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
            
            // Only use approved products from registered sellers - no sample data fallback
            let allProducts = [
                ...adminProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail)),
                ...sellerProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail))
            ];
            
            // Update category counts
            categories.forEach(category => {
                category.count = allProducts.filter(p => p.category === category.name).length;
            });
            
            // Refresh categories display
            loadCategories();
            
            console.log('ðŸ“Š Category counts updated based on approved seller products');
        }

        // Load categories with updated counts
        function loadCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }

        function createCategoryCard(category) {
            return `
                <div class="category-card" data-category="${category.name}" onclick="filterByCategory('${category.name}')">
                    <div class="category-icon">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${category.count} Products</div>
                </div>
            `;
        }

        // Get recently uploaded products (today and yesterday)
        function getRecentlyUploaded() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            return products.filter(p => {
                const uploadDate = new Date(p.uploadedAt);
                return uploadDate >= yesterday;
            }).sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
        }
        // Show all categories (More link)
        function showAllCategories() {
            // Scroll to categories section
            document.querySelector('.categories-section').scrollIntoView({ behavior: 'smooth' });
            showToast('Browse all categories below', 'info');
        }

        // Update active navigation state
        function updateActiveNav(category) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.style.background = 'transparent';
            });
            
            // Highlight active nav item
            const activeNav = document.querySelector(`.nav-link[onclick*="${category}"]`);
            if (activeNav) {
                activeNav.style.background = 'rgba(255, 255, 255, 0.2)';
            }
        }
        // Filter products by category
        function filterByCategory(categoryName) {
            // Update active navigation state
            updateActiveNav(categoryName);
            
            let filteredProducts = products;
            
            if (categoryName !== 'all') {
                filteredProducts = products.filter(p => p.category === categoryName);
            }
            
            const grid = document.getElementById('productsGrid');
            
            if (filteredProducts.length > 0) {
                grid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
                showToast(`Showing ${filteredProducts.length} products in ${categoryName === 'all' ? 'all categories' : categoryName}`, 'success');
                
                // Update filter tabs
                document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
                const matchingTab = document.querySelector(`[onclick="filterProducts('${categoryName}')"]`);
                if (matchingTab) {
                    matchingTab.classList.add('active');
                } else {
                    document.querySelector(`[onclick="filterProducts('all')"]`).classList.add('active');
                }
            } else {
                grid.innerHTML = '<div class="loading">No products found in this category.</div>';
                showToast(`No products available in ${categoryName}`, 'warning');
            }
            
            // Scroll to products section
            document.querySelector('.products-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Show today's deals (recently uploaded products)
        function showTodaysDeals() {
            const recentProducts = getRecentlyUploaded();
            const grid = document.getElementById('productsGrid');
            
            if (recentProducts.length > 0) {
                grid.innerHTML = recentProducts.map(product => createProductCard(product)).join('');
                showToast(`Showing ${recentProducts.length} recently uploaded products`, 'success');
                
                // Update filter tabs
                document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelector(`[onclick="filterProducts('all')"]`).classList.add('active');
            } else {
                grid.innerHTML = '<div class="loading">No recently uploaded products found.</div>';
                showToast('No recently uploaded products available', 'warning');
            }
            
            // Update navigation state
            updateActiveNav('todays-deals');
            
            // Scroll to products section
            document.querySelector('.products-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Clean up all unapproved products from the system
        async function cleanupUnapprovedProducts() {
            console.log('ðŸ§¹ Starting cleanup of unapproved products...');
            
            // Get all products from storage
            const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
            const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
            
            // Filter only approved products
            const approvedAdminProducts = adminProducts.filter(p => p.status === 'approved');
            const approvedSellerProducts = sellerProducts.filter(p => p.status === 'approved');
            
            // Count removed products
            const removedAdminCount = adminProducts.length - approvedAdminProducts.length;
            const removedSellerCount = sellerProducts.length - approvedSellerProducts.length;
            const totalRemoved = removedAdminCount + removedSellerCount;
            
            // Update storage with only approved products
            localStorage.setItem('products', JSON.stringify(approvedAdminProducts));
            localStorage.setItem('sellerProducts', JSON.stringify(approvedSellerProducts));
            
            // Update category counts
            updateCategoryCounts();
            
            // Reload products to reflect changes
            await loadProducts('all');
            
            console.log(`âœ… Cleanup complete! Removed ${totalRemoved} unapproved products:`);
            console.log(`   - Admin products removed: ${removedAdminCount}`);
            console.log(`   - Seller products removed: ${removedSellerCount}`);
            console.log(`   - Remaining approved products: ${approvedAdminProducts.length + approvedSellerProducts.length}`);
            
            if (totalRemoved > 0) {
                showToast(`ðŸ§¹ Cleaned up ${totalRemoved} unapproved products from the system`, 'success');
            }
            
            return {
                removed: totalRemoved,
                remaining: approvedAdminProducts.length + approvedSellerProducts.length,
                adminRemoved: removedAdminCount,
                sellerRemoved: removedSellerCount
            };
        }

        // Auto-cleanup function that runs on page load
        function autoCleanupUnapproved() {
            const cleanupResult = cleanupUnapprovedProducts();
            
            // Show notification if products were removed
            if (cleanupResult.removed > 0) {
                console.log('ðŸš¨ Auto-cleanup removed unapproved products on page load');
            }
        }

        // Create product card HTML
        function createProductCard(product) {
            try {
                console.log('ðŸ·ï¸ Creating product card for:', product.title || product.name);
                
                // Handle both sample data and admin-approved products
                const title = product.title || product.name || 'Untitled Product';
                const price = product.price || 0;
                const originalPrice = product.originalPrice || product.originalPrice || 0;
                const image = product.image || (product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/250x200/cccccc/ffffff?text=No+Image');
                const category = product.category || 'Uncategorized';
                const rating = product.rating || 4.0;
                const reviews = product.reviews || 0;
                
                // Ensure seller information is available for messaging
                const sellerEmail = product.sellerEmail || 'pmuiruri9657@gmail.com';
                const sellerName = product.sellerName || 'EcoLoop Kenya';
                const sellerPhone = product.sellerPhone || '+254 712 345 678';
                const sellerLocation = product.sellerLocation || 'Nairobi, Kenya';
                
                // Calculate discount if original price exists
                let discount = 0;
                if (originalPrice && originalPrice > price) {
                    discount = Math.round(((originalPrice - price) / originalPrice) * 100);
                }
                
                const stars = 'â˜…'.repeat(Math.floor(rating)) + 'â˜†'.repeat(5 - Math.floor(rating));
                
                // Generate badge based on product data
                let badge = '';
                if (discount > 50) {
                    badge = 'Hot Deal';
                } else if (discount > 30) {
                    badge = 'Best Seller';
                } else if (product.badge) {
                    badge = product.badge;
                } else if (product.status === 'approved' && product.sellerEmail) {
                    badge = 'Seller Product';
                }
                
                const productHTML = `
                    <div class="product-card" onclick="trackProductView(${product.id}, \`${title.replace(/`/g, '\\`')}\`); viewProductDetail(${product.id})">
                        ${badge ? `<div class="product-badge">${badge}</div>` : ''}
                        <div class="product-image-container">
                            <img src="${image}" alt="${title}" class="product-image">
                        </div>
                        <div class="product-info">
                            <h3 class="product-title" title="${title}">${title}</h3>
                            <div class="product-actions">
                                <button class="btn-add-cart" onclick="event.stopPropagation(); addToCart(${product.id})" id="add-cart-btn-${product.id}" title="Add to Cart">
                                    <i class="fas fa-shopping-cart"></i>
                                    <span>Add</span>
                                </button>
                                <button class="btn-wishlist" onclick="event.stopPropagation(); toggleWishlist(${product.id})" 
                                        id="wishlist-btn-${product.id}" 
                                        title="Add to Wishlist">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('âœ… Product card created successfully for:', title);
                return productHTML;
                
            } catch (error) {
                console.error('âŒ Error creating product card:', error);
                return `<div class="product-card error">Error loading product</div>`;
            }
        }

        // Refresh wishlist buttons after products are loaded
        function refreshWishlistButtonsAfterLoad() {
            // Wait a bit for DOM to be updated
            setTimeout(() => {
                refreshWishlistButtons();
            }, 100);
        }

        // Filter products
        async function filterProducts(filter) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update navigation state
            updateActiveNav(filter);
            
            await loadProducts(filter);
        }

        // Update message count
        function updateMessageCount() {
            if (!userAuth.isAuthenticated()) return;
            
            const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
            
            // Filter conversations for current user and count only unread messages
            const userConversations = conversations.filter(conv => {
                // Check if user is participant in this conversation
                return conv.participants && conv.participants.some(p => p.email === userState.currentUser.email);
            });
            
            // Count total unread messages for current user
            const unreadCount = userConversations.reduce((sum, conv) => sum + (conv.unreadCount || 0), 0);
            
            const messageCountElement = document.getElementById('messageCount');
            if (messageCountElement) {
                messageCountElement.textContent = unreadCount;
                messageCountElement.style.display = unreadCount > 0 ? 'flex' : 'none';
            }
            
            console.log(`ðŸ“¬ Message count updated: ${unreadCount} unread messages for ${userState.currentUser.email}`);
        }

        // Mark all messages as read
        function markAllMessagesAsRead() {
            if (!userAuth.isAuthenticated()) {
                showToast('Please login to mark messages as read', 'warning');
                return;
            }
            
            const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
            
            // Update unread count to 0 for all user conversations
            const updatedConversations = conversations.map(conv => {
                if (conv.participants && conv.participants.some(p => p.email === userState.currentUser.email)) {
                    return {
                        ...conv,
                        unreadCount: 0,
                        lastReadBy: userState.currentUser.email,
                        lastReadAt: new Date().toISOString()
                    };
                }
                return conv;
            });
            
            localStorage.setItem('conversations', JSON.stringify(updatedConversations));
            
            // Update message count display
            updateMessageCount();
            
            showToast('All messages marked as read', 'success');
            console.log(`âœ… All messages marked as read for ${userState.currentUser.email}`);
        }

        // Add to cart functionality with MongoDB sync
        async function addToCart(productId) {
            try {
                console.log('ðŸ›’ Adding product to cart:', productId);
                
                // Check if user is authenticated
                if (!userAuth.isAuthenticated()) {
                    showToast('Please login to add items to cart', 'warning');
                    showLoginModal();
                    return;
                }
                
                // Find product from available products
                let product = products.find(p => p.id === productId);
                
                if (!product) {
                    console.error('âŒ Product not found:', productId);
                    showToast('Product not found', 'error');
                    return;
                }
                
                console.log('âœ… Found product:', product.title || product.name);
                
                // Get user-specific cart (async with MongoDB sync)
                const userCart = await getUserCart();
                const existingItem = userCart.find(item => item.id === productId);

                if (existingItem) {
                    existingItem.quantity = (existingItem.quantity || 1) + 1;
                    existingItem.addedAt = new Date().toISOString();
                    await saveUserCart(userCart);
                    showToast(`${product.title || product.name} quantity updated in cart!`, 'success');
                    console.log('ðŸ“¦ Updated existing item quantity:', existingItem.quantity);
                } else {
                    const cartItem = {
                        ...product,
                        quantity: 1,
                        addedAt: new Date().toISOString(),
                        userId: userState.currentUser.id
                    };
                    userCart.push(cartItem);
                    await saveUserCart(userCart);
                    showToast(`${product.title || product.name} added to cart!`, 'success');
                    console.log('ðŸ›’ Added new item to cart:', cartItem.title || cartItem.name);
                    
                    // Update button to show added state
                    const cartButton = document.getElementById(`add-cart-btn-${productId}`);
                    if (cartButton) {
                        cartButton.classList.add('added');
                        cartButton.innerHTML = '<i class="fas fa-check"></i> Added';
                        setTimeout(() => {
                            cartButton.classList.remove('added');
                            cartButton.innerHTML = '<i class="fas fa-shopping-cart"></i>';
                        }, 2000);
                    }
                }

                // Update cart count
                updateCartCount();

                // Track cart activity
                trackCartActivity(productId, 'add');

                // Update cart icon animation
                animateCartIcon();
                
                console.log('âœ… Cart operation completed successfully');
                
            } catch (error) {
                console.error('âŒ Error adding to cart:', error);
                showToast('Error adding item to cart', 'error');
            }
        }

        // View product details
        function viewProductDetail(productId) {
            console.log('ðŸ” Viewing product details for:', productId);
            
            // Store the product ID in localStorage for the detail page to retrieve
            localStorage.setItem('currentProductId', productId);
            
            // Redirect to product detail page
            window.location.href = 'pages/product-detail.html';
        }

        // Remove from cart
        function removeFromCart(productId) {
            const userCart = getUserCart();
            const productIndex = userCart.findIndex(item => item.id === productId);
            
            if (productIndex > -1) {
                const product = userCart[productIndex];
                userCart.splice(productIndex, 1);
                saveUserCart(userCart);
                updateCartCount();
                showToast(`${product.title || product.name || 'Product'} removed from cart!`, 'cart');
                trackCartActivity(productId, 'remove');
            }
        }

        // Update cart item quantity
        function updateCartQuantity(productId, quantity) {
            const userCart = getUserCart();
            const item = userCart.find(item => item.id === productId);
            
            if (item) {
                if (quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    item.quantity = quantity;
                    item.addedAt = new Date().toISOString();
                    saveUserCart(userCart);
                    showToast('Quantity updated!', 'success');
                }
            }
        }

        // Get user-specific cart with MongoDB sync
        async function getUserCart() {
            try {
                if (userAuth.isAuthenticated()) {
                    const userId = userState.currentUser.id;
                    const userCartKey = `cart_${userId}`;
                    
                    // Try to get cart from MongoDB first
                    if (typeof getCartFromMongo === 'function') {
                        try {
                            const mongoCart = await getCartFromMongo(userId);
                            if (mongoCart && mongoCart.length > 0) {
                                console.log('ðŸ“¦ Retrieved cart from MongoDB:', mongoCart.length);
                                // Update localStorage with latest data
                                localStorage.setItem(userCartKey, JSON.stringify(mongoCart));
                                return mongoCart;
                            }
                        } catch (mongoError) {
                            console.log('MongoDB cart fetch failed, using localStorage:', mongoError.message);
                        }
                    }
                    
                    // Fallback to localStorage
                    const localCart = JSON.parse(localStorage.getItem(userCartKey) || '[]');
                    console.log('ðŸ“¦ Using localStorage cart:', localCart.length);
                    return localCart;
                } else {
                    // Guest cart (stored in localStorage)
                    const guestCart = JSON.parse(localStorage.getItem('guestCart') || '[]');
                    console.log('ðŸ“¦ Using guest cart:', guestCart.length);
                    return guestCart;
                }
            } catch (error) {
                console.error('âŒ Error getting user cart:', error);
                return [];
            }
        }

        // Save user-specific cart with MongoDB sync
        async function saveUserCart(userCart) {
            try {
                if (userAuth.isAuthenticated()) {
                    const userId = userState.currentUser.id;
                    const userCartKey = `cart_${userId}`;
                    
                    // Save to localStorage first (for offline access)
                    localStorage.setItem(userCartKey, JSON.stringify(userCart));
                    
                    // Try to sync with MongoDB
                    if (typeof saveCartToMongo === 'function') {
                        try {
                            const result = await saveCartToMongo(userId, userCart);
                            if (result.success) {
                                console.log('âœ… Cart synced to MongoDB:', userCart.length);
                            } else {
                                console.log('MongoDB cart sync failed, localStorage saved:', result.error);
                            }
                        } catch (mongoError) {
                            console.log('MongoDB cart sync failed, localStorage saved:', mongoError.message);
                        }
                    } else {
                        // Fallback: direct API call
                        try {
                            const response = await fetch('https://my-backend-1-jk7w.onrender.com/api/save', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    userId: userId,
                                    cart: userCart,
                                    type: 'cart',
                                    timestamp: new Date()
                                })
                            });
                            
                            if (response.ok) {
                                console.log('âœ… Cart synced to MongoDB via API:', userCart.length);
                            } else {
                                console.log('MongoDB cart sync via API failed, localStorage saved');
                            }
                        } catch (apiError) {
                            console.log('MongoDB cart API sync failed, localStorage saved:', apiError.message);
                        }
                    }
                } else {
                    // Guest cart (stored in localStorage only)
                    localStorage.setItem('guestCart', JSON.stringify(userCart));
                    console.log('ðŸ“¦ Guest cart saved to localStorage:', userCart.length);
                }
            } catch (error) {
                console.error('âŒ Error saving user cart:', error);
                // Always save to localStorage as fallback
                if (userAuth.isAuthenticated()) {
                    const userId = userState.currentUser.id;
                    const userCartKey = `cart_${userId}`;
                    localStorage.setItem(userCartKey, JSON.stringify(userCart));
                } else {
                    localStorage.setItem('guestCart', JSON.stringify(userCart));
                }
            }
        }

        // Track cart activity for analytics
        function trackCartActivity(productId, action) {
            const activity = {
                userId: userAuth.isAuthenticated() ? userState.currentUser.id : 'guest',
                productId: productId,
                action: action, // 'add' or 'remove'
                timestamp: new Date().toISOString()
            };
            
            const cartActivity = JSON.parse(localStorage.getItem('cartActivity') || '[]');
            cartActivity.push(activity);
            
            // Keep only last 100 activities per user
            const userActivity = cartActivity.filter(a => a.userId === activity.userId).slice(-100);
            const otherActivity = cartActivity.filter(a => a.userId !== activity.userId);
            localStorage.setItem('cartActivity', JSON.stringify([...userActivity, ...otherActivity]));
        }

        // Get cart total
        function getCartTotal() {
            const userCart = getUserCart();
            return userCart.reduce((total, item) => total + (item.price * (item.quantity || 1)), 0);
        }

        // Animate cart icon
        function animateCartIcon() {
            const cartIcon = document.querySelector('.fa-shopping-cart').parentElement;
            cartIcon.style.transform = 'scale(1.2)';
            cartIcon.style.transition = 'transform 0.3s';

            setTimeout(() => {
                cartIcon.style.transform = 'scale(1)';
            }, 300);
        }

        // Show cart modal
        function showCartModal() {
            const userCart = getUserCart();
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'cartModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <button class="modal-close" onclick="closeModal('cartModal')">&times;</button>
                    <h2 class="modal-title">
                        <i class="fas fa-shopping-cart"></i> Shopping Cart 
                        <span style="color: var(--primary-color);">(${userCart.length} items)</span>
                    </h2>
                    <div class="cart-items">
                        ${userCart.length > 0 ? userCart.map(item => createCartItem(item)).join('') : 
                            '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">' +
                            '<i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>' +
                            '<h3>Your cart is empty</h3>' +
                            '<p>Browse our products and add items to get started!</p>' +
                            '</div>'}
                    </div>
                    ${userCart.length > 0 ? `
                        <div class="cart-summary">
                            <div class="cart-total">
                                <span>Total:</span>
                                <span style="color: var(--primary-color);">KSH ${getCartTotal().toLocaleString()}</span>
                            </div>
                            <div class="cart-actions">
                                <button class="btn btn-checkout" onclick="checkout()">
                                    <i class="fas fa-credit-card"></i> Proceed to Checkout
                                </button>
                                <button class="btn btn-clear-cart" onclick="clearCart()">
                                    <i class="fas fa-trash"></i> Clear Cart
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            document.body.appendChild(modal);
        }

        // Show wishlist modal
        function showWishlistModal() {
            const userWishlist = getUserWishlist();
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'wishlistModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <button class="modal-close" onclick="closeModal('wishlistModal')">&times;</button>
                    <h2 class="modal-title">
                        <i class="fas fa-heart"></i> My Wishlist 
                        <span style="color: var(--danger-color);">(${userWishlist.length} items)</span>
                    </h2>
                    <div class="wishlist-items">
                        ${userWishlist.length > 0 ? userWishlist.map(item => createWishlistItem(item)).join('') : 
                            '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">' +
                            '<i class="fas fa-heart" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>' +
                            '<h3>Your wishlist is empty</h3>' +
                            '<p>Browse our products and add items to your wishlist!</p>' +
                            '</div>'}
                    </div>
                    ${userWishlist.length > 0 ? `
                        <div class="wishlist-summary">
                            <div class="wishlist-actions">
                                <button class="btn btn-primary" onclick="addAllWishlistToCart()">
                                    <i class="fas fa-shopping-cart"></i> Add All to Cart
                                </button>
                                <button class="btn btn-danger" onclick="clearWishlist()">
                                    <i class="fas fa-trash"></i> Clear Wishlist
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            document.body.appendChild(modal);
        }

        // Create cart item HTML
        function createCartItem(item) {
            const title = item.title || item.name || 'Untitled Product';
            const price = item.price || 0;
            const quantity = item.quantity || 1;
            const image = item.image || (item.images && item.images.length > 0 ? item.images[0] : 'https://via.placeholder.com/80x80/cccccc/ffffff?text=No+Image');
            
            return `
                <div class="cart-item">
                    <img src="${image}" alt="${title}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                    <div class="cart-item-details">
                        <h4>${title}</h4>
                        <p style="color: var(--primary-color); font-weight: bold; font-size: 1.1rem;">KSH ${price.toLocaleString()}</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Seller: ${item.sellerName || 'Unknown'}</p>
                        <div class="quantity-controls">
                            <button class="btn-quantity" onclick="updateCartQuantity(${item.id}, ${quantity - 1})" ${quantity <= 1 ? 'disabled' : ''}>
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="quantity-display">${quantity}</span>
                            <button class="btn-quantity" onclick="updateCartQuantity(${item.id}, ${quantity + 1})">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn-remove" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                    <div class="cart-item-total">
                        <strong>KSH ${(price * quantity).toLocaleString()}</strong>
                    </div>
                </div>
            `;
        }

        // Create wishlist item HTML
        function createWishlistItem(item) {
            const title = item.title || item.name || 'Untitled Product';
            const price = item.price || 0;
            const image = item.image || (item.images && item.images.length > 0 ? item.images[0] : 'https://via.placeholder.com/80x80/cccccc/ffffff?text=No+Image');
            
            return `
                <div class="wishlist-item">
                    <img src="${image}" alt="${title}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                    <div class="wishlist-item-details">
                        <h4>${title}</h4>
                        <p style="color: var(--primary-color); font-weight: bold; font-size: 1.1rem;">KSH ${price.toLocaleString()}</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Seller: ${item.sellerName || 'Unknown'}</p>
                        <p style="color: var(--text-secondary); font-size: 0.8rem;">Added: ${new Date(item.addedAt).toLocaleDateString()}</p>
                        <div class="wishlist-item-actions">
                            <button class="btn btn-primary" onclick="moveToCart(${item.id})">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                            <button class="btn btn-danger" onclick="removeFromWishlist(${item.id})">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                    <div class="wishlist-item-price">
                        <strong>KSH ${price.toLocaleString()}</strong>
                    </div>
                </div>
            `;
        }

        // Clear cart
        function clearCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                const userCart = getUserCart();
                userCart.length = 0; // Clear the array
                saveUserCart(userCart);
                updateCartCount();
                closeModal('cartModal');
                showToast('Cart cleared successfully', 'info');
            }
        }

        // Checkout
        function checkout() {
            const userCart = getUserCart();
            
            if (userCart.length === 0) {
                showToast('Your cart is empty', 'warning');
                return;
            }
            
            if (!userAuth.isAuthenticated()) {
                closeModal('cartModal');
                window.location.href = 'login.html';
                showToast('Please login to proceed with checkout', 'warning');
                return;
            }
            
            // Check if all products are still available
            const uniqueProducts = [];
            const seenIds = new Set();
            
            products.forEach(product => {
                if (!seenIds.has(product.id)) {
                    seenIds.add(product.id);
                    uniqueProducts.push(product);
                }
            });
            
            // Remove unavailable items from cart
            const updatedCart = userCart.filter(item => 
                uniqueProducts.find(p => p.id === item.id)
            );
            
            if (updatedCart.length !== userCart.length) {
                saveUserCart(updatedCart);
                updateCartCount();
                
                // Refresh cart modal
                closeModal('cartModal');
                setTimeout(() => showCartModal(), 100);
                showToast('Some items in your cart are no longer available and have been removed', 'warning');
                return;
            }
            
            // Calculate order summary
            const subtotal = getCartTotal();
            const shipping = subtotal > 5000 ? 0 : 300; // Free shipping over KSH 5000
            const tax = Math.round(subtotal * 0.16); // 16% tax
            const total = subtotal + shipping + tax;
            
            // Create order summary
            const orderSummary = {
                items: userCart,
                subtotal: subtotal,
                shipping: shipping,
                tax: tax,
                total: total,
                userId: userState.currentUser.id,
                userEmail: userState.currentUser.email,
                userName: userState.currentUser.name,
                orderDate: new Date().toISOString(),
                orderStatus: 'pending',
                paymentStatus: 'pending'
            };
            
            // Save order to localStorage (in a real app, this would go to a server)
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            orders.push(orderSummary);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Clear cart after successful order
            userCart.length = 0;
            saveUserCart(userCart);
            updateCartCount();
            
            // Show success message
            closeModal('cartModal');
            showToast('Order placed successfully! ðŸŽ‰', 'success');
            
            // Show order confirmation
            setTimeout(() => {
                const confirmation = `
                    ðŸ“¦ Order Confirmation
                    
                    Order ID: #${orders.length}
                    Total: KSH ${total.toLocaleString()}
                    Items: ${orderSummary.items.length}
                    
                    Thank you for your purchase!
                `;
                alert(confirmation);
            }, 1000);
            
            console.log('âœ… Order placed successfully:', orderSummary);
        }

        // Add to wishlist with MongoDB sync
        async function addToWishlist(productId) {
            try {
                console.log('â¤ï¸ Adding product to wishlist:', productId);
                
                // Check if user is authenticated
                if (!userAuth.isAuthenticated()) {
                    showToast('Please login to add items to wishlist', 'warning');
                    showLoginModal();
                    return;
                }
                
                // Find product from available products
                let product = products.find(p => p.id === productId);
                
                if (!product) {
                    console.error('âŒ Product not found for wishlist:', productId);
                    showToast('Product not found', 'error');
                    return;
                }
                
                console.log('âœ… Found product for wishlist:', product.title || product.name);
                
                // Get user-specific wishlist (async with MongoDB sync)
                const userWishlist = await getUserWishlist();
                const existingItem = userWishlist.find(item => item.id === productId);
                
                if (!existingItem) {
                    const wishlistItem = {
                        ...product,
                        addedAt: new Date().toISOString(),
                        userId: userState.currentUser.id
                    };
                    userWishlist.push(wishlistItem);
                    await saveUserWishlist(userWishlist);
                    updateWishlistCount();
                    showToast(`${product.title || product.name} added to wishlist!`, 'wishlist');
                    trackWishlistActivity(productId, 'add');
                    console.log('â¤ï¸ Added to wishlist:', wishlistItem.title || wishlistItem.name);
                } else {
                    console.log('âš ï¸ Product already in wishlist');
                    showToast('Product already in wishlist', 'info');
                }
            } catch (error) {
                console.error('âŒ Error adding to wishlist:', error);
                showToast('Error adding item to wishlist', 'error');
            }
        }

        // Remove from wishlist with MongoDB sync
        async function removeFromWishlist(productId) {
            try {
                const userWishlist = await getUserWishlist();
                const productIndex = userWishlist.findIndex(item => item.id === productId);
                
                if (productIndex > -1) {
                    const product = userWishlist[productIndex];
                    userWishlist.splice(productIndex, 1);
                    await saveUserWishlist(userWishlist);
                    updateWishlistCount();
                    showToast(`${product.title || product.name || 'Product'} removed from wishlist!`, 'wishlist');
                    trackWishlistActivity(productId, 'remove');
                    console.log('â¤ï¸ Removed from wishlist:', product.title || product.name);
                }
            } catch (error) {
                console.error('âŒ Error removing from wishlist:', error);
                showToast('Error removing item from wishlist', 'error');
            }
        }

        // Check if product is in wishlist
        async function isInWishlist(productId) {
            try {
                const userWishlist = await getUserWishlist();
                return userWishlist.some(item => item.id === productId);
            } catch (error) {
                console.error('âŒ Error checking wishlist:', error);
                return false;
            }
        }

        // Toggle wishlist (add/remove) with MongoDB sync
        async function toggleWishlist(productId) {
            try {
                console.log('ðŸ”„ Toggling wishlist for product:', productId);
                
                // Check if user is authenticated
                if (!userAuth.isAuthenticated()) {
                    showToast('Please login to add items to wishlist', 'warning');
                    showLoginModal();
                    return;
                }
                
                const inWishlist = await isInWishlist(productId);
                
                if (inWishlist) {
                    await removeFromWishlist(productId);
                    updateWishlistButton(productId, false);
                    console.log('â¤ï¸ Removed from wishlist');
                } else {
                    await addToWishlist(productId);
                    updateWishlistButton(productId, true);
                    console.log('â¤ï¸ Added to wishlist');
                }
            } catch (error) {
                console.error('âŒ Error toggling wishlist:', error);
                showToast('Error updating wishlist', 'error');
            }
        }

        // Update wishlist button state
        function updateWishlistButton(productId, isInWishlistState) {
            const button = document.getElementById(`wishlist-btn-${productId}`);
            if (button) {
                if (isInWishlistState) {
                    button.classList.add('in-wishlist');
                    button.title = 'Remove from Wishlist';
                } else {
                    button.classList.remove('in-wishlist');
                    button.title = 'Add to Wishlist';
                }
            }
        }

        // Refresh all wishlist buttons on the page
        async function refreshWishlistButtons() {
            try {
                const productCards = document.querySelectorAll('.product-card');
                for (const card of productCards) {
                    const wishlistBtn = card.querySelector('.btn-wishlist');
                    if (wishlistBtn && wishlistBtn.id) {
                        const productId = wishlistBtn.id.replace('wishlist-btn-', '');
                        const inWishlist = await isInWishlist(productId);
                        updateWishlistButton(productId, inWishlist);
                    }
                }
            } catch (error) {
                console.error('âŒ Error refreshing wishlist buttons:', error);
            }
        }

        // Get user-specific wishlist with MongoDB sync
        async function getUserWishlist() {
            try {
                if (userAuth.isAuthenticated()) {
                    const userId = userState.currentUser.id;
                    const userWishlistKey = `wishlist_${userId}`;
                    
                    // Try to get wishlist from MongoDB first
                    if (typeof getWishlistFromMongo === 'function') {
                        try {
                            const mongoWishlist = await getWishlistFromMongo(userId);
                            if (mongoWishlist && mongoWishlist.length > 0) {
                                console.log('â¤ï¸ Retrieved wishlist from MongoDB:', mongoWishlist.length);
                                // Update localStorage with latest data
                                localStorage.setItem(userWishlistKey, JSON.stringify(mongoWishlist));
                                return mongoWishlist;
                            }
                        } catch (mongoError) {
                            console.log('MongoDB wishlist fetch failed, using localStorage:', mongoError.message);
                        }
                    }
                    
                    // Fallback to localStorage
                    const localWishlist = JSON.parse(localStorage.getItem(userWishlistKey) || '[]');
                    console.log('â¤ï¸ Using localStorage wishlist:', localWishlist.length);
                    return localWishlist;
                } else {
                    // Guest wishlist (stored in localStorage)
                    const guestWishlist = JSON.parse(localStorage.getItem('guestWishlist') || '[]');
                    console.log('â¤ï¸ Using guest wishlist:', guestWishlist.length);
                    return guestWishlist;
                }
            } catch (error) {
                console.error('âŒ Error getting user wishlist:', error);
                return [];
            }
        }

        // Save user-specific wishlist with MongoDB sync
        async function saveUserWishlist(userWishlist) {
            try {
                if (userAuth.isAuthenticated()) {
                    const userId = userState.currentUser.id;
                    const userWishlistKey = `wishlist_${userId}`;
                    
                    // Save to localStorage first (for offline access)
                    localStorage.setItem(userWishlistKey, JSON.stringify(userWishlist));
                    
                    // Try to sync with MongoDB
                    if (typeof saveWishlistToMongo === 'function') {
                        try {
                            const result = await saveWishlistToMongo(userId, userWishlist);
                            if (result.success) {
                                console.log('âœ… Wishlist synced to MongoDB:', userWishlist.length);
                            } else {
                                console.log('MongoDB wishlist sync failed, localStorage saved:', result.error);
                            }
                        } catch (mongoError) {
                            console.log('MongoDB wishlist sync failed, localStorage saved:', mongoError.message);
                        }
                    } else {
                        // Fallback: direct API call
                        try {
                            const response = await fetch('https://my-backend-1-jk7w.onrender.com/api/save', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    userId: userId,
                                    wishlist: userWishlist,
                                    type: 'wishlist',
                                    timestamp: new Date()
                                })
                            });
                            
                            if (response.ok) {
                                console.log('âœ… Wishlist synced to MongoDB via API:', userWishlist.length);
                            } else {
                                console.log('MongoDB wishlist sync via API failed, localStorage saved');
                            }
                        } catch (apiError) {
                            console.log('MongoDB wishlist API sync failed, localStorage saved:', apiError.message);
                        }
                    }
                } else {
                    // Guest wishlist (stored in localStorage only)
                    localStorage.setItem('guestWishlist', JSON.stringify(userWishlist));
                    console.log('â¤ï¸ Guest wishlist saved to localStorage:', userWishlist.length);
                }
            } catch (error) {
                console.error('âŒ Error saving user wishlist:', error);
                // Always save to localStorage as fallback
                if (userAuth.isAuthenticated()) {
                    const userId = userState.currentUser.id;
                    const userWishlistKey = `wishlist_${userId}`;
                    localStorage.setItem(userWishlistKey, JSON.stringify(userWishlist));
                } else {
                    localStorage.setItem('guestWishlist', JSON.stringify(userWishlist));
                }
            }
        }

        // Update wishlist count
        async function updateWishlistCount() {
            try {
                const userWishlist = await getUserWishlist();
                const wishlistCount = document.getElementById('wishlistCount');
                if (wishlistCount) {
                    wishlistCount.textContent = userWishlist.length;
                    wishlistCount.style.display = userWishlist.length > 0 ? 'flex' : 'none';
                    
                    // Add animation when count changes
                    wishlistCount.classList.add('wishlist-badge-update');
                    setTimeout(() => {
                        wishlistCount.classList.remove('wishlist-badge-update');
                    }, 600);
                }
                
                // Refresh all wishlist buttons on the page
                refreshWishlistButtons();
            } catch (error) {
                console.error('âŒ Error updating wishlist count:', error);
            }
        }

        // Track wishlist activity for analytics
        function trackWishlistActivity(productId, action) {
            const activity = {
                userId: userAuth.isAuthenticated() ? userState.currentUser.id : 'guest',
                productId: productId,
                action: action, // 'add' or 'remove'
                timestamp: new Date().toISOString()
            };
            
            const wishlistActivity = JSON.parse(localStorage.getItem('wishlistActivity') || '[]');
            wishlistActivity.push(activity);
            
            // Keep only last 100 activities per user
            const userActivity = wishlistActivity.filter(a => a.userId === activity.userId).slice(-100);
            const otherActivity = wishlistActivity.filter(a => a.userId !== activity.userId);
            localStorage.setItem('wishlistActivity', JSON.stringify([...userActivity, ...otherActivity]));
        }

        // Animate wishlist icon
        function animateWishlistIcon() {
            const wishlistIcon = document.querySelector('.fa-heart').parentElement;
            wishlistIcon.style.transform = 'scale(1.2)';
            wishlistIcon.style.transition = 'transform 0.3s';

            setTimeout(() => {
                wishlistIcon.style.transform = 'scale(1)';
            }, 300);
        }

        // Move item from wishlist to cart
        function moveToCart(productId) {
            if (isInWishlist(productId)) {
                addToCart(productId);
                removeFromWishlist(productId);
                showToast('Moved from wishlist to cart!', 'success');
                console.log('ðŸ›’ Moved item from wishlist to cart');
            }
        }

        // Clear entire wishlist
        function clearWishlist() {
            if (confirm('Are you sure you want to clear your entire wishlist?')) {
                const userWishlist = getUserWishlist();
                const itemCount = userWishlist.length;
                userWishlist.length = 0; // Clear the array
                saveUserWishlist(userWishlist);
                updateWishlistCount();
                closeModal('wishlistModal');
                showToast(`Cleared ${itemCount} items from wishlist`, 'info');
                console.log('ðŸ§¹ Wishlist cleared successfully');
            }
        }

        // Add all wishlist items to cart
        function addAllWishlistToCart() {
            const userWishlist = getUserWishlist();
            
            if (userWishlist.length === 0) {
                showToast('Your wishlist is empty', 'warning');
                return;
            }
            
            let addedCount = 0;
            let skippedCount = 0;
            
            userWishlist.forEach(item => {
                // Check if product is still available
                const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
                const registeredSellerEmails = new Set(registeredSellers.map(s => s.email));
                
                const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
                const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
                
                const allApprovedProducts = [
                    ...adminProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail)),
                    ...sellerProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail))
                ];
                
                // Remove duplicates for validation
                const uniqueProducts = [];
                const seenIds = new Set();
                
                allApprovedProducts.forEach(product => {
                    if (!seenIds.has(product.id)) {
                        seenIds.add(product.id);
                        uniqueProducts.push(product);
                    }
                });
                
                const product = uniqueProducts.find(p => p.id === item.id);
                
                if (product) {
                    addToCart(item.id);
                    addedCount++;
                } else {
                    skippedCount++;
                }
            });
            
            if (addedCount > 0) {
                showToast(`Added ${addedCount} items to cart${skippedCount > 0 ? ` (${skippedCount} items no longer available)` : ''}`, 'success');
                
                // Clear wishlist after successful addition
                setTimeout(() => {
                    clearWishlist();
                }, 2000);
            } else {
                showToast('No items could be added to cart', 'error');
            }
            
            console.log(`ðŸ›’ Added ${addedCount} wishlist items to cart, ${skippedCount} skipped`);
        }

        // Animate wishlist icon
        function animateWishlistIcon() {
            const wishlistIcon = document.querySelector('.fa-heart');
            if (wishlistIcon) {
                const parent = wishlistIcon.parentElement;
                parent.style.transform = 'scale(1.2)';
                parent.style.transition = 'transform 0.3s';

                setTimeout(() => {
                    parent.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Track wishlist activity for analytics
        function trackWishlistActivity(productId, action) {
            const activity = {
                userId: currentUser?.id || 'guest',
                productId: productId,
                action: action, // 'add' or 'remove'
                timestamp: new Date().toISOString()
            };
            
            const wishlistActivity = JSON.parse(localStorage.getItem('wishlistActivity') || '[]');
            wishlistActivity.push(activity);
            
            // Keep only last 100 activities per user
            const userActivity = wishlistActivity.filter(a => a.userId === activity.userId).slice(-100);
            const otherActivity = wishlistActivity.filter(a => a.userId !== activity.userId);

// Message Seller functionality
let currentSeller = null;

async function messageSeller(productId, sellerEmail, sellerName) {
    currentSeller = {
        productId: productId,
        email: sellerEmail,
        name: sellerName
    };
    
    // Set seller info in modal
    document.getElementById('sellerName').textContent = sellerName;
    document.getElementById('sellerEmail').textContent = sellerEmail;
    
    // Check if user is logged in
    if (!userAuth.isAuthenticated()) {
        showToast('Please login to message sellers', 'warning');
        window.location.href = 'login.html';
        return;
    }
    
    // Open message modal
    openModal('messageModal');
}

async function sendMessage() {
    const subject = document.getElementById('messageSubject').value.trim();
    const content = document.getElementById('messageContent').value.trim();
    
    if (!userAuth.isAuthenticated()) {
        showToast('Please login to send messages', 'warning');
        return;
    }
    
    if (!subject || !content) {
        showToast('Please fill in all fields', 'warning');
        return;
    }
    
    try {
        const response = await fetch('https://my-backend-1-jk7w.onrender.com/api/messages/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                senderEmail: userState.currentUser.email,
                receiverEmail: currentSeller.email,
                subject: subject,
                content: content,
                productId: currentSeller.productId
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Clear form and close modal
            document.getElementById('messageSubject').value = '';
            document.getElementById('messageContent').value = '';
            closeModal('messageModal');
            
            showToast('Message sent successfully!', 'success');
            
            // Open chat for immediate conversation
            openChat(currentSeller.email, currentSeller.name);
        } else {
            showToast('Failed to send message: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error sending message:', error);
        showToast('Failed to send message. Please try again.', 'error');
    }
}

function openChat(sellerEmail, sellerName) {
    if (!userAuth.isAuthenticated()) {
        showToast('Please login to chat', 'warning');
        return;
    }
    
    // Set chat header
    document.getElementById('chatSellerName').textContent = sellerName;
    
    // Load conversation
    loadConversation(userState.currentUser.email, sellerEmail);
    
    // Start auto-refresh for new messages
    startMessageRefresh(userState.currentUser.email, sellerEmail);
    
    // Open chat modal
    openModal('chatModal');
}

async function loadConversation(userEmail, sellerEmail) {
    try {
        const response = await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/conversation/${userEmail}/${sellerEmail}`);
        const result = await response.json();
        
        if (result.success) {
            displayChatMessages(result.conversation);
        }
    } catch (error) {
        console.error('Error loading conversation:', error);
    }
}

function displayChatMessages(conversation) {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML = '';
    
    if (conversation && conversation.messages) {
        conversation.messages.forEach(msg => {
            addChatMessageToUI(msg.sender, msg.content, msg.timestamp, msg.sender === userState.currentUser.email);
        });
    } else {
        chatMessages.innerHTML = '<div class="no-messages">No messages yet. Start the conversation!</div>';
    }
    
    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addChatMessageToUI(sender, content, timestamp, isSent) {
    const chatMessages = document.getElementById('chatMessages');
    
    // Remove "no messages" message if it exists
    const noMessagesDiv = chatMessages.querySelector('.no-messages');
    if (noMessagesDiv) {
        noMessagesDiv.remove();
    }
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${isSent ? 'sent' : 'received'}`;
    
    const time = new Date(timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    messageDiv.innerHTML = `
        <div class="message-bubble">${content}</div>
        <div class="message-time">${time}</div>
    `;
    
    chatMessages.appendChild(messageDiv);
    
    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;
}
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            if (!currentUser) {
                showToast('Please login to send messages', 'warning');
                return;
            }
            
            if (!content) {
                showToast('Please type a message', 'warning');
                return;
            }
            
            // Get current chat participants
            const sellerName = document.getElementById('chatSellerName').textContent;
            const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
            const conversation = conversations.find(c => 
                c.participants.some(p => p.name === sellerName) && 
                c.participants.some(p => p.email === currentUser.email)
            );
            
            if (conversation) {
                // Add message to conversation
                const message = {
                    id: Date.now(),
                    sender: currentUser.email,
                    content: content,
                    timestamp: new Date().toISOString()
                };
                
                conversation.messages.push(message);
                conversation.lastMessage = content;
                conversation.lastTimestamp = message.timestamp;
                
                localStorage.setItem('conversations', JSON.stringify(conversations));
                
                // Add to UI
                addChatMessageToUI(currentUser.email, content, message.timestamp, true);
                
                // Clear input
                chatInput.value = '';
                
                // Simulate seller response (for demo purposes)
                setTimeout(() => {
                    const sellerResponse = {
                        id: Date.now() + 1,
                        sender: conversation.participants.find(p => p.email !== currentUser.email).email,
                        content: "Thanks for your message! I'll get back to you soon.",
                        timestamp: new Date().toISOString()
                    };
                    
                    conversation.messages.push(sellerResponse);
                    conversation.lastMessage = sellerResponse.content;
                    conversation.lastTimestamp = sellerResponse.timestamp;
                    
                    localStorage.setItem('conversations', JSON.stringify(conversations));
                    
                    addChatMessageToUI(sellerResponse.sender, sellerResponse.content, sellerResponse.timestamp, false);
                }, 2000);
            }
        }

        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const content = chatInput.value.trim();
            
            if (!content || !userAuth.isAuthenticated() || !currentSeller) {
                return;
            }
            
            try {
                const response = await fetch('https://my-backend-1-jk7w.onrender.com/api/messages/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        senderEmail: userState.currentUser.email,
                        receiverEmail: currentSeller.email,
                        content: content,
                        subject: currentConversation?.messages[0]?.subject || 'Chat Message',
                        productId: currentSeller.productId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Clear input
                    chatInput.value = '';
                    
                    // Add message to UI immediately for better UX
                    addChatMessageToUI(userState.currentUser.email, content, new Date(), true);
                    
                    // Update message count
                    updateMessageCount();
                } else {
                    showToast('Failed to send message: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error sending chat message:', error);
                showToast('Failed to send message. Please try again.', 'error');
            }
        }

        function startMessageRefresh(userEmail, sellerEmail) {
            // Clear any existing interval
            if (messageRefreshInterval) {
                clearInterval(messageRefreshInterval);
            }
            
            // Refresh messages every 5 seconds
            messageRefreshInterval = setInterval(() => {
                loadConversation(userEmail, sellerEmail);
            }, 5000);
        }

        function stopMessageRefresh() {
            if (messageRefreshInterval) {
                clearInterval(messageRefreshInterval);
                messageRefreshInterval = null;
            }
        }

        // Override closeModal to stop message refresh when chat modal is closed
        const originalCloseModal = window.closeModal;
        window.closeModal = function(modalId) {
            if (modalId === 'chatModal') {
                stopMessageRefresh();
            }
            return originalCloseModal(modalId);
        };

        // Enhanced message count update using MongoDB
        async function updateMessageCount() {
            if (!userAuth.isAuthenticated()) return;
            
            try {
                const response = await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/unread/${userState.currentUser.email}`);
                const result = await response.json();
                
                if (result.success) {
                    const messageCountElement = document.getElementById('messageCount');
                    if (messageCountElement) {
                        messageCountElement.textContent = result.unreadCount;
                        messageCountElement.style.display = result.unreadCount > 0 ? 'flex' : 'none';
                    }
                    
                    console.log(`ðŸ“¬ Message count updated: ${result.unreadCount} unread messages for ${userState.currentUser.email}`);
                }
            } catch (error) {
                console.error('Error updating message count:', error);
                // Fallback to localStorage if MongoDB is not available
                const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
                const userConversations = conversations.filter(conv => {
                    return conv.participants && conv.participants.some(p => p.email === userState.currentUser.email);
                });
                const unreadCount = userConversations.reduce((sum, conv) => sum + (conv.unreadCount || 0), 0);
                
                const messageCountElement = document.getElementById('messageCount');
                if (messageCountElement) {
                    messageCountElement.textContent = unreadCount;
                    messageCountElement.style.display = unreadCount > 0 ? 'flex' : 'none';
                }
            }
        }

        // Enhanced mark all messages as read using MongoDB
        async function markAllMessagesAsRead() {
            if (!userAuth.isAuthenticated()) {
                showToast('Please login to mark messages as read', 'warning');
                return;
            }
            
            try {
                // Get all conversations for the user
                const response = await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/conversations/${userState.currentUser.email}`);
                const result = await response.json();
                
                if (result.success) {
                    // Mark each conversation as read
                    const promises = result.conversations.map(async (conv) => {
                        await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/read/${conv.id}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                userEmail: userState.currentUser.email
                            })
                        });
                    });
                    
                    await Promise.all(promises);
                }
                
                // Update message count display
                updateMessageCount();
                
                showToast('All messages marked as read', 'success');
                console.log(`âœ… All messages marked as read for ${userState.currentUser.email}`);
            } catch (error) {
                console.error('Error marking messages as read:', error);
                showToast('Failed to mark messages as read', 'error');
            }
        }

        function showCareerNotification() {
            showToast('Thank you for your interest! We\'ll notify you when new opportunities become available.', 'success');
        }

        // Update cart count
        function updateCartCount() {
            const userCart = getUserCart();
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                cartCount.textContent = userCart.length;
                cartCount.style.display = userCart.length > 0 ? 'flex' : 'none';
            }
        }

        // Activity tracking functions
        function trackProductView(productId, productName) {
            if (!userAuth.isAuthenticated()) return;
            
            const recentViews = JSON.parse(localStorage.getItem('recentViews') || '[]');
            const userId = userState.currentUser.id;
            
            // Remove existing views for this product by this user
            const filteredViews = recentViews.filter(view => !(view.userId === userId && view.productId === productId));
            
            // Add new view
            filteredViews.push({
                userId: userId,
                productId: productId,
                productName: productName,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 10 views per user
            const userViews = filteredViews.filter(view => view.userId === userId).slice(-10);
            const otherViews = filteredViews.filter(view => view.userId !== userId);
            
            localStorage.setItem('recentViews', JSON.stringify([...otherViews, ...userViews]));
        }

        function trackSearch(searchTerm) {
            if (!userAuth.isAuthenticated()) return;
            
            const searches = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            const userId = userState.currentUser.id;
            
            // Add new search
            searches.push({
                userId: userId,
                term: searchTerm,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 50 searches per user
            const userSearches = searches.filter(search => search.userId === userId).slice(-50);
            const otherSearches = searches.filter(search => search.userId !== userId);
            
            localStorage.setItem('searchHistory', JSON.stringify([...otherSearches, ...userSearches]));
        }

        // Update existing search function to include tracking
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                // Track the search
                trackSearch(searchTerm);
                
                const results = products.filter(p => 
                    p.title.toLowerCase().includes(searchTerm) ||
                    p.category.toLowerCase().includes(searchTerm)
                );
                
                const grid = document.getElementById('productsGrid');
                if (results.length > 0) {
                    grid.innerHTML = results.map(product => createProductCard(product)).join('');
                    showToast(`Found ${results.length} products for "${searchTerm}"`, 'success');
                    // Refresh wishlist buttons after search results are loaded
                    refreshWishlistButtonsAfterLoad();
                } else {
                    grid.innerHTML = '<div class="loading">No products found for your search.</div>';
                    showToast('No products found', 'warning');
                }
            }
        }

        // Login modal function - DELETED for replacement

        // Seller login function - DELETED for replacement

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            console.log(`ðŸšª Closing modal: ${modalId}`);
            try {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    console.log(`âœ… Modal ${modalId} closed successfully`);
                    
                    // Reset specific modals to prevent state issues
                    if (modalId === 'registerModal') {
                        setTimeout(() => {
                            resetRegisterModal();
                        }, 300); // Wait for close animation
                    } else if (modalId === 'loginModal') {
                        setTimeout(() => {
                            resetLoginModal();
                        }, 300);
                    }
                } else {
                    console.warn(`âš ï¸ Modal ${modalId} not found for closing`);
                }
            } catch (error) {
                console.error(`âŒ Error closing modal ${modalId}:`, error);
            }
        }

        // Reset login modal function - DELETED for replacement

        function switchToRegister() {
            console.log('ðŸ”„ Switching to register modal');
            try {
                closeModal('loginModal');
                setTimeout(() => {
                    showRegisterModal();
                }, 100);
            } catch (error) {
                console.error('âŒ Error switching to register:', error);
                showToast('Error switching to registration', 'error');
            }
        }

        // Switch to login function - DELETED for replacement

        function goToHomeFromRegister() {
            console.log('ðŸ  Going to home from register modal');
            try {
                // Close modal and reset it
                closeModal('registerModal');
                resetRegisterModal();
                // Scroll to top of page
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('Welcome to EcoLoop Kenya!', 'success');
            } catch (error) {
                console.error('âŒ Error going to home from register:', error);
                // Fallback: just close modal and redirect to top
                closeModal('registerModal');
                resetRegisterModal();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function resetRegisterModal() {
            console.log('ðŸ”„ Resetting register modal state');
            try {
                // Reset form
                const form = document.getElementById('registerForm');
                if (form) {
                    form.reset();
                }
                
                // Clear any error states
                const inputs = document.querySelectorAll('#registerModal input');
                inputs.forEach(input => {
                    input.classList.remove('error');
                    input.style.borderColor = '';
                });
                
                // Remove any existing error messages
                const errorMessages = document.querySelectorAll('#registerModal .error-message');
                errorMessages.forEach(msg => msg.remove());
                
                console.log('âœ… Register modal reset successfully');
            } catch (error) {
                console.error('âŒ Error resetting register modal:', error);
            }
        }

        function showForgotPassword() {
            showToast('Password reset link sent to your email!', 'success');
        }

        function goToSellerDashboard() {
            window.location.href = 'admin/seller-dashboard.html';
        }

        // Load user data from Firestore
        function loadUserData() {
            if (!currentUser) return;
            
            // Load user cart
            db.collection('users').doc(currentUser.id).get()
                .then(doc => {
                    if (doc.exists && doc.data().cart) {
                        cart = doc.data().cart || [];
                        updateCartCount();
                    }
                })
                .catch(error => {
                    console.error('Error loading user data:', error);
                });
            
            // Load user wishlist
            db.collection('users').doc(currentUser.id).get()
                .then(doc => {
                    if (doc.exists && doc.data().wishlist) {
                        wishlist = doc.data().wishlist || [];
                        updateWishlistCount();
                    }
                })
                .catch(error => {
                    console.error('Error loading wishlist:', error);
                });
        }

        // Save user data to Firestore
        function saveUserData() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.id).update({
                cart: cart,
                wishlist: wishlist,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            })
            .catch(error => {
                console.error('Error saving user data:', error);
            });
        }

        // Initialize authentication state
        function initializeAuth() {
            // Check for existing user session
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateAuthUI();
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('sellerData');
            sessionStorage.removeItem('currentUser');
            sessionStorage.removeItem('sellerData');
            showToast('Logged out successfully', 'success');
            updateAuthUI();
            
            // Switch to guest mode
            switchWebsiteMode('guest');
        }

        // Handle logout (alias for logout)
        function handleLogout() {
            logout();
        }

        // Handle seller registration - MONGODB INTEGRATION
        async function handleSellerRegister(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('sellerFullName').value;
            const email = document.getElementById('sellerEmail').value;
            const password = document.getElementById('sellerPassword').value;
            const businessName = document.getElementById('sellerBusinessName').value;
            const phoneNumber = document.getElementById('sellerPhone').value;
            const location = document.getElementById('sellerLocation').value;
            
            if (password.length < 6) {
                showToast('Password must be at least 6 characters!', 'error');
                return;
            }
            
            try {
                // First check MongoDB for existing email
                const existingUser = await getUserFromMongo(email);
                if (existingUser) {
                    showToast('An account with this email already exists!', 'error');
                    return;
                }
                
                // Also check localStorage for existing users (fallback)
                const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                
                if (registeredSellers.find(s => s.email === email) || registeredUsers.find(u => u.email === email)) {
                    showToast('An account with this email already exists!', 'error');
                    return;
                }
                
                // Create new seller
                const newSeller = {
                    id: Date.now(),
                    name: fullName,
                    email: email,
                    password: password, // In real app, this should be hashed
                    business: businessName,
                    phone: phoneNumber,
                    location: location,
                    createdAt: new Date().toISOString(),
                    status: 'pending', // Requires admin approval
                    type: 'seller'
                };
                
                // Save to MongoDB
                const mongoResult = await saveUserToMongo(newSeller);
                if (mongoResult && mongoResult.success) {
                    console.log('âœ… Seller saved to MongoDB:', mongoResult.id);
                }
                
                // Also save to localStorage for backup
                registeredSellers.push(newSeller);
                localStorage.setItem('registeredSellers', JSON.stringify(registeredSellers));
                
                console.log('New seller registered:', newSeller);
                
                closeModal('sellerRegisterModal');
                showToast('Registration successful! Your seller account is pending admin approval. You will be notified once approved.', 'success');
                
                // Clear form
                document.getElementById('sellerRegisterForm').reset();
                
                // Redirect to home page after successful registration
                setTimeout(() => {
                    window.location.href = '#home';
                    showToast('ðŸ“ Your seller account is now pending admin approval.', 'info');
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Seller registration error:', error);
                
                // Fallback to localStorage only
                const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                
                if (registeredSellers.find(s => s.email === email) || registeredUsers.find(u => u.email === email)) {
                    showToast('An account with this email already exists!', 'error');
                    return;
                }
                
                const newSeller = {
                    id: Date.now(),
                    name: fullName,
                    email: email,
                    password: password,
                    business: businessName,
                    phone: phoneNumber,
                    location: location,
                    createdAt: new Date().toISOString(),
                    status: 'pending',
                    type: 'seller'
                };
                
                registeredSellers.push(newSeller);
                localStorage.setItem('registeredSellers', JSON.stringify(registeredSellers));
                
                console.log('New seller registered (localStorage fallback):', newSeller);
                
                closeModal('sellerRegisterModal');
                showToast('Registration successful! Your seller account is pending admin approval.', 'success');
                document.getElementById('sellerRegisterForm').reset();
                
                // Redirect to home page after successful registration
                setTimeout(() => {
                    window.location.href = '#home';
                    showToast('ðŸ“ Your seller account is now pending admin approval.', 'info');
                }, 1000);
            }
        }

        // Show seller registration modal
        function showSellerRegisterModal() {
            console.log('ðŸª showSellerRegisterModal() called');
            const modal = document.getElementById('sellerRegisterModal');
            if (modal) {
                modal.classList.add('active');
                console.log('âœ… Seller registration modal opened successfully');
            } else {
                console.error('âŒ Seller registration modal not found!');
            }
        }

        // Handle logout (deprecated - use performLogout instead)
        function handleLogout() {
            console.log('âš ï¸ Using deprecated handleLogout - switching to performLogout');
            performLogout();
        }

        // Show toast notification
        // Professional toast notification system
        function showToast(message, type = 'success', customIcon = null) {
            // Remove existing toast if any
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create new toast element with enhanced styling
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Add professional icon based on type
            let icon = '';
            if (customIcon) {
                icon = `<i class="${customIcon}"></i>`;
            } else {
                switch(type) {
                    case 'success':
                        icon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-times-circle"></i>';
                        break;
                    case 'warning':
                        icon = '<i class="fas fa-exclamation-triangle"></i>';
                        break;
                    case 'info':
                        icon = '<i class="fas fa-info-circle"></i>';
                        break;
                    case 'cart':
                        icon = '<i class="fas fa-shopping-cart"></i>';
                        break;
                    case 'wishlist':
                        icon = '<i class="fas fa-heart"></i>';
                        break;
                    default:
                        icon = '<i class="fas fa-bell"></i>';
                }
            }
            
            // Enhanced HTML with better structure
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-icon">${icon}</span>
                    <span class="toast-message">${message}</span>
                </div>
            `;
            
            // Add to body
            document.body.appendChild(toast);
            
            // Trigger entrance animation
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Auto hide after 0.7 seconds (700ms) for all notifications
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('hide');
                
                // Remove from DOM after exit animation
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 700);
        }

        // Search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Chat input Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        });

        // Account Dropdown Functions
        let accountDropdownVisible = false;

        function initializeAccount() {
            // Get current user from localStorage
            const buyerData = localStorage.getItem('currentUser');
            const sellerData = localStorage.getItem('sellerData');
            
            if (sellerData) {
                currentUser = JSON.parse(sellerData);
                currentUser.type = 'seller';
            } else if (buyerData) {
                currentUser = JSON.parse(buyerData);
                currentUser.type = 'buyer';
            } else {
                // Create demo user for testing
                currentUser = {
                    id: 1,
                    name: 'Demo User',
                    email: 'demo@user.com',
                    type: 'buyer',
                    createdAt: new Date().toISOString()
                };
            }
            
            console.log('ðŸ‘¤ Account initialized for:', currentUser.name);
            
            // Refresh wishlist buttons when user account is initialized
            setTimeout(() => {
                refreshWishlistButtons();
                updateWishlistCount();
            }, 500);
        }

        function toggleAccountDropdown() {
            const dropdown = document.getElementById('accountDropdown');
            accountDropdownVisible = !accountDropdownVisible;
            
            if (accountDropdownVisible) {
                dropdown.classList.add('show');
                updateAccountDetails();
            } else {
                dropdown.classList.remove('show');
            }
        }

        function updateAccountDetails() {
            if (!currentUser) return;
            
            // Update basic account info
            const initials = (currentUser.name || 'User').split(' ').map(n => n[0]).join('').toUpperCase();
            
            document.getElementById('accountAvatarLarge').textContent = initials;
            document.getElementById('accountNameLarge').textContent = currentUser.name || 'User';
            document.getElementById('accountEmail').textContent = currentUser.email || 'No email';
            document.getElementById('accountTypeBadge').textContent = currentUser.type === 'seller' ? 'Seller' : 'Buyer';
            document.getElementById('accountUserId').textContent = currentUser.id || '-';
            
            // Format member since date
            const memberSince = currentUser.createdAt ? 
                new Date(currentUser.createdAt).toLocaleDateString() : 
                'Unknown';
            document.getElementById('accountMemberSince').textContent = memberSince;
            
            // Show/hide seller section
            const sellerSection = document.getElementById('sellerSection');
            if (currentUser.type === 'seller') {
                sellerSection.style.display = 'block';
                document.getElementById('accountBusinessName').textContent = currentUser.business || 'Not specified';
                document.getElementById('accountPhone').textContent = currentUser.phone || 'Not specified';
                document.getElementById('accountLocation').textContent = currentUser.location || 'Not specified';
            } else {
                sellerSection.style.display = 'none';
            }
            
            // Update shopping statistics
            updateShoppingStats();
        }

        function updateShoppingStats() {
            // Get user's shopping data from localStorage
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            // Filter by current user
            const userOrders = orders.filter(order => order.userId === currentUser.id);
            const userWishlist = wishlist.filter(item => item.userId === currentUser.id);
            const userReviews = reviews.filter(review => review.userId === currentUser.id);
            const userCart = cart.filter(item => item.userId === currentUser.id);
            
            // Calculate statistics
            const totalSpent = userOrders.reduce((sum, order) => sum + (order.total || 0), 0);
            const itemsPurchased = userOrders.reduce((sum, order) => sum + (order.items?.length || 0), 0);
            
            // Update display
            document.getElementById('statOrders').textContent = userOrders.length;
            document.getElementById('statWishlist').textContent = userWishlist.length;
            document.getElementById('statReviews').textContent = userReviews.length;
            document.getElementById('accountTotalSpent').textContent = `KES ${totalSpent.toLocaleString()}`;
            document.getElementById('accountItemsPurchased').textContent = itemsPurchased;
            
            // Update header counts
            document.getElementById('cartCount').textContent = userCart.length;
            document.getElementById('wishlistCount').textContent = userWishlist.length;
            
            // Get recent activity
            const recentViews = JSON.parse(localStorage.getItem('recentViews') || '[]');
            const userRecentViews = recentViews.filter(view => view.userId === currentUser.id);
            const lastViewed = userRecentViews.length > 0 ? userRecentViews[0].productName : 'No items';
            document.getElementById('accountLastViewed').textContent = lastViewed;
            
            const searches = JSON.parse(localStorage.getItem('searches') || '[]');
            const userSearches = searches.filter(search => search.userId === currentUser.id);
            document.getElementById('accountSearches').textContent = userSearches.length;
        }

        function updateAccountStats() {
            // Update stats periodically
            setInterval(() => {
                if (accountDropdownVisible) {
                    updateShoppingStats();
                }
            }, 5000);
        }

        function viewOrders() {
            showToast('Opening orders...', 'info');
            toggleAccountDropdown();
            
            // In a real application, this would navigate to orders page
            // For now, we'll show a message
            setTimeout(() => {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const userOrders = orders.filter(order => order.userId === currentUser.id);
                showToast(`You have ${userOrders.length} order(s)`, 'success');
            }, 1000);
        }

        function viewWishlist() {
            showToast('Opening wishlist...', 'info');
            toggleAccountDropdown();
            
            // In a real application, this would navigate to wishlist page
            // For now, we'll show a message
            setTimeout(() => {
                const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
                const userWishlist = wishlist.filter(item => item.userId === currentUser.id);
                showToast(`You have ${userWishlist.length} item(s) in wishlist`, 'success');
            }, 1000);
        }

        function editProfile() {
            showToast('Profile editing coming soon!', 'info');
            toggleAccountDropdown();
            
            // In a real application, this would open profile edit modal
        }

        function viewSettings() {
            showToast('Settings panel coming soon!', 'info');
            toggleAccountDropdown();
            
            // In a real application, this would open settings panel
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear current user session
                localStorage.removeItem('currentUser');
                localStorage.removeItem('sellerData');
                
                showToast('Logging out...', 'info');
                
                // Redirect to login page based on user type
                setTimeout(() => {
                    if (currentUser && currentUser.type === 'seller') {
                        window.location.href = 'seller-login.html';
                    } else {
                        window.location.reload(); // Reload to show login/register
                    }
                }, 1500);
            }
        }

        // Click outside to close account dropdown
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('accountDropdown');
            const accountButton = e.target.closest('.user-account');
            
            if (accountDropdownVisible && !dropdown.contains(e.target) && !accountButton) {
                toggleAccountDropdown();
            }
        });

        // Open product detail page
        function openProductDetail(productId) {
            // Store current category for back navigation
            const activeFilter = document.querySelector('.filter-tab.active')?.textContent || 'all';
            sessionStorage.setItem('lastCategory', activeFilter);
            
            // Track product view
            trackProductView(productId);
            
            // Open product detail page in new tab
            window.open(`product-detail.html?id=${productId}`, '_blank');
        }

        // Track product views for recent activity
        function trackProductView(productId) {
            const recentViews = JSON.parse(localStorage.getItem('recentViews') || '[]');
            const product = products.find(p => p.id === productId);
            
            if (product && currentUser) {
                // Remove existing view of this product
                const filteredViews = recentViews.filter(view => 
                    !(view.userId === currentUser.id && view.productId === productId)
                );
                
                // Add new view at the beginning
                filteredViews.unshift({
                    userId: currentUser.id,
                    productId: productId,
                    productName: product.title || product.name || 'Unknown Product',
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 10 views per user
                const userViews = filteredViews.filter(view => view.userId === currentUser.id).slice(0, 10);
                const otherViews = filteredViews.filter(view => view.userId !== currentUser.id);
                
                localStorage.setItem('recentViews', JSON.stringify([...userViews, ...otherViews]));
            }
        }

        // Track searches
        function trackSearch(query) {
            const searches = JSON.parse(localStorage.getItem('searches') || '[]');
            
            if (currentUser && query.trim()) {
                searches.push({
                    userId: currentUser.id,
                    query: query.trim(),
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('searches', JSON.stringify(searches));
            }
        }

        function goToSellerDashboard() {
            showToast('ðŸš€ Redirecting to Seller Dashboard...', 'success');
            
            // Add a small delay for better UX
            setTimeout(() => {
                window.open('admin/seller-dashboard.html', '_blank');
            }, 1000);
        }

        // Help Modal Functions
        function showHelpModal() {
            document.getElementById('helpModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Contact Modal Functions
        function showContactModal() {
            // Close help modal if open
            const helpModal = document.getElementById('helpModal');
            if (helpModal.style.display === 'block') {
                helpModal.style.display = 'none';
            }
            
            document.getElementById('contactModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function submitContactForm(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const contactData = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                subject: formData.get('subject'),
                message: formData.get('message'),
                timestamp: new Date().toISOString()
            };
            
            // Store contact form submissions in localStorage
            const submissions = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
            submissions.push(contactData);
            localStorage.setItem('contactSubmissions', JSON.stringify(submissions));
            
            // Show success message
            showToast('âœ… Your message has been sent successfully! We\'ll get back to you soon.', 'success');
            
            // Reset form and close modal
            event.target.reset();
            closeModal('contactModal');
            
            // Log for debugging (in production, this would send to server)
            console.log('Contact form submission:', contactData);
        }
    </script>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close" onclick="closeModal('helpModal')">&times;</button>
            <h2 class="modal-title"><i class="fas fa-question-circle"></i> Help Center</h2>
            
            <div class="help-content">
                <div class="help-section">
                    <h3><i class="fas fa-phone"></i> Contact Information</h3>
                    <div class="contact-details">
                        <p><strong>Phone:</strong> <a href="tel:+254705424364">+254 705 424364</a></p>
                        <p><strong>Email:</strong> <a href="mailto:pmuiruri9657@gmail.com">pmuiruri9657@gmail.com</a></p>
                        <p><strong>Hours:</strong> Monday - Friday, 9:00 AM - 6:00 PM</p>
                    </div>
                </div>

                <div class="help-section">
                    <h3><i class="fas fa-shopping-cart"></i> For Buyers</h3>
                    <ul>
                        <li>How to place an order</li>
                        <li>Payment methods accepted</li>
                        <li>Shipping and delivery</li>
                        <li>Returns and refunds</li>
                        <li>Track your order</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3><i class="fas fa-store"></i> For Sellers</h3>
                    <ul>
                        <li>How to register as a seller</li>
                        <li>Listing products</li>
                        <li>Managing orders</li>
                        <li>Payment and payouts</li>
                        <li>Seller dashboard guide</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3><i class="fas fa-shield-alt"></i> Safety & Security</h3>
                    <ul>
                        <li>Safe buying tips</li>
                        <li>How to avoid scams</li>
                        <li>Report suspicious activity</li>
                        <li>Account security</li>
                    </ul>
                </div>

                <div class="help-actions">
                    <button class="btn btn-primary" onclick="showContactModal()">
                    
                    
                    
                        <i class="fas fa-envelope"></i> Contact Support
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('helpModal')">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('contactModal')">&times;</button>
            <h2 class="modal-title"><i class="fas fa-envelope"></i> Contact Us</h2>
            
            <form class="contact-form" onsubmit="submitContactForm(event)">
                <div class="form-group">
                    <label for="contactName">Your Name *</label>
                    <input type="text" id="contactName" name="name" required>
                </div>

                <div class="form-group">
                    <label for="contactEmail">Your Email *</label>
                    <input type="email" id="contactEmail" name="email" required>
                </div>

                <div class="form-group">
                    <label for="contactPhone">Phone Number</label>
                    <input type="tel" id="contactPhone" name="phone" placeholder="+254 XXX XXX XXX">
                </div>

                <div class="form-group">
                    <label for="contactSubject">Subject *</label>
                    <select id="contactSubject" name="subject" required>
                        <option value="">Select a subject</option>
                        <option value="general">General Inquiry</option>
                        <option value="support">Technical Support</option>
                        <option value="billing">Billing Question</option>
                        <option value="seller">Seller Support</option>
                        <option value="buyer">Buyer Support</option>
                        <option value="report">Report an Issue</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contactMessage">Message *</label>
                    <textarea id="contactMessage" name="message" rows="5" required placeholder="Tell us how we can help you..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('contactModal')">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>

            <div class="contact-info-alt">
                <p><strong>Alternatively, reach out directly:</strong></p>
                <p><i class="fas fa-phone"></i> <a href="tel:+254705424364">+254 705 424364</a></p>
                <p><i class="fas fa-envelope"></i> <a href="mailto:pmuiruri9657@gmail.com">pmuiruri9657@gmail.com</a></p>
            </div>
        </div>
    </div>

    <style>
        /* Help Modal Styles */
        .help-content {
            max-height: 500px;
            overflow-y: auto;
        }

        .help-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section ul {
            margin: 0;
            padding-left: 20px;
        }

        .help-section li {
            margin-bottom: 5px;
            color: #666;
        }

        .contact-details {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .contact-details p {
            margin: 8px 0;
        }

        .contact-details a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .contact-details a:hover {
            text-decoration: underline;
        }

        .help-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        /* Contact Form Styles */
        .contact-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .contact-info-alt {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .contact-info-alt p {
            margin: 5px 0;
        }

        .contact-info-alt a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .contact-info-alt a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .help-actions,
            .form-actions {
                flex-direction: column;
            }
            
            .help-actions .btn,
            .form-actions .btn {
                width: 100%;
            }
        }
    </style>
    
    <script>
        // Global variables
        let products = [];
        let filteredProducts = [];
        let cart = [];
        let wishlist = [];
        let currentUser = null;
        let allProducts = [];

        // No default products - only approved seller products will be shown

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize empty products array - will be populated by approved seller products
            products = [];
            allProducts = [];
            
            // Initialize user session
            initializeAuth();
            
            // Load products (will load approved seller products)
            await loadProducts('all');
            
            // Load categories
            loadCategories();
            
            // Update cart count
            updateCartCount();
            
            // Update wishlist count
            updateWishlistCount();
            
            console.log('âœ… Website initialized - ready for approved seller products');
        });

        // Categories data
        const categories = [
            { name: "Electronics", icon: "fa-microchip", count: 0 },
            { name: "Fashion", icon: "fa-hat-cowboy", count: 0 },
            { name: "Gaming", icon: "fa-dragon", count: 0 },
            { name: "Home & Kitchen", icon: "fa-blender", count: 0 },
            { name: "Sports", icon: "fa-dumbbell", count: 0 },
            { name: "Books", icon: "fa-book-open", count: 0 }
        ];

        // Load categories function
        function loadCategories() {
            const grid = document.getElementById('categoriesGrid');
            if (!grid) return;
            
            grid.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }

        // Create category card HTML
        function createCategoryCard(category) {
            return `
                <div class="category-card" data-category="${category.name}" onclick="filterByCategory('${category.name}')">
                    <div class="category-icon">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${category.count} Products</div>
                </div>
            `;
        }

        // Filter products by category
        function filterByCategory(categoryName) {
            if (categoryName === 'all') {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(p => p.category === categoryName);
            }
            
            const grid = document.getElementById('productsGrid');
            if (filteredProducts.length > 0) {
                grid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
                showToast(`Showing ${filteredProducts.length} products in ${categoryName}`, 'success');
            } else {
                grid.innerHTML = '<div class="loading">No products found in this category.</div>';
                showToast(`No products available in ${categoryName}`, 'warning');
            }
        }

        // Search functionality
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                const results = products.filter(p => 
                    p.title.toLowerCase().includes(searchTerm) ||
                    p.category.toLowerCase().includes(searchTerm) ||
                    p.description.toLowerCase().includes(searchTerm)
                );
                
                const grid = document.getElementById('productsGrid');
                if (results.length > 0) {
                    grid.innerHTML = results.map(product => createProductCard(product)).join('');
                    showToast(`Found ${results.length} products for "${searchTerm}"`, 'success');
                } else {
                    grid.innerHTML = '<div class="loading">No products found for your search.</div>';
                    showToast('No products found', 'warning');
                }
            }
        }


        
        // Help and Contact functions
        function showHelpModal() {
            document.getElementById('helpModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function showContactModal() {
            document.getElementById('helpModal').style.display = 'none';
            document.getElementById('contactModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function submitContactForm(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const contactData = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                subject: formData.get('subject'),
                message: formData.get('message'),
                timestamp: new Date().toISOString()
            };
            
            // Store in localStorage
            const submissions = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
            submissions.push(contactData);
            localStorage.setItem('contactSubmissions', JSON.stringify(submissions));
            
            showToast('Your message has been sent successfully! We\'ll get back to you soon.', 'success');
            event.target.reset();
            document.getElementById('contactModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Search on Enter key
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
        });

        // ========================================
        // NEW USER AUTHENTICATION SYSTEM
        // ========================================

        // Global user state
        let userState = {
            isAuthenticated: false,
            currentUser: null,
            sessionToken: null
        };

        // User Authentication Manager
        class UserAuthManager {
            constructor() {
                this.sessionKey = 'userSession';
                this.usersKey = 'registeredUsers';
                this.init();
            }

            init() {
                console.log('ðŸ” UserAuthManager init() called');
                this.loadSession();
                
                // Only update UI if DOM is ready, otherwise wait for DOMContentLoaded
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        console.log('ðŸ“„ DOM ready - updating UI');
                        this.updateUI();
                    });
                } else {
                    console.log('ðŸ“„ DOM already ready - updating UI immediately');
                    this.updateUI();
                }
                
                console.log('ðŸ” UserAuthManager initialized');
                console.log('ðŸ“Š Auth state after init:', {
                    isAuthenticated: userState.isAuthenticated,
                    currentUser: userState.currentUser?.email || 'none'
                });
            }

            // Load existing session
            loadSession() {
                console.log('ðŸ” Loading session from storage...');
                
                // Check localStorage first (remember me sessions)
                let sessionData = localStorage.getItem(this.sessionKey);
                console.log('ðŸ“¦ localStorage session found:', !!sessionData);
                
                // If not in localStorage, check sessionStorage (non-remember sessions)
                if (!sessionData) {
                    sessionData = sessionStorage.getItem(this.sessionKey);
                    console.log('ðŸ“¦ sessionStorage session found:', !!sessionData);
                }
                
                if (sessionData) {
                    try {
                        const session = JSON.parse(sessionData);
                        console.log('ðŸ” Session data parsed:', session);
                        
                        if (session.token && session.user && this.validateSession(session)) {
                            userState.isAuthenticated = true;
                            userState.currentUser = session.user;
                            userState.sessionToken = session.token;
                            console.log('âœ… User session restored:', userState.currentUser.email);
                        } else {
                            console.log('âŒ Session invalid or expired');
                            this.clearSession();
                        }
                    } catch (error) {
                        console.error('âŒ Invalid session data:', error);
                        this.clearSession();
                    }
                } else {
                    console.log('â„¹ï¸ No session data found - user not logged in');
                }
            }

            // Validate session
            validateSession(session) {
                // Simple validation - check if session is less than 24 hours old
                const sessionAge = Date.now() - session.timestamp;
                return sessionAge < 24 * 60 * 60 * 1000; // 24 hours
            }

            // User login
            async login(email, password, rememberMe = false) {
                try {
                    console.log('ðŸ”‘ Attempting login for:', email);
                    
                    // Get users from storage
                    const users = JSON.parse(localStorage.getItem(this.usersKey) || '[]');
                    
                    // Find user
                    const user = users.find(u => u.email === email && u.password === password);
                    
                    if (!user) {
                        throw new Error('Invalid email or password');
                    }

                    // Create session
                    const sessionToken = this.generateSessionToken();
                    const session = {
                        token: sessionToken,
                        user: {
                            id: user.id,
                            name: user.name,
                            email: user.email,
                            type: user.type,
                            avatar: user.avatar || null,
                            createdAt: user.createdAt || new Date().toISOString(),
                            status: user.status || 'active',
                            phone: user.phone || null,
                            business: user.business || null,
                            location: user.location || null
                        },
                        timestamp: Date.now(),
                        rememberMe: rememberMe
                    };

                    // Save session
                    if (rememberMe) {
                        localStorage.setItem(this.sessionKey, JSON.stringify(session));
                    } else {
                        sessionStorage.setItem(this.sessionKey, JSON.stringify(session));
                    }

                    // Update state
                    userState.isAuthenticated = true;
                    userState.currentUser = session.user;
                    userState.sessionToken = sessionToken;

                    // Update UI
                    this.updateUI();
                    
                    console.log('âœ… Login successful:', userState.currentUser.email);
                    return { success: true, user: userState.currentUser };

                } catch (error) {
                    console.error('âŒ Login failed:', error.message);
                    return { success: false, error: error.message };
                }
            }

            // User registration
            async register(userData) {
                try {
                    console.log('ðŸ“ Registering new user:', userData.email);
                    
                    // Get existing users
                    const users = JSON.parse(localStorage.getItem(this.usersKey) || '[]');
                    
                    // Check if user already exists
                    if (users.find(u => u.email === userData.email)) {
                        throw new Error('User with this email already exists');
                    }

                    // Create new user
                    const newUser = {
                        id: this.generateUserId(),
                        name: userData.name,
                        email: userData.email,
                        password: userData.password, // In production, this should be hashed
                        type: userData.type || 'buyer',
                        phone: userData.phone || '',
                        location: userData.location || '',
                        business: userData.business || '',
                        avatar: null,
                        createdAt: new Date().toISOString(),
                        isActive: true
                    };

                    // Save user
                    users.push(newUser);
                    localStorage.setItem(this.usersKey, JSON.stringify(users));

                    // Auto-login after registration
                    const loginResult = await this.login(userData.email, userData.password, true);
                    
                    console.log('âœ… Registration and login successful');
                    return { success: true, user: loginResult.user };

                } catch (error) {
                    console.error('âŒ Registration failed:', error.message);
                    return { success: false, error: error.message };
                }
            }

            // User logout
            logout() {
                console.log('ðŸšª Logging out user:', userState.currentUser?.email);
                
                // Clear session
                this.clearSession();
                
                // Reset state
                userState.isAuthenticated = false;
                userState.currentUser = null;
                userState.sessionToken = null;
                
                // Update UI
                this.updateUI();
                
                console.log('âœ… Logout completed');
                return { success: true };
            }

            // Clear session data
            clearSession() {
                localStorage.removeItem(this.sessionKey);
                sessionStorage.removeItem(this.sessionKey);
            }

            // Update UI based on authentication state
            updateUI() {
                console.log('ðŸ”„ updateUI() called');
                console.log('ðŸ“Š Current auth state:', {
                    isAuthenticated: userState.isAuthenticated,
                    currentUser: userState.currentUser?.email || 'none'
                });
                
                const userActions = document.querySelector('.user-actions');
                const userAccount = document.querySelector('.user-account');
                
                console.log('ðŸ” UI elements found:', {
                    userActions: !!userActions,
                    userAccount: !!userAccount
                });
                
                if (!userActions || !userAccount) {
                    console.error('âŒ Required UI elements not found');
                    return;
                }

                if (userState.isAuthenticated && userState.currentUser) {
                    // User is logged in
                    const user = userState.currentUser;
                    
                    // Update user actions
                    userActions.innerHTML = `
                        <span class="user-welcome">
                            <i class="fas fa-user-circle"></i>
                            ${user.name}
                        </span>
                        <a href="#" onclick="userAuth.showAccountDropdown(); return false;" class="account-link">
                            <i class="fas fa-cog"></i> Account
                        </a>
                        <a href="#" onclick="userAuth.logout(); return false;" class="logout-link">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    `;
                    
                    // Update account link
                    userAccount.innerHTML = `
                        <i class="fas fa-user-circle"></i>
                        <span>${user.name}</span>
                    `;
                    userAccount.style.color = '#2563eb';
                    userAccount.onclick = () => this.showAccountDropdown();
                    
                    // Update account dropdown
                    this.updateAccountDropdown();
                    
                    console.log('âœ… UI updated for logged in user');
                    
                } else {
                    // User is not logged in - show full navigation options
                    userActions.innerHTML = `
                        <a href="login.html" onclick="console.log('Login button clicked - navigating to login page');"><i class="fas fa-user"></i> Login</a>
                        <a href="register.html" onclick="console.log('Register button clicked - navigating to register page');"><i class="fas fa-user-plus"></i> Register</a>
                        <a href="register.html?type=seller" onclick="console.log('Sell button clicked - navigating to seller registration page');"><i class="fas fa-store"></i> Sell</a>
                        <a href="#" onclick="console.log('Help button clicked'); showHelpModal(); return false;"><i class="fas fa-question-circle"></i> Help</a>
                        <a href="admin/admin-login.html" onclick="console.log('Admin button clicked');" style="font-size: 0.8rem; opacity: 0.6; color: var(--primary-color); text-decoration: none; margin-left: 8px; font-weight: 500;" title="EcoLoop Admin Access"><i class="fas fa-leaf"></i> Admin</a>
                    `;
                    
                    // Reset account link
                    userAccount.innerHTML = `
                        <i class="fas fa-user"></i>
                        <span>Login</span>
                    `;
                    userAccount.style.color = '';
                    
                    console.log('âœ… UI updated for logged out state');
                }
            }

            // Update account dropdown
            updateAccountDropdown() {
                console.log('ðŸ”„ Updating account dropdown with real-time data');
                
                // Basic user info
                const accountNameLarge = document.getElementById('accountNameLarge');
                const accountEmail = document.getElementById('accountEmail');
                const accountTypeBadge = document.getElementById('accountTypeBadge');
                const accountAvatarLarge = document.getElementById('accountAvatarLarge');
                
                // Account information
                const accountUserId = document.getElementById('accountUserId');
                const accountMemberSince = document.getElementById('accountMemberSince');
                const accountStatus = document.getElementById('accountStatus');
                
                // Seller information
                const sellerSection = document.getElementById('sellerSection');
                const accountBusinessName = document.getElementById('accountBusinessName');
                const accountPhone = document.getElementById('accountPhone');
                const accountLocation = document.getElementById('accountLocation');
                
                // Shopping statistics
                const statOrders = document.getElementById('statOrders');
                const statWishlist = document.getElementById('statWishlist');
                const statReviews = document.getElementById('statReviews');
                const accountTotalSpent = document.getElementById('accountTotalSpent');
                const accountItemsPurchased = document.getElementById('accountItemsPurchased');
                
                // Recent activity
                const accountLastViewed = document.getElementById('accountLastViewed');
                const accountSearches = document.getElementById('accountSearches');
                
                if (userState.currentUser) {
                    const user = userState.currentUser;
                    console.log('ðŸ“Š Updating dropdown for user:', user.email);
                    
                    // Basic user info
                    if (accountNameLarge) accountNameLarge.textContent = user.name;
                    if (accountEmail) accountEmail.textContent = user.email;
                    if (accountTypeBadge) accountTypeBadge.textContent = user.type === 'seller' ? 'Seller' : 'Buyer';
                    if (accountAvatarLarge) {
                        const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                        accountAvatarLarge.textContent = initials;
                    }
                    
                    // Account information
                    if (accountUserId) accountUserId.textContent = user.id || 'ID-' + Date.now();
                    if (accountMemberSince) {
                        const memberDate = user.createdAt ? new Date(user.createdAt) : new Date();
                        accountMemberSince.textContent = memberDate.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    }
                    if (accountStatus) {
                        accountStatus.textContent = user.status === 'pending' ? 'Pending' : 
                                                   user.status === 'rejected' ? 'Rejected' : 'Active';
                        accountStatus.className = 'account-info-value ' + 
                            (user.status === 'pending' ? 'pending' : 
                             user.status === 'rejected' ? 'rejected' : 'active');
                    }
                    
                    // Seller information (show only for sellers)
                    if (sellerSection) {
                        if (user.type === 'seller') {
                            sellerSection.style.display = 'block';
                            if (accountBusinessName) accountBusinessName.textContent = user.business || 'Not specified';
                            if (accountPhone) accountPhone.textContent = user.phone || 'Not specified';
                            if (accountLocation) accountLocation.textContent = user.location || 'Not specified';
                        } else {
                            sellerSection.style.display = 'none';
                        }
                    }
                    
                    // Shopping statistics (real-time data)
                    if (statOrders) {
                        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                        const userOrders = orders.filter(order => order.userId === user.id);
                        statOrders.textContent = userOrders.length;
                    }
                    
                    if (statWishlist) {
                        const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
                        const userWishlist = wishlist.filter(item => item.userId === user.id);
                        statWishlist.textContent = userWishlist.length;
                    }
                    
                    if (statReviews) {
                        const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
                        const userReviews = reviews.filter(review => review.userId === user.id);
                        statReviews.textContent = userReviews.length;
                    }
                    
                    if (accountTotalSpent) {
                        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                        const userOrders = orders.filter(order => order.userId === user.id);
                        const totalSpent = userOrders.reduce((sum, order) => sum + (order.total || 0), 0);
                        accountTotalSpent.textContent = 'KES ' + totalSpent.toLocaleString();
                    }
                    
                    if (accountItemsPurchased) {
                        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                        const userOrders = orders.filter(order => order.userId === user.id);
                        const totalItems = userOrders.reduce((sum, order) => sum + (order.items?.length || 0), 0);
                        accountItemsPurchased.textContent = totalItems;
                    }
                    
                    // Recent activity
                    if (accountLastViewed) {
                        const recentViews = JSON.parse(localStorage.getItem('recentViews') || '[]');
                        const userViews = recentViews.filter(view => view.userId === user.id);
                        if (userViews.length > 0) {
                            const lastViewed = userViews[userViews.length - 1];
                            accountLastViewed.textContent = lastViewed.productName || 'Unknown item';
                        } else {
                            accountLastViewed.textContent = 'No items';
                        }
                    }
                    
                    if (accountSearches) {
                        const searches = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                        const userSearches = searches.filter(search => search.userId === user.id);
                        accountSearches.textContent = userSearches.length;
                    }
                    
                    console.log('âœ… Account dropdown updated with real-time data');
                } else {
                    console.log('âŒ No user data available for dropdown update');
                }
            }

            // Show account dropdown
            showAccountDropdown() {
                const dropdown = document.getElementById('accountDropdown');
                if (dropdown) {
                    // Update account details before showing dropdown
                    this.updateAccountDropdown();
                    
                    // Toggle dropdown visibility
                    dropdown.classList.toggle('show');
                    
                    console.log('âœ… Account dropdown toggled, user:', userState.currentUser?.name);
                }
            }

            // Generate session token
            generateSessionToken() {
                return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            // Generate user ID
            generateUserId() {
                return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            // Get current user
            getCurrentUser() {
                return userState.isAuthenticated ? userState.currentUser : null;
            }

            // Check if user is authenticated
            isAuthenticated() {
                return userState.isAuthenticated;
            }

            // Get user type
            getUserType() {
                return userState.currentUser ? userState.currentUser.type : null;
            }
        }

        // Initialize authentication system
        const userAuth = new UserAuthManager();

        // Global functions for backward compatibility
        window.login = async (email, password, rememberMe) => await userAuth.login(email, password, rememberMe);
        window.register = async (userData) => await userAuth.register(userData);
        window.logout = () => userAuth.logout();
        window.getCurrentUser = () => userAuth.getCurrentUser();
        window.isAuthenticated = () => userAuth.isAuthenticated();
        
        // ========================================
        // WEBSITE MODE SYSTEM
        // ========================================
        
        // Website modes: 'guest', 'user', 'seller'
        let websiteMode = 'guest';
        
        // Function to detect current mode based on authentication state
        function detectWebsiteMode() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            if (!currentUser) {
                return 'guest';
            } else if (currentUser.userType === 'seller' || currentUser.role === 'seller') {
                return 'seller';
            } else {
                return 'user';
            }
        }
        
        // Function to switch website mode
        function switchWebsiteMode(newMode) {
            const oldMode = websiteMode;
            websiteMode = newMode;
            
            console.log(`ðŸ”„ Switching website mode: ${oldMode} â†’ ${newMode}`);
            
            // Update UI based on mode
            updateUIForMode(newMode);
            
            // Update body class for CSS styling
            document.body.className = document.body.className.replace(/mode-\w+/g, '');
            document.body.classList.add(`mode-${newMode}`);
            
            // Show mode-specific notifications
            showModeNotification(newMode);
        }
        
        // Function to update UI based on current mode
        function updateUIForMode(mode) {
            switch(mode) {
                case 'guest':
                    updateGuestModeUI();
                    break;
                case 'user':
                    updateUserModeUI();
                    break;
                case 'seller':
                    updateSellerModeUI();
                    break;
            }
        }
        
        // Function to show mode notification
        function showModeNotification(mode) {
            const messages = {
                'guest': 'ðŸ‘‹ Welcome! Browse as a guest or sign in for full features',
                'user': 'ðŸ›’ Welcome back! Enjoy shopping with exclusive deals',
                'seller': 'ðŸª Seller dashboard active - Manage your store'
            };
            
            if (messages[mode]) {
                showToast(messages[mode], 'info', 3000);
            }
        }
        
        // ========================================
        // MODE-SPECIFIC UI FUNCTIONS
        // ========================================
        
        // Guest Mode UI Updates
        function updateGuestModeUI() {
            console.log('ðŸŽ¯ Updating UI for Guest Mode');
            
            // Hide user/seller specific elements
            hideElement('.user-only');
            hideElement('.seller-only');
            hideElement('.dashboard-link');
            hideElement('.seller-dashboard-link');
            
            // Show guest-specific elements
            showElement('.guest-only');
            showElement('.login-required');
            
            // Update navigation
            updateNavigationForGuest();
            
            // Update product cards to show guest actions
            updateProductCardsForGuest();
            
            // Update header
            updateHeaderForGuest();
        }
        
        // User (Buyer) Mode UI Updates
        function updateUserModeUI() {
            console.log('ðŸŽ¯ Updating UI for User Mode');
            
            // Hide guest/seller specific elements
            hideElement('.guest-only');
            hideElement('.seller-only');
            hideElement('.seller-dashboard-link');
            
            // Show user-specific elements
            showElement('.user-only');
            showElement('.dashboard-link');
            
            // Update navigation
            updateNavigationForUser();
            
            // Update product cards to show user actions
            updateProductCardsForUser();
            
            // Update header
            updateHeaderForUser();
        }
        
        // Seller Mode UI Updates
        function updateSellerModeUI() {
            console.log('ðŸŽ¯ Updating UI for Seller Mode');
            
            // Hide guest/user specific elements
            hideElement('.guest-only');
            hideElement('.user-only');
            hideElement('.dashboard-link');
            
            // Show seller-specific elements
            showElement('.seller-only');
            showElement('.seller-dashboard-link');
            
            // Update navigation
            updateNavigationForSeller();
            
            // Update product cards to show seller actions
            updateProductCardsForSeller();
            
            // Update header
            updateHeaderForSeller();
        }
        
        // Helper functions for UI updates
        function hideElement(selector) {
            const elements = document.querySelectorAll(selector);
            elements.forEach(el => el.style.display = 'none');
        }
        
        function showElement(selector) {
            const elements = document.querySelectorAll(selector);
            elements.forEach(el => el.style.display = 'block');
        }
        
        function updateNavigationForGuest() {
            // Show login/register, hide account/logout
            const loginBtn = document.querySelector('.login-btn');
            const registerBtn = document.querySelector('.register-btn');
            const accountBtn = document.querySelector('.account-btn');
            const logoutBtn = document.querySelector('.logout-btn');
            
            if (loginBtn) loginBtn.style.display = 'inline-block';
            if (registerBtn) registerBtn.style.display = 'inline-block';
            if (accountBtn) accountBtn.style.display = 'none';
            if (logoutBtn) logoutBtn.style.display = 'none';
        }
        
        function updateNavigationForUser() {
            // Show account/logout, hide login/register
            const loginBtn = document.querySelector('.login-btn');
            const registerBtn = document.querySelector('.register-btn');
            const accountBtn = document.querySelector('.account-btn');
            const logoutBtn = document.querySelector('.logout-btn');
            
            if (loginBtn) loginBtn.style.display = 'none';
            if (registerBtn) registerBtn.style.display = 'none';
            if (accountBtn) accountBtn.style.display = 'inline-block';
            if (logoutBtn) logoutBtn.style.display = 'inline-block';
        }
        
        function updateNavigationForSeller() {
            // Show seller dashboard, account/logout
            const loginBtn = document.querySelector('.login-btn');
            const registerBtn = document.querySelector('.register-btn');
            const accountBtn = document.querySelector('.account-btn');
            const logoutBtn = document.querySelector('.logout-btn');
            const sellerDashboard = document.querySelector('.seller-dashboard-link');
            
            if (loginBtn) loginBtn.style.display = 'none';
            if (registerBtn) registerBtn.style.display = 'none';
            if (accountBtn) accountBtn.style.display = 'inline-block';
            if (logoutBtn) logoutBtn.style.display = 'inline-block';
            if (sellerDashboard) sellerDashboard.style.display = 'inline-block';
        }
        
        function updateHeaderForGuest() {
            const headerTitle = document.querySelector('.site-title');
            if (headerTitle) {
                headerTitle.textContent = 'EcoLoop Kenya - Browse Products';
            }
        }
        
        function updateHeaderForUser() {
            const headerTitle = document.querySelector('.site-title');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (headerTitle) {
                headerTitle.textContent = `EcoLoop Kenya - Welcome, ${currentUser.name || 'User'}`;
            }
        }
        
        function updateHeaderForSeller() {
            const headerTitle = document.querySelector('.site-title');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (headerTitle) {
                headerTitle.textContent = `EcoLoop Kenya - Seller Dashboard (${currentUser.name || 'Seller'})`;
            }
        }
        
        function updateProductCardsForGuest() {
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                // Show login prompt for actions
                const addToCartBtn = card.querySelector('.add-to-cart');
                const wishlistBtn = card.querySelector('.wishlist-btn');
                
                if (addToCartBtn) {
                    addToCartBtn.onclick = () => showLoginPrompt();
                }
                if (wishlistBtn) {
                    wishlistBtn.onclick = () => showLoginPrompt();
                }
            });
        }
        
        function updateProductCardsForUser() {
            // Product cards work normally for users
            location.reload(); // Simple refresh to restore normal functionality
        }
        
        function updateProductCardsForSeller() {
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                // Show edit/delete options for own products
                const addToCartBtn = card.querySelector('.add-to-cart');
                if (addToCartBtn) {
                    addToCartBtn.style.display = 'none';
                }
                
                // Add seller controls
                const sellerControls = card.querySelector('.seller-controls');
                if (sellerControls) {
                    sellerControls.style.display = 'block';
                }
            });
        }
        
        function showLoginPrompt() {
            showToast('Please sign in to use this feature', 'info');
            showLoginModal();
        }
        
        // ========================================
        // CLEAN INITIALIZATION
        // ========================================
        
        // Initialize page with new authentication system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Initializing website with new authentication system');
            
            // Ensure authentication UI is properly updated
            if (window.userAuth) {
                console.log('ðŸ“± Updating authentication UI on DOM load');
                userAuth.updateUI();
            }
            
            // Load products and other initialization
            loadProducts('all').then(() => {
                loadCategories();
                updateCartCount();
                updateWishlistCount();
                console.log('âœ… Website fully initialized');
            });
            
            // Setup search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
            
            // Make authentication functions globally available
            window.userAuth = userAuth;
            window.showLoginModal = showLoginModal;
            window.showRegisterModal = showRegisterModal;
            
            console.log('âœ… New authentication system ready');
        });
        
        // Modal functions for compatibility
        function showLoginModal() {
            // Redirect to login page since we don't have modals anymore
            window.location.href = 'login.html';
        }
        
        function showRegisterModal() {
            // Redirect to register page since we don't have modals anymore
            window.location.href = 'register.html';
        }
        
        function closeModal(modalId) {
            console.log('ðŸ“ closeModal called - modals removed, using page redirects');
        }
        
        function switchLoginType(type) {
            console.log('ðŸ“ switchLoginType called - using separate pages now');
        }
        
        function togglePasswordVisibility() {
            console.log('ðŸ“ togglePasswordVisibility called - using separate pages now');
        }
        
        function handleLoginSubmit(event) {
            console.log('ðŸ“ handleLoginSubmit called - using separate pages now');
            event.preventDefault();
        }
        
        // Helper functions
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                const results = products.filter(p => 
                    p.title.toLowerCase().includes(searchTerm) ||
                    p.category.toLowerCase().includes(searchTerm) ||
                    p.description.toLowerCase().includes(searchTerm)
                );
                
                const grid = document.getElementById('productsGrid');
                if (results.length > 0) {
                    grid.innerHTML = results.map(product => createProductCard(product)).join('');
                    showToast(`Found ${results.length} products for "${searchTerm}"`, 'success');
                } else {
                    grid.innerHTML = '<div class="loading">No products found for your search.</div>';
                    showToast('No products found', 'warning');
                }
            }
        }
        
        function loadCategories() {
            const grid = document.getElementById('categoriesGrid');
            if (!grid) return;
            
            grid.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }
        
        function createCategoryCard(category) {
            return `
                <div class="category-card" data-category="${category.name}" onclick="filterByCategory('${category.name}')">
                    <div class="category-icon">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${category.count} Products</div>
                </div>
            `;
        }
        
        function filterByCategory(categoryName) {
            if (categoryName === 'all') {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(p => p.category === categoryName);
            }
            
            const grid = document.getElementById('productsGrid');
            if (filteredProducts.length > 0) {
                grid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
                showToast(`Showing ${filteredProducts.length} products in ${categoryName}`, 'success');
            } else {
                grid.innerHTML = '<div class="loading">No products found in this category.</div>';
                showToast(`No products available in ${categoryName}`, 'warning');
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'success', duration = 3000) {
            // Remove existing toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            // Add to page
            document.body.appendChild(toast);
            
            // Remove after duration
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, duration);
        }
        
        // Load products function - Updated to use MongoDB approved products
        async function loadProducts(category = 'all') {
            try {
                console.log('ðŸ”„ Loading approved products from MongoDB...');
                
                const grid = document.getElementById('productsGrid');
                if (grid) {
                    grid.innerHTML = '<div class="loading"><div class="spinner"></div>Loading approved products...</div>';
                }
                
                // Load approved products directly
                await loadApprovedProducts(category);
                
                console.log('âœ… Approved products loaded successfully');
            } catch (error) {
                console.error('âŒ Error loading approved products:', error);
                showToast('Error loading approved products', 'error');
                
                const grid = document.getElementById('productsGrid');
                if (grid) {
                    grid.innerHTML = `
                        <div class="empty-state" style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <i class="fas fa-box-open" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Approved Products Available</h3>
                            <p>No products have been approved by admin yet. Check back later!</p>
                        </div>
                    `;
                }
            }
        }

        // Load approved products from MongoDB with localStorage fallback
        async function loadApprovedProducts(filter = 'all') {
            const grid = document.getElementById('productsGrid');
            
            try {
                // First try to get products from MongoDB
                let mongoProducts = [];
                try {
                    if (typeof getProductsFromMongo === 'function') {
                        mongoProducts = await getProductsFromMongo('approved');
                    } else {
                        // Fallback: try direct API call
                        const response = await fetch('https://my-backend-1-jk7w.onrender.com/api/data');
                        if (response.ok) {
                            const result = await response.json();
                            if (result.success) {
                                mongoProducts = result.data.filter(product => 
                                    product.type === 'product' && 
                                    product.status === 'approved' && 
                                    !product.deleted
                                );
                            }
                        }
                    }
                } catch (mongoError) {
                    console.log('MongoDB fetch failed, using localStorage fallback:', mongoError.message);
                }
                
                console.log('ðŸ“¦ Retrieved approved products from MongoDB:', mongoProducts.length);
                
                let allProducts = mongoProducts;
                
                // If no products in MongoDB, fall back to localStorage
                if (allProducts.length === 0) {
                    console.log('ðŸ”„ No products in MongoDB, checking localStorage...');
                    
                    // Get registered sellers
                    const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
                    const registeredSellerEmails = new Set(registeredSellers.map(s => s.email));
                    
                    // Get approved products from localStorage
                    const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
                    const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
                    
                    // Combine and filter only approved products from registered sellers
                    allProducts = [
                        ...adminProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail)),
                        ...sellerProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail))
                    ];
                    
                    // Remove duplicates based on product ID
                    const uniqueProducts = [];
                    const seenIds = new Set();
                    
                    allProducts.forEach(product => {
                        if (!seenIds.has(product.id)) {
                            seenIds.add(product.id);
                            uniqueProducts.push({
                                ...product,
                                sellerEmail: product.sellerEmail || 'pmuiruri9657@gmail.com',
                                sellerName: product.sellerName || 'EcoLoop Kenya',
                                sellerPhone: product.sellerPhone || '+254 712 345 678',
                                sellerLocation: product.sellerLocation || 'Nairobi, Kenya',
                                title: product.title || product.name || 'Untitled Product',
                                price: product.price || 0,
                                category: product.category || 'Uncategorized',
                                rating: product.rating || 4.0,
                                reviews: product.reviews || 0,
                                image: product.image || (product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/250x200/cccccc/ffffff?text=No+Image')
                            });
                        }
                    });
                    
                    allProducts = uniqueProducts;
                    
                    console.log('ðŸ“¦ Using localStorage approved products:', allProducts.length);
                }
                
                // Ensure all products have required fields for messaging, cart, and wishlist
                allProducts = allProducts.map(product => ({
                    ...product,
                    // Ensure seller info is available
                    sellerEmail: product.sellerEmail || 'pmuiruri9657@gmail.com',
                    sellerName: product.sellerName || 'EcoLoop Kenya',
                    sellerPhone: product.sellerPhone || '+254 712 345 678',
                    sellerLocation: product.sellerLocation || 'Nairobi, Kenya',
                    // Ensure product fields
                    title: product.title || product.name || 'Untitled Product',
                    price: product.price || 0,
                    category: product.category || 'Uncategorized',
                    rating: product.rating || 4.0,
                    reviews: product.reviews || 0,
                    image: product.image || (product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/250x200/cccccc/ffffff?text=No+Image')
                }));
                
                // Apply category filter if specified
                let filteredProducts = allProducts;
                if (filter !== 'all') {
                    filteredProducts = allProducts.filter(p => p.category === filter);
                }
                
                // Update global products array for other functions
                products = allProducts;
                filteredProducts = filteredProducts;
                
                console.log('ðŸ“¦ Products to display:', filteredProducts.length);
                
                if (filteredProducts.length > 0) {
                    grid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
                    console.log('âœ… Approved products displayed successfully');
                    // Refresh wishlist buttons after products are loaded
                    if (typeof refreshWishlistButtonsAfterLoad === 'function') {
                        refreshWishlistButtonsAfterLoad();
                    }
                } else {
                    grid.innerHTML = `
                        <div class="empty-state" style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <i class="fas fa-box-open" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Approved Products Available</h3>
                            <p>No products have been approved by admin yet. Check back later!</p>
                        </div>
                    `;
                    console.log('âš ï¸ No approved products to display');
                }
                
            } catch (error) {
                console.error('âŒ Error loading approved products:', error);
                
                // Fallback to localStorage only
                console.log('ðŸ”„ Falling back to localStorage...');
                const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
                const registeredSellerEmails = new Set(registeredSellers.map(s => s.email));
                
                const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
                const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
                
                let allProducts = [
                    ...adminProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail)),
                    ...sellerProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail))
                ];
                
                // Remove duplicates and ensure required fields
                const uniqueProducts = [];
                const seenIds = new Set();
                
                allProducts.forEach(product => {
                    if (!seenIds.has(product.id)) {
                        seenIds.add(product.id);
                        uniqueProducts.push({
                            ...product,
                            sellerEmail: product.sellerEmail || 'pmuiruri9657@gmail.com',
                            sellerName: product.sellerName || 'EcoLoop Kenya',
                            sellerPhone: product.sellerPhone || '+254 712 345 678',
                            sellerLocation: product.sellerLocation || 'Nairobi, Kenya',
                            title: product.title || product.name || 'Untitled Product',
                            price: product.price || 0,
                            category: product.category || 'Uncategorized',
                            rating: product.rating || 4.0,
                            reviews: product.reviews || 0,
                            image: product.image || (product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/250x200/cccccc/ffffff?text=No+Image')
                        });
                    }
                });
                
                if (allProducts.length > 0) {
                    grid.innerHTML = allProducts.map(product => createProductCard(product)).join('');
                    if (typeof refreshWishlistButtonsAfterLoad === 'function') {
                        refreshWishlistButtonsAfterLoad();
                    }
                    console.log('âœ… Approved products displayed from localStorage fallback');
                } else {
                    grid.innerHTML = `
                        <div class="empty-state" style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <i class="fas fa-box-open" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No Approved Products Available</h3>
                            <p>No products have been approved by admin yet. Check back later!</p>
                        </div>
                    `;
                }
            }
        }

        // Update cart count
        function updateCartCount() {
            if (!userAuth.isAuthenticated()) return;
            
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                // This would normally load user's cart
                cartCount.textContent = '0';
            }
        }
        
        // Update wishlist count
        function updateWishlistCount() {
            if (!userAuth.isAuthenticated()) return;
            
            const wishlistCount = document.getElementById('wishlistCount');
            if (wishlistCount) {
                // This would normally load user's wishlist
                wishlistCount.textContent = '0';
            }
        }
        
        console.log('ðŸŽ‰ New authentication system loaded successfully!');
    </script>
</body>
</html>
