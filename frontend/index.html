<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EcoLoop Kenya - Sustainable Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/productLayer.css">
    <style>
        :root {
            --primary-color: #2ecc71;
            --secondary-color: #27ae60;
            --accent-color: #f39c12;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-lg: 0 5px 20px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            min-width: 1200px; /* Force desktop minimum width */
            overflow-x: auto; /* Allow horizontal scrolling if needed */
        }

        /* Header Styles */
        .top-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 10px 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .top-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .contact-info span {
            margin-right: 20px;
        }

        .user-actions a {
            color: var(--white);
            text-decoration: none;
            margin-left: 15px;
            transition: opacity 0.3s;
        }

        .user-actions a:hover {
            opacity: 0.8;
        }

        .main-header {
            background: var(--white);
            padding: 20px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .commerce-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-wrapper {
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
        }

        .icon-wrapper:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.6);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .icon-wrapper i {
            color: #00ffff;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .icon-wrapper:hover i {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            border: 2px solid var(--white);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
            animation: badgePulse 2s infinite;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .badge.wishlist-badge {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.4);
        }

        .badge.cart-badge {
            background: linear-gradient(135deg, #27ae60, #229954);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.4);
        }

        .badge.animate {
            animation: badgeBounce 0.6s ease;
        }

        @keyframes badgeBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Cart and Wishlist Sidebar Styles */
        .cart-sidebar, .wishlist-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-left: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.3);
            transition: right 0.3s ease;
            z-index: 10001;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.open, .wishlist-sidebar.open {
            right: 0;
        }

        .cart-header, .wishlist-header {
            background: rgba(0, 255, 255, 0.1);
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h3, .wishlist-header h3 {
            color: #00ffff;
            margin: 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-header h3 i, .wishlist-header h3 i {
            color: #00ffff;
        }

        .close-cart, .close-wishlist {
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .close-cart:hover, .close-wishlist:hover {
            background: rgba(255, 0, 0, 0.3);
            transform: scale(1.1);
        }

        .cart-content, .wishlist-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .cart-items, .wishlist-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cart-item, .wishlist-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .cart-item:hover, .wishlist-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(0, 255, 255, 0.4);
            transform: translateX(-5px);
        }

        .cart-item-image, .wishlist-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .cart-item-details, .wishlist-item-details {
            flex: 1;
        }

        .cart-item-title, .wishlist-item-title {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .cart-item-price, .wishlist-item-price {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
        }

        .quantity-btn {
            background: none;
            border: none;
            color: #00ffff;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        .quantity-value {
            color: #ffffff;
            min-width: 30px;
            text-align: center;
        }

        .cart-item-actions, .wishlist-item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-remove, .btn-move-to-cart {
            background: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-remove:hover {
            background: rgba(255, 0, 0, 0.3);
            border-color: rgba(255, 0, 0, 0.5);
        }

        .btn-move-to-cart:hover {
            background: rgba(0, 255, 0, 0.3);
            border-color: rgba(0, 255, 0, 0.5);
        }

        .cart-empty, .wishlist-empty {
            text-align: center;
            color: #ffffff;
            padding: 40px 20px;
        }

        .cart-empty i, .wishlist-empty i {
            font-size: 48px;
            color: rgba(0, 255, 255, 0.3);
            margin-bottom: 20px;
        }

        .cart-summary {
            border-top: 2px solid rgba(0, 255, 255, 0.3);
            padding: 20px;
            background: rgba(0, 255, 255, 0.05);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 18px;
            color: #00ffff;
            border-top: 1px solid rgba(0, 255, 255, 0.3);
            padding-top: 10px;
            margin-top: 10px;
        }

        .checkout-btn {
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #00ffff, #0080ff);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        /* Overlay for cart/wishlist */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        @media (max-width: 768px) {
            .cart-sidebar, .wishlist-sidebar {
                width: 100%;
                right: -100%;
            }
        }

        /* Futuristic Hero Section */
        .hero {
            position: relative;
            min-height: 25vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Animated Gradient Background */
        .hero-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                #0a0e27 0%,
                #1a1f3a 25%,
                #2d1b69 50%,
                #0f3460 75%,
                #16213e 100%
            );
            animation: gradientShift 15s ease infinite;
        }

        /* Neon Grid */
        .neon-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            opacity: 0.3;
        }

        /* Energy Waves */
        .energy-waves {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200%;
            height: 200%;
            pointer-events: none;
        }

        .energy-waves::before,
        .energy-waves::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border: 2px solid;
            border-radius: 50%;
            opacity: 0;
        }

        .energy-waves::before {
            border-color: #00ffff;
            animation: waveExpand 4s ease-out infinite;
        }

        .energy-waves::after {
            border-color: #ff00ff;
            animation: waveExpand 4s ease-out infinite 2s;
        }

        /* Floating Particles */
        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particles-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(0, 255, 255, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 50%, rgba(255, 0, 255, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 50% 20%, rgba(0, 255, 128, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 50% 80%, rgba(255, 128, 0, 0.2) 0%, transparent 50%);
            animation: particlesFloat 20s ease-in-out infinite;
        }

        /* Holographic Overlay */
        .holographic-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 0, 255, 0.1) 50%,
                transparent 70%
            );
            animation: holographicShift 8s ease-in-out infinite;
            pointer-events: none;
        }

        /* Glass Morphism Welcome Panel */
        .welcome-panel {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 45px 40px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            max-width: 800px;
            margin: 0 auto;
            transform: translateY(0);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            animation: panelFloat 6s ease-in-out infinite;
        }

        .welcome-panel:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 255, 255, 0.3),
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Panel Glow Effect */
        .panel-glow {
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00, #00ffff);
            border-radius: 30px;
            z-index: -1;
            opacity: 0.5;
            animation: glowRotate 4s linear infinite;
            filter: blur(10px);
        }

        /* Futuristic Title */
        .welcome-title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ffffff, #00ffff, #ff00ff, #ffffff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: titleGlow 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        /* Futuristic Subtitle */
        .welcome-subtitle {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            margin-bottom: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
            letter-spacing: 1px;
            animation: subtitlePulse 4s ease-in-out infinite;
        }

        /* Futuristic Button */
        .futuristic-btn {
            position: relative;
            display: inline-block;
            padding: 18px 50px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            color: #ffffff;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.4);
        }

        .futuristic-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(255, 0, 255, 0.6);
        }

        .btn-text {
            position: relative;
            z-index: 2;
        }

        .btn-glow {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }

        .futuristic-btn:hover .btn-glow {
            left: 100%;
        }

        /* Animations */
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        @keyframes waveExpand {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }

        @keyframes particlesFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
        }

        @keyframes holographicShift {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        @keyframes panelFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes glowRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes titleGlow {
            0%, 100% { 
                background-position: 0% 50%;
                filter: brightness(1) drop-shadow(0 0 20px rgba(0, 255, 255, 0.5));
            }
            50% { 
                background-position: 100% 50%;
                filter: brightness(1.2) drop-shadow(0 0 30px rgba(255, 0, 255, 0.7));
            }
        }

        @keyframes subtitlePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .welcome-panel {
                padding: 30px 20px;
                margin: 0 20px;
            }

            .welcome-title {
                font-size: clamp(2rem, 5vw, 3rem);
                letter-spacing: 2px;
            }

            .welcome-subtitle {
                font-size: clamp(0.9rem, 2vw, 1.1rem);
            }

            .futuristic-btn {
                padding: 15px 40px;
                font-size: 1rem;
            }

            .neon-grid {
                background-size: 30px 30px;
            }
        }

        @media (max-width: 480px) {
            .welcome-panel {
                padding: 22px 15px;
                margin: 0 10px;
            }

            .futuristic-btn {
                padding: 12px 30px;
                font-size: 0.9rem;
            }
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: var(--accent-color);
            color: var(--white);
            text-decoration: none;
            border-radius: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Categories Section */
        .categories {
            padding: 80px 0;
            background: var(--bg-light);
        }

        .section-title {
            text-align: center;
            font-size: 36px;
            margin-bottom: 50px;
            color: var(--text-dark);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .category-card {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .category-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .category-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .category-count {
            color: var(--text-light);
        }

        /* Products Section */
        .products {
            padding: 80px 0;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .product-card {
            background: var(--white);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-info {
            padding: 20px;
        }

        .product-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 24px;
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .product-description {
            color: var(--text-light);
            margin-bottom: 15px;
        }

        /* Footer */
        .footer {
            background: var(--text-dark);
            color: var(--white);
            padding: 50px 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            margin-bottom: 20px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section a {
            color: var(--white);
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .footer-section a:hover {
            opacity: 1;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            opacity: 0.8;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto; /* Allow scrolling within modal */
        }

        .modal-content {
            background-color: var(--white);
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
            min-height: fit-content; /* Ensure modal fits content */
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
        }

        .close {
            color: var(--white);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 30px;
        }

        /* Product Details Modal Styles */
        .product-details-modal {
            max-width: 900px;
            width: 95%;
        }

        .product-details-body {
            padding: 0;
        }

        .product-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .product-image-section {
            text-align: center;
        }

        .product-detail-image {
            width: 100%;
            max-width: 400px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-rating {
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .product-rating #productRating {
            color: #f39c12;
            font-size: 18px;
        }

        .product-rating #ratingValue {
            color: var(--text-light);
            font-weight: 600;
        }

        .product-price-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .product-price-section h3 {
            color: var(--primary-color);
            font-size: 28px;
            margin: 0;
        }

        .stock-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: #27ae60;
            color: white;
        }

        .stock-badge.out-of-stock {
            background: #e74c3c;
        }

        .product-description,
        .product-features,
        .product-specifications {
            margin-bottom: 25px;
        }

        .product-description h4,
        .product-features h4,
        .product-specifications h4 {
            color: var(--text-dark);
            margin-bottom: 10px;
            font-size: 18px;
        }

        .product-description p {
            color: var(--text-light);
            line-height: 1.6;
        }

        .product-features ul {
            list-style: none;
            padding: 0;
        }

        .product-features li {
            padding: 8px 0;
            color: var(--text-light);
            position: relative;
            padding-left: 25px;
        }

        .product-features li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .specifications-grid {
            display: grid;
            gap: 10px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .spec-label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .spec-value {
            color: var(--text-light);
        }

        .product-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .product-actions .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .product-actions .btn i {
            margin-right: 8px;
        }

        .btn-wishlist {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-wishlist:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-wishlist i {
            margin-right: 5px;
        }

        @media (max-width: 768px) {
            .product-details-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .product-detail-image {
                height: 250px;
            }

            .product-actions {
                flex-direction: column;
            }

            .product-price-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .form-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-light);
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        /* User authentication styles */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--accent-color);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: var(--white);
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.warning {
            background: #ffc107;
            color: var(--text-dark);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Top Header -->
    <div class="top-header">
        <div class="container">
            <div class="contact-info">
                <span><i class="fas fa-phone"></i> 0705424364</span>
                <span><i class="fas fa-envelope"></i> pmuiruri9657@gmail.com</span>
            </div>
            <div class="user-actions">
                <a href="#" onclick="showLoginModal(); return false;"><i class="fas fa-user"></i> Login</a>
                <a href="#" onclick="showRegisterModal(); return false;"><i class="fas fa-user-plus"></i> Register</a>
                <a href="#" onclick="showSellerRegisterModal(); return false;"><i class="fas fa-store"></i> Sell</a>
                <a href="#" onclick="showToast('Help section coming soon!', 'info'); return false;"><i class="fas fa-question-circle"></i> Help</a>
                <a href="admin/admin-login.html"><i class="fas fa-leaf"></i> Admin</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">ðŸŒ¿ EcoLoop Kenya</a>
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search for products...">
                </div>
                <div class="header-actions">
                    <div class="commerce-icons">
                        <div class="icon-wrapper" onclick="toggleWishlist()">
                            <i class="fas fa-heart"></i>
                            <span class="badge wishlist-badge" id="wishlistBadge">0</span>
                        </div>
                        <div class="icon-wrapper" onclick="toggleCart()">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="badge cart-badge" id="cartBadge">0</span>
                        </div>
                    </div>
                    <a href="#" class="btn">Start Selling</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background">
            <div class="particles-container"></div>
            <div class="energy-waves"></div>
            <div class="holographic-overlay"></div>
            <div class="neon-grid"></div>
        </div>
        <div class="container">
            <div class="welcome-panel">
                <canvas id="ecoloopProductLayer" aria-hidden="true"></canvas>
                <div class="panel-glow"></div>
                <h1 class="welcome-title">Welcome to EcoLoop Kenya</h1>
                <p class="welcome-subtitle">Your sustainable marketplace for eco-friendly products and services</p>
                <a href="#products" class="futuristic-btn">
                    <span class="btn-text">Start Shopping</span>
                    <div class="btn-glow"></div>
                </a>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories" id="categories">
        <div class="container">
            <h2 class="section-title">Shop by Category</h2>
            <div class="categories-grid" id="categoriesGrid">
                <!-- Categories will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products" id="products">
        <div class="container">
            <h2 class="section-title">Featured Products</h2>
            <div class="products-grid" id="productsGrid">
                <!-- Products will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About EcoLoop</h3>
                    <p>We are Kenya's leading sustainable marketplace, connecting eco-conscious buyers with responsible sellers.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">How It Works</a></li>
                        <li><a href="#">Sustainability</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Categories</h3>
                    <ul>
                        <li><a href="#">Electronics</a></li>
                        <li><a href="#">Fashion</a></li>
                        <li><a href="#">Home & Kitchen</a></li>
                        <li><a href="#">Sports</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Connect</h3>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 EcoLoop Kenya. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login</h2>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required placeholder="Enter your email">
                        <div class="error" id="loginEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required placeholder="Enter your password">
                        <div class="error" id="loginPasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="rememberMe"> Remember me
                        </label>
                    </div>
                    <button type="submit" class="btn-primary" id="loginBtn">
                        <span id="loginBtnText">Login</span>
                    </button>
                </form>
                <div class="form-footer">
                    <p>Don't have an account? <a href="#" onclick="switchModal('loginModal', 'registerModal')">Register</a></p>
                    <p>Want to sell? <a href="#" onclick="switchModal('loginModal', 'sellerRegisterModal')">Register as Seller</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Register</h2>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerFirstName">First Name</label>
                        <input type="text" id="registerFirstName" required placeholder="Enter your first name">
                        <div class="error" id="registerFirstNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerLastName">Last Name</label>
                        <input type="text" id="registerLastName" required placeholder="Enter your last name">
                        <div class="error" id="registerLastNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required placeholder="Enter your email">
                        <div class="error" id="registerEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerPhone">Phone</label>
                        <input type="tel" id="registerPhone" required placeholder="Enter your phone number">
                        <div class="error" id="registerPhoneError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required placeholder="Enter your password">
                        <div class="error" id="registerPasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">Confirm Password</label>
                        <input type="password" id="registerConfirmPassword" required placeholder="Confirm your password">
                        <div class="error" id="registerConfirmPasswordError"></div>
                    </div>
                    <button type="submit" class="btn-primary" id="registerBtn">
                        <span id="registerBtnText">Register</span>
                    </button>
                </form>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" onclick="switchModal('registerModal', 'loginModal')">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Seller Register Modal -->
    <div id="sellerRegisterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Register as Seller</h2>
                <span class="close" onclick="closeModal('sellerRegisterModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="sellerRegisterForm" onsubmit="handleSellerRegister(event)">
                    <div class="form-group">
                        <label for="sellerFirstName">First Name</label>
                        <input type="text" id="sellerFirstName" required placeholder="Enter your first name">
                        <div class="error" id="sellerFirstNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="sellerLastName">Last Name</label>
                        <input type="text" id="sellerLastName" required placeholder="Enter your last name">
                        <div class="error" id="sellerLastNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="sellerEmail">Email</label>
                        <input type="email" id="sellerEmail" required placeholder="Enter your email">
                        <div class="error" id="sellerEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="sellerPhone">Phone</label>
                        <input type="tel" id="sellerPhone" required placeholder="Enter your phone number">
                        <div class="error" id="sellerPhoneError"></div>
                    </div>
                    <div class="form-group">
                        <label for="sellerPassword">Password</label>
                        <input type="password" id="sellerPassword" required placeholder="Enter your password">
                        <div class="error" id="sellerPasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label for="sellerConfirmPassword">Confirm Password</label>
                        <input type="password" id="sellerConfirmPassword" required placeholder="Confirm your password">
                        <div class="error" id="sellerConfirmPasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label for="businessName">Business Name</label>
                        <input type="text" id="businessName" required placeholder="Enter your business name">
                        <div class="error" id="businessNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="businessType">Business Type</label>
                        <select id="businessType" required>
                            <option value="">Select business type</option>
                            <option value="retail">Retail Store</option>
                            <option value="manufacturer">Manufacturer</option>
                            <option value="distributor">Distributor</option>
                            <option value="service">Service Provider</option>
                            <option value="individual">Individual Seller</option>
                        </select>
                        <div class="error" id="businessTypeError"></div>
                    </div>
                    <div class="form-group">
                        <label for="businessDescription">Business Description</label>
                        <textarea id="businessDescription" required placeholder="Describe your business" rows="3"></textarea>
                        <div class="error" id="businessDescriptionError"></div>
                    </div>
                    <div class="form-group">
                        <label for="businessAddress">Business Address</label>
                        <input type="text" id="businessAddress" placeholder="Enter your business address">
                    </div>
                    <div class="form-group">
                        <label for="businessCity">City</label>
                        <input type="text" id="businessCity" placeholder="Enter your city">
                    </div>
                    <div class="form-group">
                        <label for="businessCountry">Country</label>
                        <input type="text" id="businessCountry" placeholder="Enter your country">
                    </div>
                    <button type="submit" class="btn-primary" id="sellerRegisterBtn">
                        <span id="sellerRegisterBtnText">Register as Seller</span>
                    </button>
                </form>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" onclick="switchModal('sellerRegisterModal', 'loginModal')">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="productDetailsModal" class="modal">
        <div class="modal-content product-details-modal">
            <div class="modal-header">
                <h2 id="productTitle">Product Details</h2>
                <span class="close" onclick="closeProductDetailsModal()">&times;</span>
            </div>
            <div class="modal-body product-details-body">
                <div class="product-details-grid">
                    <div class="product-image-section">
                        <img id="productImage" src="" alt="" class="product-detail-image">
                        <div class="product-rating">
                            <span id="productRating">â˜…â˜…â˜…â˜…â˜…</span>
                            <span id="ratingValue">(4.5)</span>
                        </div>
                    </div>
                    <div class="product-info-section">
                        <div class="product-price-section">
                            <h3 id="productPrice">KES 0</h3>
                            <span class="stock-badge" id="stockBadge">In Stock</span>
                        </div>
                        
                        <div class="product-description">
                            <h4>Description</h4>
                            <p id="productDescription">Product description here</p>
                        </div>

                        <div class="product-features">
                            <h4>Key Features</h4>
                            <ul id="productFeatures">
                                <li>Feature 1</li>
                                <li>Feature 2</li>
                            </ul>
                        </div>

                        <div class="product-specifications">
                            <h4>Specifications</h4>
                            <div class="specifications-grid" id="productSpecifications">
                                <div class="spec-item">
                                    <span class="spec-label">Brand:</span>
                                    <span class="spec-value">Brand Name</span>
                                </div>
                            </div>
                        </div>

                        <div class="product-actions">
                            <button class="btn btn-primary" onclick="addToCart()">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                            <button class="btn btn-success" onclick="buyNow()">
                                <i class="fas fa-bolt"></i> Buy Now
                            </button>
                            <button class="btn btn-wishlist" onclick="addToWishlist()" title="Add to Wishlist">
                                <i class="fas fa-heart"></i> Wishlist
                            </button>
                            <button class="btn btn-secondary" onclick="closeProductDetailsModal()">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h3><i class="fas fa-shopping-cart"></i> Shopping Cart</h3>
            <span class="close-cart" onclick="toggleCart()">&times;</span>
        </div>
        <div class="cart-content">
            <div class="cart-items" id="cartItems">
                <!-- Cart items will be dynamically added here -->
            </div>
            <div class="cart-empty" id="cartEmpty" style="display: none;">
                <i class="fas fa-shopping-cart"></i>
                <p>Your cart is empty</p>
                <button class="btn" onclick="closeCart()">Continue Shopping</button>
            </div>
            <div class="cart-summary" id="cartSummary" style="display: none;">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="cartSubtotal">KES 0</span>
                </div>
                <div class="summary-row">
                    <span>Shipping:</span>
                    <span id="cartShipping">KES 0</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span id="cartTotal">KES 0</span>
                </div>
                <button class="btn btn-primary checkout-btn" onclick="proceedToCheckout()">
                    <i class="fas fa-lock"></i> Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Wishlist Sidebar -->
    <div id="wishlistSidebar" class="wishlist-sidebar">
        <div class="wishlist-header">
            <h3><i class="fas fa-heart"></i> My Wishlist</h3>
            <span class="close-wishlist" onclick="toggleWishlist()">&times;</span>
        </div>
        <div class="wishlist-content">
            <div class="wishlist-items" id="wishlistItems">
                <!-- Wishlist items will be dynamically added here -->
            </div>
            <div class="wishlist-empty" id="wishlistEmpty" style="display: none;">
                <i class="fas fa-heart"></i>
                <p>Your wishlist is empty</p>
                <button class="btn" onclick="closeWishlist()">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeCart(); closeWishlist();"></div>

    <script>
        // Backend API URL
        const BACKEND_URL = 'https://my-backend-1-jk7w.onrender.com';

        // Global state
        let currentUser = null;

        // Modal functions - Make them global immediately
        window.showLoginModal = function() {
            console.log('showLoginModal called');
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'block';
                // Remove body scroll lock to allow website scrolling
                console.log('Login modal opened');
            } else {
                console.error('Login modal not found');
            }
        };

        window.showRegisterModal = function() {
            console.log('showRegisterModal called');
            const modal = document.getElementById('registerModal');
            if (modal) {
                modal.style.display = 'block';
                // Remove body scroll lock to allow website scrolling
                console.log('Register modal opened');
            } else {
                console.error('Register modal not found');
            }
        };

        window.showSellerRegisterModal = function() {
            console.log('showSellerRegisterModal called');
            const modal = document.getElementById('sellerRegisterModal');
            if (modal) {
                modal.style.display = 'block';
                // Remove body scroll lock to allow website scrolling
                console.log('Seller register modal opened');
            } else {
                console.error('Seller register modal not found');
            }
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Don't change body overflow - keep it as auto for normal scrolling
            clearFormErrors(modalId);
        };

        // Authentication System
        class AuthManager {
            constructor() {
                this.init();
            }

            async init() {
                // Check if user is logged in by calling backend session endpoint
                await this.checkAuthStatus();
                this.updateUI();
            }

            async checkAuthStatus() {
                try {
                    // First check localStorage for cached user data
                    const cachedUser = localStorage.getItem('ecoloopUser');
                    if (cachedUser) {
                        currentUser = JSON.parse(cachedUser);
                        this.updateUI();
                    }

                    // Then try to verify with backend
                    const response = await fetch(`${BACKEND_URL}/api/user/session`, {
                        method: 'GET',
                        credentials: 'include' // Important for HTTP-only cookies
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.user) {
                            currentUser = data.user;
                            // Cache user data in localStorage
                            localStorage.setItem('ecoloopUser', JSON.stringify(currentUser));
                            this.updateUI();
                        } else {
                            // Backend says no user, but we have cached data
                            if (cachedUser) {
                                // Keep using cached data until explicit logout
                                console.log('Using cached user session');
                            } else {
                                currentUser = null;
                                this.updateUI();
                            }
                        }
                    } else {
                        // Backend failed, but we have cached data
                        if (cachedUser) {
                            console.log('Backend unavailable, using cached user session');
                        } else {
                            currentUser = null;
                            this.updateUI();
                        }
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    // Network error, but we have cached data
                    const cachedUser = localStorage.getItem('ecoloopUser');
                    if (cachedUser) {
                        currentUser = JSON.parse(cachedUser);
                        this.updateUI();
                        console.log('Network error, using cached user session');
                    } else {
                        currentUser = null;
                        this.updateUI();
                    }
                }
            }

            async login(email, password, rememberMe = false) {
                try {
                    const response = await fetch(`${BACKEND_URL}/api/user/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include', // Important for HTTP-only cookies
                        body: JSON.stringify({ email, password, rememberMe })
                    });

                    const data = await response.json();

                    if (data.success) {
                        currentUser = data.user;
                        // Cache user data in localStorage
                        localStorage.setItem('ecoloopUser', JSON.stringify(currentUser));
                        this.updateUI();
                        showToast('Login successful!', 'success');
                        return { success: true };
                    } else {
                        return { success: false, error: data.error };
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    return { success: false, error: 'Network error. Please try again.' };
                }
            }

            async register(userData) {
                try {
                    const response = await fetch(`${BACKEND_URL}/api/user/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include', // Important for HTTP-only cookies
                        body: JSON.stringify(userData)
                    });

                    const data = await response.json();

                    if (data.success) {
                        currentUser = data.user;
                        this.updateUI();
                        showToast('Account created successfully!', 'success');
                        return { success: true };
                    } else {
                        return { success: false, error: data.error || 'Registration failed' };
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    return { success: false, error: 'Network error. Please try again.' };
                }
            }

            async sellerRegister(sellerData) {
                try {
                    const response = await fetch(`${BACKEND_URL}/api/seller/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(sellerData)
                    });

                    const data = await response.json();

                    if (response.ok) {
                        showToast('Seller registration successful! Please wait for admin approval.', 'success');
                        return { success: true };
                    } else {
                        return { success: false, error: data.error || 'Registration failed' };
                    }
                } catch (error) {
                    console.error('Seller registration error:', error);
                    return { success: false, error: 'Network error. Please try again.' };
                }
            }

            async logout() {
                try {
                    const response = await fetch(`${BACKEND_URL}/api/user/logout`, {
                        method: 'POST',
                        credentials: 'include' // Important for HTTP-only cookies
                    });
                    
                    // Clear user data regardless of backend response
                    currentUser = null;
                    localStorage.removeItem('ecoloopUser');
                    this.updateUI();
                    showToast('Logged out successfully!', 'success');
                    
                    if (!response.ok) {
                        console.log('Backend logout failed, but cleared local session');
                    }
                } catch (error) {
                    console.error('Logout error:', error);
                    // Clear user data on error
                    currentUser = null;
                    localStorage.removeItem('ecoloopUser');
                    this.updateUI();
                    showToast('Logged out successfully!', 'success');
                }
            }

            updateUI() {
                const userActions = document.querySelector('.user-actions');
                if (!userActions) return;

                if (currentUser) {
                // User is logged in - load cart and wishlist
                loadCartItems();
                loadWishlistItems();
                
                const initials = currentUser.name ? currentUser.name.charAt(0).toUpperCase() : currentUser.email.charAt(0).toUpperCase();
                userActions.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${initials}</div>
                        <span>${currentUser.name || currentUser.email}</span>
                        </div>
                        <a href="#" onclick="authManager.logout(); return false;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        <a href="#" onclick="showToast('Help section coming soon!', 'info'); return false;"><i class="fas fa-question-circle"></i> Help</a>
                        <a href="admin/admin-login.html"><i class="fas fa-leaf"></i> Admin</a>
                    `;
                } else {
                    // User is not logged in
                    userActions.innerHTML = `
                        <a href="#" onclick="showLoginModal(); return false;"><i class="fas fa-user"></i> Login</a>
                        <a href="#" onclick="showRegisterModal(); return false;"><i class="fas fa-user-plus"></i> Register</a>
                        <a href="#" onclick="showSellerRegisterModal(); return false;"><i class="fas fa-store"></i> Sell</a>
                        <a href="#" onclick="showToast('Help section coming soon!', 'info'); return false;"><i class="fas fa-question-circle"></i> Help</a>
                        <a href="admin/admin-login.html"><i class="fas fa-leaf"></i> Admin</a>
                    `;
                }
            }
        }

        // Initialize auth manager
        const authManager = new AuthManager();

        // Helper functions
        function clearFormErrors(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                const errorElements = modal.querySelectorAll('.error');
                errorElements.forEach(element => element.textContent = '');
            }
        }

        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            const buttonText = document.getElementById(buttonId.replace('Btn', 'BtnText'));
            
            if (loading) {
                button.disabled = true;
                buttonText.innerHTML = '<div class="spinner"></div>Processing...';
            } else {
                button.disabled = false;
                buttonText.textContent = buttonText.textContent.replace('Processing...', '').replace('<div class="spinner"></div>', '');
            }
        }

        function switchModal(fromModal, toModal) {
            closeModal(fromModal);
            setTimeout(() => {
                if (toModal === 'registerModal') showRegisterModal();
                else if (toModal === 'sellerRegisterModal') showSellerRegisterModal();
                else if (toModal === 'loginModal') showLoginModal();
            }, 300);
        }

        function clearFormErrors(modalId) {
            const modal = document.getElementById(modalId);
            const errorElements = modal.querySelectorAll('.error');
            errorElements.forEach(element => element.textContent = '');
        }

        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            const buttonText = document.getElementById(buttonId.replace('Btn', 'BtnText'));
            
            if (loading) {
                button.disabled = true;
                buttonText.innerHTML = '<div class="spinner"></div>Processing...';
            } else {
                button.disabled = false;
                buttonText.textContent = buttonText.textContent.replace('Processing...', '').replace('<div class="spinner"></div>', '');
            }
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePhone(phone) {
            const re = /^[\d\s\-\+\(\)]+$/;
            return re.test(phone) && phone.length >= 10;
        }

        // Form handlers
        async function handleLogin(event) {
            event.preventDefault();
            clearFormErrors('loginModal');

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            let isValid = true;

            if (!validateEmail(email)) {
                document.getElementById('loginEmailError').textContent = 'Please enter a valid email';
                isValid = false;
            }

            if (password.length < 6) {
                document.getElementById('loginPasswordError').textContent = 'Password must be at least 6 characters';
                isValid = false;
            }

            if (!isValid) return;

            setButtonLoading('loginBtn', true);

            const result = await authManager.login(email, password, rememberMe);

            setButtonLoading('loginBtn', false);

            if (result.success) {
                closeModal('loginModal');
                document.getElementById('loginForm').reset();
            } else {
                document.getElementById('loginEmailError').textContent = result.error;
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            clearFormErrors('registerModal');

            const firstName = document.getElementById('registerFirstName').value;
            const lastName = document.getElementById('registerLastName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            let isValid = true;

            if (firstName.length < 2) {
                document.getElementById('registerFirstNameError').textContent = 'First name must be at least 2 characters';
                isValid = false;
            }

            if (lastName.length < 2) {
                document.getElementById('registerLastNameError').textContent = 'Last name must be at least 2 characters';
                isValid = false;
            }

            if (!validateEmail(email)) {
                document.getElementById('registerEmailError').textContent = 'Please enter a valid email';
                isValid = false;
            }

            if (!validatePhone(phone)) {
                document.getElementById('registerPhoneError').textContent = 'Please enter a valid phone number';
                isValid = false;
            }

            if (password.length < 6) {
                document.getElementById('registerPasswordError').textContent = 'Password must be at least 6 characters';
                isValid = false;
            }

            if (password !== confirmPassword) {
                document.getElementById('registerConfirmPasswordError').textContent = 'Passwords do not match';
                isValid = false;
            }

            if (!isValid) return;

            setButtonLoading('registerBtn', true);

            const userData = {
                firstName,
                lastName,
                email,
                phone,
                password
            };

            const result = await authManager.register(userData);

            setButtonLoading('registerBtn', false);

            if (result.success) {
                closeModal('registerModal');
                document.getElementById('registerForm').reset();
                setTimeout(() => showLoginModal(), 1000);
            } else {
                document.getElementById('registerEmailError').textContent = result.error;
            }
        }

        async function handleSellerRegister(event) {
            event.preventDefault();
            clearFormErrors('sellerRegisterModal');

            const firstName = document.getElementById('sellerFirstName').value;
            const lastName = document.getElementById('sellerLastName').value;
            const email = document.getElementById('sellerEmail').value;
            const phone = document.getElementById('sellerPhone').value;
            const password = document.getElementById('sellerPassword').value;
            const confirmPassword = document.getElementById('sellerConfirmPassword').value;
            const businessName = document.getElementById('businessName').value;
            const businessType = document.getElementById('businessType').value;
            const businessDescription = document.getElementById('businessDescription').value;
            const businessAddress = document.getElementById('businessAddress').value;
            const businessCity = document.getElementById('businessCity').value;
            const businessCountry = document.getElementById('businessCountry').value;

            let isValid = true;

            if (firstName.length < 2) {
                document.getElementById('sellerFirstNameError').textContent = 'First name must be at least 2 characters';
                isValid = false;
            }

            if (lastName.length < 2) {
                document.getElementById('sellerLastNameError').textContent = 'Last name must be at least 2 characters';
                isValid = false;
            }

            if (!validateEmail(email)) {
                document.getElementById('sellerEmailError').textContent = 'Please enter a valid email';
                isValid = false;
            }

            if (!validatePhone(phone)) {
                document.getElementById('sellerPhoneError').textContent = 'Please enter a valid phone number';
                isValid = false;
            }

            if (password.length < 6) {
                document.getElementById('sellerPasswordError').textContent = 'Password must be at least 6 characters';
                isValid = false;
            }

            if (password !== confirmPassword) {
                document.getElementById('sellerConfirmPasswordError').textContent = 'Passwords do not match';
                isValid = false;
            }

            if (businessName.length < 2) {
                document.getElementById('businessNameError').textContent = 'Business name must be at least 2 characters';
                isValid = false;
            }

            if (!businessType) {
                document.getElementById('businessTypeError').textContent = 'Please select a business type';
                isValid = false;
            }

            if (businessDescription.length < 10) {
                document.getElementById('businessDescriptionError').textContent = 'Business description must be at least 10 characters';
                isValid = false;
            }

            if (!isValid) return;

            setButtonLoading('sellerRegisterBtn', true);

            const sellerData = {
                name: `${firstName} ${lastName}`,
                email,
                phone,
                password,
                businessName,
                businessType,
                businessDescription,
                businessAddress,
                businessCity,
                businessCountry
            };

            const result = await authManager.sellerRegister(sellerData);

            setButtonLoading('sellerRegisterBtn', false);

            if (result.success) {
                closeModal('sellerRegisterModal');
                document.getElementById('sellerRegisterForm').reset();
                setTimeout(() => showLoginModal(), 2000);
            } else {
                document.getElementById('sellerEmailError').textContent = result.error;
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
                clearFormErrors(event.target.id);
            }
        });

        // Toast notification function
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, duration);
        }

        // Categories data
        const categories = [
            { name: "Electronics", icon: "fa-microchip", count: 0 },
            { name: "Fashion", icon: "fa-hat-cowboy", count: 0 },
            { name: "Gaming", icon: "fa-dragon", count: 0 },
            { name: "Home & Kitchen", icon: "fa-blender", count: 0 },
            { name: "Sports", icon: "fa-dumbbell", count: 0 },
            { name: "Books", icon: "fa-book-open", count: 0 }
        ];

        // Enhanced products data with full details
        const sampleProducts = [
            {
                id: 1,
                title: "Wireless Headphones",
                price: "KES 2,500",
                description: "High-quality wireless headphones with noise cancellation",
                category: "Electronics",
                image: "https://via.placeholder.com/300x200/2ecc71/ffffff?text=Headphones",
                specifications: {
                    "Brand": "EcoSound",
                    "Connectivity": "Bluetooth 5.0",
                    "Battery Life": "30 hours",
                    "Noise Cancellation": "Active ANC",
                    "Weight": "250g",
                    "Color": "Midnight Black"
                },
                rating: 4.5,
                stock: 15,
                features: ["Active Noise Cancellation", "30-hour battery life", "Premium sound quality", "Comfortable fit"]
            },
            {
                id: 2,
                title: "Smart Watch",
                price: "KES 5,000",
                description: "Feature-rich smartwatch with health tracking",
                category: "Electronics",
                image: "https://via.placeholder.com/300x200/3498db/ffffff?text=Smart+Watch",
                specifications: {
                    "Brand": "EcoTime",
                    "Display": "1.4\" AMOLED",
                    "Battery Life": "7 days",
                    "Water Resistance": "IP68",
                    "Compatibility": "iOS & Android",
                    "Sensors": "Heart rate, GPS, Accelerometer"
                },
                rating: 4.3,
                stock: 8,
                features: ["Heart rate monitoring", "GPS tracking", "Water resistant", "7-day battery"]
            },
            {
                id: 3,
                title: "Running Shoes",
                price: "KES 3,500",
                description: "Comfortable running shoes for all terrains",
                category: "Sports",
                image: "https://via.placeholder.com/300x200/e74c3c/ffffff?text=Shoes",
                specifications: {
                    "Brand": "EcoRun",
                    "Material": "Recycled polyester",
                    "Weight": "280g",
                    "Sole": "Eco-friendly rubber",
                    "Sizes": "US 6-12",
                    "Gender": "Unisex"
                },
                rating: 4.7,
                stock: 25,
                features: ["Eco-friendly materials", "All-terrain grip", "Breathable design", "Arch support"]
            },
            {
                id: 4,
                title: "Coffee Maker",
                price: "KES 4,200",
                description: "Automatic coffee maker with timer",
                category: "Home & Kitchen",
                image: "https://via.placeholder.com/300x200/f39c12/ffffff?text=Coffee+Maker",
                specifications: {
                    "Brand": "EcoBrew",
                    "Capacity": "12 cups",
                    "Programmable": "Yes, 24-hour timer",
                    "Auto Shut-off": "2 hours",
                    "Power": "900W",
                    "Material": "Stainless steel"
                },
                rating: 4.4,
                stock: 12,
                features: ["Programmable timer", "Auto shut-off", "12-cup capacity", "Easy cleaning"]
            },
            {
                id: 5,
                title: "Laptop Backpack",
                price: "KES 1,800",
                description: "Durable backpack with laptop compartment",
                category: "Fashion",
                image: "https://via.placeholder.com/300x200/9b59b6/ffffff?text=Backpack",
                specifications: {
                    "Brand": "EcoCarry",
                    "Material": "Recycled fabric",
                    "Laptop Compartment": "Up to 15.6\"",
                    "Capacity": "25L",
                    "Water Resistant": "Yes",
                    "Weight": "600g"
                },
                rating: 4.6,
                stock: 20,
                features: ["Laptop protection", "Water resistant", "Multiple pockets", "Eco-friendly materials"]
            },
            {
                id: 6,
                title: "Programming Book",
                price: "KES 1,200",
                description: "Learn programming with this comprehensive guide",
                category: "Books",
                image: "https://via.placeholder.com/300x200/1abc9c/ffffff?text=Book",
                specifications: {
                    "Title": "Modern Web Development",
                    "Author": "EcoTech Press",
                    "Pages": "450",
                    "Language": "English",
                    "Format": "Paperback",
                    "ISBN": "978-123-456-789"
                },
                rating: 4.8,
                stock: 30,
                features: ["Comprehensive guide", "Practical examples", "Latest technologies", "Beginner friendly"]
            }
        ];

        // Initialize website
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸŒ EcoLoop Kenya - Website initialized');
            loadCategories();
            loadProducts();
            setupSearch();
        });

        // Load categories
        function loadCategories() {
            const grid = document.getElementById('categoriesGrid');
            if (!grid) return;
            
            // Update category counts based on products
            categories.forEach(category => {
                category.count = sampleProducts.filter(p => p.category === category.name).length;
            });
            
            grid.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }

        // Create category card
        function createCategoryCard(category) {
            return `
                <div class="category-card" onclick="filterByCategory('${category.name}')">
                    <div class="category-icon">
                        <i class="fas ${category.icon}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    <div class="category-count">${category.count} Products</div>
                </div>
            `;
        }

        // Load products
        function loadProducts(categoryFilter = null) {
            const grid = document.getElementById('productsGrid');
            if (!grid) return;
            
            let productsToShow = categoryFilter 
                ? sampleProducts.filter(p => p.category === categoryFilter)
                : sampleProducts;
            
            if (productsToShow.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px;">No products found in this category.</div>';
                return;
            }
            
            grid.innerHTML = productsToShow.map(product => createProductCard(product)).join('');
        }

        // Create product card
        function createProductCard(product) {
            return `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.title}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-price">${product.price}</div>
                        <p class="product-description">${product.description}</p>
                        <div class="product-actions">
                            <button class="btn" onclick="showProductDetails(${product.id})">View Details</button>
                            <button class="btn btn-wishlist" onclick="addToWishlist(${product.id})" title="Add to Wishlist">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter by category
        function filterByCategory(categoryName) {
            loadProducts(categoryName);
            showToast(`Showing products in ${categoryName}`, 'success');
            
            // Scroll to products section
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }

        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
        }

        // Perform search
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) return;
            
            const results = sampleProducts.filter(p => 
                p.title.toLowerCase().includes(searchTerm) ||
                p.category.toLowerCase().includes(searchTerm) ||
                p.description.toLowerCase().includes(searchTerm)
            );
            
            const grid = document.getElementById('productsGrid');
            if (results.length > 0) {
                grid.innerHTML = results.map(product => createProductCard(product)).join('');
                showToast(`Found ${results.length} products for "${searchTerm}"`, 'success');
            } else {
                grid.innerHTML = '<div style="text-align: center; padding: 40px;">No products found for your search.</div>';
                showToast('No products found', 'warning');
            }
            
            // Scroll to products section
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize website
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸŒ EcoLoop Kenya - Website initialized');
            loadCategories();
            loadProducts();
            setupSearch();
        });

        // Product Details Functions
        let currentProduct = null;

        // Show product details modal
        function showProductDetails(productId) {
            const product = sampleProducts.find(p => p.id === productId);
            if (!product) {
                showToast('Product not found', 'error');
                return;
            }

            currentProduct = product;
            
            // Populate modal with product data
            document.getElementById('productTitle').textContent = product.title;
            document.getElementById('productImage').src = product.image;
            document.getElementById('productImage').alt = product.title;
            document.getElementById('productPrice').textContent = product.price;
            document.getElementById('productDescription').textContent = product.description;
            
            // Set rating
            const ratingStars = generateStars(product.rating || 4);
            document.getElementById('productRating').innerHTML = ratingStars;
            document.getElementById('ratingValue').textContent = `(${product.rating || 4.0})`;
            
            // Set stock badge
            const stockBadge = document.getElementById('stockBadge');
            if (product.stock > 0) {
                stockBadge.textContent = `In Stock (${product.stock})`;
                stockBadge.className = 'stock-badge';
            } else {
                stockBadge.textContent = 'Out of Stock';
                stockBadge.className = 'stock-badge out-of-stock';
            }
            
            // Set features
            const featuresList = document.getElementById('productFeatures');
            if (product.features && product.features.length > 0) {
                featuresList.innerHTML = product.features.map(feature => `<li>${feature}</li>`).join('');
            } else {
                featuresList.innerHTML = '<li>No specific features listed</li>';
            }
            
            // Set specifications
            const specificationsGrid = document.getElementById('productSpecifications');
            if (product.specifications) {
                specificationsGrid.innerHTML = Object.entries(product.specifications)
                    .map(([key, value]) => `
                        <div class="spec-item">
                            <span class="spec-label">${key}:</span>
                            <span class="spec-value">${value}</span>
                        </div>
                    `).join('');
            } else {
                specificationsGrid.innerHTML = '<div class="spec-item"><span class="spec-label">No specifications available</span></div>';
            }
            
            // Show modal
            document.getElementById('productDetailsModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            console.log(`ðŸ“¦ Showing details for product: ${product.title}`);
        }

        // Close product details modal
        function closeProductDetailsModal() {
            document.getElementById('productDetailsModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentProduct = null;
        }

        // Generate star rating HTML
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;
            
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += 'â˜…';
            }
            if (halfStar) {
                stars += 'â˜†';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += 'â˜†';
            }
            
            return stars;
        }

        // Add to cart functionality
        function addToCart(productId = null) {
            const product = productId ? sampleProducts.find(p => p.id === productId) : currentProduct;
            if (!product) {
                showToast('No product selected', 'error');
                return;
            }
            
            if (product.stock <= 0) {
                showToast('Product is out of stock', 'error');
                return;
            }

            // Check if user is logged in
            if (!currentUser) {
                showToast('Please login to add items to cart', 'info');
                showLoginModal();
                return;
            }

            // Add to cart with animation
            animateItemToCart(productId || product.id);
            
            // Call backend API
            addToCartBackend(product.id, 1);
        }

        // Backend cart functions
        async function addToCartBackend(productId, quantity) {
            try {
                // Try backend API first
                const response = await fetch(`${BACKEND_URL}/api/cart/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ productId, quantity })
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('Product added to cart', 'success');
                    updateCartBadge();
                    loadCartItems();
                } else {
                    throw new Error(data.message || 'Backend failed');
                }
            } catch (error) {
                console.log('Backend cart add failed, using localStorage fallback:', error);
                // Fallback to localStorage
                addToCartLocalStorage(productId, quantity);
            }
        }

        // LocalStorage fallback functions
        function addToCartLocalStorage(productId, quantity) {
            const product = sampleProducts.find(p => p.id === productId);
            if (!product) return;

            let cart = JSON.parse(localStorage.getItem('ecoloopCart') || '[]');
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
                showToast('Cart quantity updated', 'success');
            } else {
                cart.push({
                    id: productId,
                    title: product.title,
                    price: product.price,
                    image: product.image,
                    quantity: quantity
                });
                showToast('Product added to cart', 'success');
            }
            
            localStorage.setItem('ecoloopCart', JSON.stringify(cart));
            updateCartBadge();
            renderCartItems(cart);
        }

        async function removeFromCart(productId) {
            try {
                const response = await fetch(`${BACKEND_URL}/api/cart/remove`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ productId })
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('Item removed from cart', 'success');
                    updateCartBadge();
                    loadCartItems();
                } else {
                    showToast(data.message || 'Failed to remove item', 'error');
                }
            } catch (error) {
                console.error('Cart remove error:', error);
                showToast('Failed to remove item', 'error');
            }
        }

        async function updateCartQuantity(productId, quantity) {
            try {
                const response = await fetch(`${BACKEND_URL}/api/cart/update`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ productId, quantity })
                });

                const data = await response.json();
                
                if (data.success) {
                    updateCartBadge();
                    loadCartItems();
                } else {
                    showToast(data.message || 'Failed to update quantity', 'error');
                }
            } catch (error) {
                console.error('Cart update error:', error);
                showToast('Failed to update quantity', 'error');
            }
        }

        async function loadCartItems() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/cart`, {
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (data.success) {
                    renderCartItems(data.cart);
                    updateCartBadge();
                }
            } catch (error) {
                console.error('Load cart error:', error);
            }
        }

        function renderCartItems(cartItems) {
            const cartItemsContainer = document.getElementById('cartItems');
            const cartEmpty = document.getElementById('cartEmpty');
            const cartSummary = document.getElementById('cartSummary');
            
            if (!cartItems || cartItems.length === 0) {
                cartItemsContainer.innerHTML = '';
                cartEmpty.style.display = 'block';
                cartSummary.style.display = 'none';
                return;
            }

            cartEmpty.style.display = 'none';
            cartSummary.style.display = 'block';

            let subtotal = 0;
            const itemsHTML = cartItems.map(item => {
                const product = sampleProducts.find(p => p.id === item.productId);
                if (!product) return '';
                
                const itemTotal = parseFloat(product.price.replace(/[^\d.]/g, '')) * item.quantity;
                subtotal += itemTotal;
                
                return `
                    <div class="cart-item">
                        <img src="${product.image}" alt="${product.title}" class="cart-item-image">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${product.title}</div>
                            <div class="cart-item-price">${product.price}</div>
                            <div class="cart-item-quantity">
                                <span>Qty:</span>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="updateCartQuantity(${item.productId}, ${item.quantity - 1})">-</button>
                                    <span class="quantity-value">${item.quantity}</span>
                                    <button class="quantity-btn" onclick="updateCartQuantity(${item.productId}, ${item.quantity + 1})">+</button>
                                </div>
                            </div>
                            <div class="cart-item-actions">
                                <button class="btn-remove" onclick="removeFromCart(${item.productId})">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            cartItemsContainer.innerHTML = itemsHTML;

            // Update summary
            const shipping = subtotal > 0 ? 200 : 0; // KES 200 shipping
            const total = subtotal + shipping;
            
            document.getElementById('cartSubtotal').textContent = `KES ${subtotal.toFixed(2)}`;
            document.getElementById('cartShipping').textContent = `KES ${shipping.toFixed(2)}`;
            document.getElementById('cartTotal').textContent = `KES ${total.toFixed(2)}`;
        }

        // Wishlist functions
        function addToWishlist(productId = null) {
            const product = productId ? sampleProducts.find(p => p.id === productId) : currentProduct;
            if (!product) {
                showToast('No product selected', 'error');
                return;
            }

            // Check if user is logged in
            if (!currentUser) {
                showToast('Please login to add items to wishlist', 'info');
                showLoginModal();
                return;
            }

            // Add to wishlist with animation
            animateItemToWishlist(productId || product.id);
            
            // Call backend API
            addToWishlistBackend(product.id);
        }

        async function addToWishlistBackend(productId) {
            try {
                // Try backend API first
                const response = await fetch(`${BACKEND_URL}/api/wishlist/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ productId })
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('Product added to wishlist', 'success');
                    updateWishlistBadge();
                    loadWishlistItems();
                } else {
                    throw new Error(data.message || 'Backend failed');
                }
            } catch (error) {
                console.log('Backend wishlist add failed, using localStorage fallback:', error);
                // Fallback to localStorage
                addToWishlistLocalStorage(productId);
            }
        }

        function addToWishlistLocalStorage(productId) {
            const product = sampleProducts.find(p => p.id === productId);
            if (!product) return;

            let wishlist = JSON.parse(localStorage.getItem('ecoloopWishlist') || '[]');
            const existingItem = wishlist.find(item => item.id === productId);
            
            if (existingItem) {
                showToast('Product already in wishlist', 'info');
            } else {
                wishlist.push({
                    id: productId,
                    title: product.title,
                    price: product.price,
                    image: product.image
                });
                showToast('Product added to wishlist', 'success');
            }
            
            localStorage.setItem('ecoloopWishlist', JSON.stringify(wishlist));
            updateWishlistBadge();
            renderWishlistItems(wishlist);
        }

        async function removeFromWishlist(productId) {
            try {
                // Try backend API first
                const response = await fetch(`${BACKEND_URL}/api/wishlist/remove`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ productId })
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('Item removed from wishlist', 'success');
                    updateWishlistBadge();
                    loadWishlistItems();
                } else {
                    throw new Error(data.message || 'Backend failed');
                }
            } catch (error) {
                console.log('Backend wishlist remove failed, using localStorage fallback:', error);
                // Fallback to localStorage
                removeFromWishlistLocalStorage(productId);
            }
        }

        function removeFromWishlistLocalStorage(productId) {
            let wishlist = JSON.parse(localStorage.getItem('ecoloopWishlist') || '[]');
            wishlist = wishlist.filter(item => item.id !== productId);
            localStorage.setItem('ecoloopWishlist', JSON.stringify(wishlist));
            showToast('Item removed from wishlist', 'success');
            updateWishlistBadge();
            renderWishlistItems(wishlist);
        }

        async function moveToCartFromWishlist(productId) {
            try {
                // Try backend API first
                const response = await fetch(`${BACKEND_URL}/api/wishlist/move-to-cart`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ productId })
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast('Item moved to cart', 'success');
                    updateWishlistBadge();
                    updateCartBadge();
                    loadWishlistItems();
                    loadCartItems();
                } else {
                    throw new Error(data.message || 'Backend failed');
                }
            } catch (error) {
                console.log('Backend move to cart failed, using localStorage fallback:', error);
                // Fallback to localStorage
                moveToCartFromWishlistLocalStorage(productId);
            }
        }

        function moveToCartFromWishlistLocalStorage(productId) {
            // Remove from wishlist
            let wishlist = JSON.parse(localStorage.getItem('ecoloopWishlist') || '[]');
            wishlist = wishlist.filter(item => item.id !== productId);
            localStorage.setItem('ecoloopWishlist', JSON.stringify(wishlist));
            
            // Add to cart
            addToCartLocalStorage(productId, 1);
            
            showToast('Item moved to cart', 'success');
            updateWishlistBadge();
            renderWishlistItems(wishlist);
        }

        async function loadWishlistItems() {
            try {
                // Try backend API first
                const response = await fetch(`${BACKEND_URL}/api/wishlist`, {
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (data.success) {
                    renderWishlistItems(data.wishlist);
                    updateWishlistBadge();
                } else {
                    throw new Error(data.message || 'Backend failed');
                }
            } catch (error) {
                console.log('Backend wishlist load failed, using localStorage fallback:', error);
                // Fallback to localStorage
                const wishlist = JSON.parse(localStorage.getItem('ecoloopWishlist') || '[]');
                renderWishlistItems(wishlist);
                updateWishlistBadge();
            }
        }

        function renderWishlistItems(wishlistItems) {
            const wishlistItemsContainer = document.getElementById('wishlistItems');
            const wishlistEmpty = document.getElementById('wishlistEmpty');
            
            if (!wishlistItems || wishlistItems.length === 0) {
                wishlistItemsContainer.innerHTML = '';
                wishlistEmpty.style.display = 'block';
                return;
            }

            wishlistEmpty.style.display = 'none';

            const itemsHTML = wishlistItems.map(item => {
                // Handle both backend format (item.productId) and localStorage format (item.id)
                const productId = item.productId || item.id;
                const product = sampleProducts.find(p => p.id === productId);
                if (!product) return '';
                
                return `
                    <div class="wishlist-item">
                        <img src="${product.image}" alt="${product.title}" class="wishlist-item-image">
                        <div class="wishlist-item-details">
                            <div class="wishlist-item-title">${product.title}</div>
                            <div class="wishlist-item-price">${product.price}</div>
                            <div class="wishlist-item-actions">
                                <button class="btn-move-to-cart" onclick="moveToCartFromWishlist(${productId})">
                                    <i class="fas fa-shopping-cart"></i> Move to Cart
                                </button>
                                <button class="btn-remove" onclick="removeFromWishlist(${productId})">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            wishlistItemsContainer.innerHTML = itemsHTML;
        }

        // UI Functions
        function toggleCart() {
            const cartSidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('overlay');
            
            if (cartSidebar.classList.contains('open')) {
                closeCart();
            } else {
                openCart();
            }
        }

        function openCart() {
            const cartSidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('overlay');
            
            cartSidebar.classList.add('open');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            loadCartItems();
        }

        function closeCart() {
            const cartSidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('overlay');
            
            cartSidebar.classList.remove('open');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function toggleWishlist() {
            const wishlistSidebar = document.getElementById('wishlistSidebar');
            const overlay = document.getElementById('overlay');
            
            if (wishlistSidebar.classList.contains('open')) {
                closeWishlist();
            } else {
                openWishlist();
            }
        }

        function openWishlist() {
            const wishlistSidebar = document.getElementById('wishlistSidebar');
            const overlay = document.getElementById('overlay');
            
            wishlistSidebar.classList.add('open');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            loadWishlistItems();
        }

        function closeWishlist() {
            const wishlistSidebar = document.getElementById('wishlistSidebar');
            const overlay = document.getElementById('overlay');
            
            wishlistSidebar.classList.remove('open');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            if (!badge) return;
            
            // Get cart count from backend or localStorage as fallback
            const cartItems = JSON.parse(localStorage.getItem('ecoloopCart') || '[]');
            const count = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            
            badge.textContent = count;
            badge.classList.add('animate');
            setTimeout(() => badge.classList.remove('animate'), 600);
        }

        function updateWishlistBadge() {
            const badge = document.getElementById('wishlistBadge');
            if (!badge) return;
            
            // Get wishlist count from backend or localStorage as fallback
            const wishlistItems = JSON.parse(localStorage.getItem('ecoloopWishlist') || '[]');
            const count = wishlistItems.length;
            
            badge.textContent = count;
            badge.classList.add('animate');
            setTimeout(() => badge.classList.remove('animate'), 600);
        }

        function proceedToCheckout() {
            if (!currentUser) {
                showToast('Please login to proceed to checkout', 'info');
                showLoginModal();
                return;
            }
            
            showToast('Proceeding to checkout...', 'info');
            // In a real app, this would redirect to checkout page
            setTimeout(() => {
                closeCart();
                showToast('Checkout functionality coming soon!', 'info');
            }, 1000);
        }

        // Animation functions
        function animateItemToCart(productId) {
            const productCard = document.querySelector(`[onclick*="${productId}"]`);
            const cartIcon = document.querySelector('.icon-wrapper[onclick*="toggleCart"]');
            
            if (productCard && cartIcon) {
                const cartRect = cartIcon.getBoundingClientRect();
                const productRect = productCard.getBoundingClientRect();
                
                // Create flying item animation
                const flyingItem = document.createElement('div');
                flyingItem.innerHTML = '<i class="fas fa-shopping-cart" style="color: #00ffff; font-size: 20px;"></i>';
                flyingItem.style.cssText = `
                    position: fixed;
                    top: ${productRect.top}px;
                    left: ${productRect.left}px;
                    z-index: 10002;
                    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                `;
                
                document.body.appendChild(flyingItem);
                
                setTimeout(() => {
                    flyingItem.style.top = cartRect.top + 'px';
                    flyingItem.style.left = cartRect.left + 'px';
                    flyingItem.style.transform = 'scale(0)';
                    flyingItem.style.opacity = '0';
                }, 10);
                
                setTimeout(() => {
                    document.body.removeChild(flyingItem);
                }, 800);
            }
        }

        function animateItemToWishlist(productId) {
            const productCard = document.querySelector(`[onclick*="${productId}"]`);
            const wishlistIcon = document.querySelector('.icon-wrapper[onclick*="toggleWishlist"]');
            
            if (productCard && wishlistIcon) {
                const wishlistRect = wishlistIcon.getBoundingClientRect();
                const productRect = productCard.getBoundingClientRect();
                
                // Create flying item animation
                const flyingItem = document.createElement('div');
                flyingItem.innerHTML = '<i class="fas fa-heart" style="color: #e74c3c; font-size: 20px;"></i>';
                flyingItem.style.cssText = `
                    position: fixed;
                    top: ${productRect.top}px;
                    left: ${productRect.left}px;
                    z-index: 10002;
                    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                `;
                
                document.body.appendChild(flyingItem);
                
                setTimeout(() => {
                    flyingItem.style.top = wishlistRect.top + 'px';
                    flyingItem.style.left = wishlistRect.left + 'px';
                    flyingItem.style.transform = 'scale(0)';
                    flyingItem.style.opacity = '0';
                }, 10);
                
                setTimeout(() => {
                    document.body.removeChild(flyingItem);
                }, 800);
            }
        }

        // Buy now functionality
        function buyNow() {
            if (!currentProduct) {
                showToast('No product selected', 'error');
                return;
            }
            
            if (currentProduct.stock <= 0) {
                showToast('Product is out of stock', 'error');
                return;
            }
            
            // Add to cart and redirect to checkout (or show checkout modal)
            addToCart();
            
            // In a real app, this would redirect to checkout
            showToast('Proceeding to checkout...', 'info');
            
            // For now, just close the modal
            setTimeout(() => {
                closeProductDetailsModal();
            }, 1000);
        }

        // Update cart count display
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('ecoloopCart') || '[]');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update cart count if cart icon exists
            const cartCountElements = document.querySelectorAll('.cart-count');
            cartCountElements.forEach(element => {
                element.textContent = totalItems;
            });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const productModal = document.getElementById('productDetailsModal');
            if (event.target === productModal) {
                closeProductDetailsModal();
            }
        }

        // Initialize cart count on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateCartBadge();
            updateWishlistBadge();
        });

        </script>
        <script src="assets/js/productLayer.js"></script>
</body>
</html>
