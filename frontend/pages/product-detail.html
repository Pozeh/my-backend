<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - EcoLoop Kenya</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7931e;
            --dark-color: #2c3e50;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --text-muted: #6c757d;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body {
            background: var(--light-bg);
            color: var(--dark-color);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-button {
            background: var(--light-bg);
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--primary-color);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-action {
            background: white;
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            position: relative;
        }

        .header-action:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        /* Product Detail Container */
        .product-detail-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .product-detail-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }

        /* Product Images */
        .product-images {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-image-container {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: var(--light-bg);
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .main-image:hover {
            transform: scale(1.05);
        }

        .image-thumbnails {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Product Info */
        .product-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .product-title {
            font-size: 32px;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 10px;
            line-height: 1.2;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .stars {
            color: var(--warning-color);
            font-size: 18px;
        }

        .rating-count {
            color: var(--text-muted);
            font-size: 14px;
        }

        .product-price-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .current-price {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .original-price {
            font-size: 20px;
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .discount-percent {
            background: var(--danger-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
        }

        .product-description {
            color: var(--text-muted);
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .product-details {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: var(--dark-color);
        }

        .detail-value {
            color: var(--text-muted);
        }

        /* Seller Info */
        .seller-info {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .seller-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .seller-name {
            font-size: 18px;
            font-weight: bold;
        }

        .seller-rating {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .seller-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .seller-detail-item {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Action Buttons */
        .product-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #e55a2b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .quantity-btn {
            background: var(--light-bg);
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .quantity-input {
            border: none;
            padding: 10px 15px;
            width: 60px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid var(--light-bg);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark-color);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10000;
            font-weight: 600;
            font-size: 14px;
            opacity: 0.85;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateX(0) scale(1.05);
            opacity: 0.9;
        }

        .toast.hide {
            transform: translateX(400px) scale(0.8);
            opacity: 0;
        }

        .toast.success {
            background: linear-gradient(135deg, var(--success-color), #22c55e);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .toast.error {
            background: linear-gradient(135deg, var(--danger-color), #ef4444);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .toast.warning {
            background: linear-gradient(135deg, var(--warning-color), #f59e0b);
            border-color: rgba(245, 158, 11, 0.3);
        }

        .toast.info {
            background: linear-gradient(135deg, var(--info-color), #3b82f6);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .toast.cart {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            border-color: rgba(255, 107, 53, 0.3);
        }

        .toast.wishlist {
            background: linear-gradient(135deg, #ec4899, #f43f5e);
            border-color: rgba(236, 72, 153, 0.3);
        }

        .toast i {
            font-size: 16px;
            margin-right: 8px;
        }

        /* Enhanced Product Detail Styles */
        .product-header {
            margin-bottom: 20px;
        }

        .product-meta {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .product-sku {
            background: #f1f5f9;
            color: #64748b;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .condition-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .condition-tag.like-new {
            background: #dcfce7;
            color: #166534;
        }

        .condition-tag.excellent {
            background: #dbeafe;
            color: #1e40af;
        }

        .condition-tag.good {
            background: #fef3c7;
            color: #92400e;
        }

        .condition-tag.fair {
            background: #fed7aa;
            color: #9a3412;
        }

        .condition-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .rating-stars {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rating-number {
            font-weight: 700;
            color: var(--text-primary);
        }

        .rating-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .rating-separator {
            color: #cbd5e1;
        }

        .sold-count {
            color: var(--success-color);
            font-weight: 500;
        }

        .price-main {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .price-info {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .shipping-info, .warranty-info {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .shipping-info i, .warranty-info i {
            color: var(--primary-color);
        }

        .product-description h3,
        .product-specifications h3,
        .product-features h3,
        .whats-in-box h3,
        .technical-specs h3,
        .seller-section h3,
        .product-tags h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 30px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        .product-description p {
            line-height: 1.6;
            color: var(--text-secondary);
            margin: 0;
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f8fafc;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
        }

        .spec-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .spec-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .features-list, .included-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .features-list li, .included-items li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .features-list li:last-child, .included-items li:last-child {
            border-bottom: none;
        }

        .features-list i, .included-items i {
            color: var(--success-color);
            font-size: 14px;
        }

        .specs-table {
            background: #f8fafc;
            border-radius: 8px;
            overflow: hidden;
        }

        .spec-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .spec-row:last-child {
            border-bottom: none;
        }

        .spec-row:nth-child(even) {
            background: white;
        }

        .spec-key {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .spec-val {
            font-weight: 600;
            color: var(--text-primary);
        }

        .availability-info {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
        }

        .stock-status, .shipping-info, .return-policy {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stock-status:last-child,
        .shipping-info:last-child,
        .return-policy:last-child {
            border-bottom: none;
        }

        .stock-label, .shipping-label, .return-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .stock-value.in-stock {
            color: var(--success-color);
            font-weight: 600;
        }

        .stock-value.out-of-stock {
            color: var(--danger-color);
            font-weight: 600;
        }

        .stock-quantity {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .seller-section {
            margin: 30px 0;
        }

        .seller-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .seller-header {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .seller-avatar {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .seller-info {
            flex: 1;
        }

        .seller-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .seller-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .seller-review-count {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .seller-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--success-color);
            font-size: 14px;
            font-weight: 500;
        }

        .seller-details {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
        }

        .seller-contact {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .contact-item i {
            color: var(--primary-color);
            width: 16px;
        }

        .seller-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: center;
        }

        .stat-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .stat-number {
            display: block;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-tags {
            margin: 30px 0;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background: var(--light-bg);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }

        .purchase-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid var(--border-color);
        }

        .product-history {
            margin-top: 30px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 14px;
        }

        .history-label {
            color: var(--text-secondary);
        }

        .history-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Product Options Styles */
        .product-variants,
        .product-colors,
        .product-sizes,
        .shipping-options,
        .payment-options {
            margin: 30px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .product-variants h3,
        .product-colors h3,
        .product-sizes h3,
        .shipping-options h3,
        .payment-options h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }

        .variant-group {
            margin-bottom: 20px;
        }

        .variant-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .variant-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .variant-option {
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .variant-option:hover {
            border-color: var(--primary-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .variant-option.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .color-option {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }

        .color-option.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-color);
        }

        .size-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .size-option {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            min-width: 60px;
        }

        .size-option:hover:not(:disabled) {
            border-color: var(--primary-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .size-option.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .size-option:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .shipping-methods {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .shipping-option {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shipping-option:hover {
            border-color: var(--primary-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .shipping-option.selected {
            border-color: var(--primary-color);
            background: rgba(255, 107, 53, 0.1);
        }

        .shipping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .shipping-method {
            font-weight: 600;
            color: var(--dark-color);
        }

        .shipping-cost {
            font-weight: 600;
            color: var(--primary-color);
        }

        .shipping-time {
            font-size: 14px;
            color: var(--text-muted);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
        }

        .payment-method i {
            color: var(--primary-color);
            font-size: 18px;
        }

        .payment-method .available {
            color: var(--success-color);
            font-weight: 600;
        }

        .payment-method .unavailable {
            color: var(--danger-color);
            font-weight: 600;
        }

        .price-negotiable {
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffc107;
            border-radius: 8px;
        }

        .negotiable-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #856404;
            font-weight: 500;
        }

        .negotiable-info i {
            color: #ffc107;
            font-size: 18px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .product-detail-card {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 30px;
            }

            .product-title {
                font-size: 24px;
            }

            .current-price {
                font-size: 24px;
            }

            .product-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .specs-grid {
                grid-template-columns: 1fr;
            }

            .seller-details {
                grid-template-columns: 1fr;
            }

            .seller-stats {
                flex-direction: row;
                justify-content: space-around;
            }

            .price-main {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .rating-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <button class="back-button" onclick="goBack()" title="Go Back">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back</span>
                </button>
                <button class="back-button" onclick="goToShop()" title="Go to Shop">
                    <i class="fas fa-store"></i>
                    <span>Shop</span>
                </button>
                <button class="back-button" onclick="goHome()" title="Go Home">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </button>
                <a href="../index.html" class="logo">EcoLoop Kenya</a>
            </div>
            <div class="header-actions">
                <a href="../messages.html" class="header-action">
                    <i class="fas fa-envelope"></i>
                    <span>Messages</span>
                    <span class="cart-count" id="messageCount" style="background: var(--info-color);">0</span>
                </a>
                <a href="#" class="header-action" onclick="showWishlistModal(); return false;">
                    <i class="fas fa-heart"></i>
                    <span>Wishlist</span>
                    <span class="cart-count" id="wishlistCount" style="background: var(--warning-color);">0</span>
                </a>
                <a href="#" class="header-action" onclick="showCartModal(); return false;">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Cart</span>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Product Detail Container -->
    <div class="product-detail-container">
        <div id="productDetailContent">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading product details...</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Global variables
        let currentProduct = null;
        let currentUser = null;
        let selectedImageIndex = 0;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Product Detail Page Loaded');
            
            // Initialize the page
            initializeProductDetail();

            // Update counts
            updateCartCount();
            updateWishlistCount();
            updateMessageCount();
        });

        // Get product ID from URL parameters or localStorage
        function getProductIdFromUrl() {
            // Try URL parameters first
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            // Fallback to localStorage
            if (!productId) {
                const storedId = localStorage.getItem('currentProductId');
                if (storedId) {
                    localStorage.removeItem('currentProductId'); // Clean up
                    return storedId;
                }
            }
            
            return productId;
        }

        // Initialize product detail page
        function initializeProductDetail() {
            const productId = getProductIdFromUrl();
            
            if (!productId) {
                showError('No product ID provided');
                return;
            }
            
            console.log('üîç Loading product detail for ID:', productId);
            loadProductDetail(productId);
        }

        // Show error message
        function showError(message) {
            const container = document.getElementById('productDetailContent');
            if (container) {
                container.innerHTML = `
                    <div class="error-message" style="text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"></i>
                        <h2>Error</h2>
                        <p>${message}</p>
                        <button onclick="window.history.back()" class="btn btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-arrow-left"></i> Go Back
                        </button>
                    </div>
                `;
            }
        }

        // Load product details
        async function loadProductDetail(productId) {
            console.log('üîç Loading product details for:', productId);
            
            // Try to get product from various sources with MongoDB support
            const product = await getProductById(productId);
            
            if (product) {
                currentProduct = product;
                renderProductDetail(product);
            } else {
                showError('Product not found');
            }
        }

        // Get product from various sources with MongoDB support
        async function getProductById(productId) {
            try {
                // First try MongoDB
                if (typeof getProductsFromMongo === 'function') {
                    try {
                        const mongoProducts = await getProductsFromMongo('approved');
                        let product = mongoProducts.find(p => p.id == productId);
                        if (product) {
                            console.log('‚úÖ Product found in MongoDB:', product.title);
                            return product;
                        }
                    } catch (mongoError) {
                        console.log('MongoDB fetch failed, trying localStorage:', mongoError.message);
                    }
                }
                
                // Fallback to localStorage
                const registeredSellers = JSON.parse(localStorage.getItem('registeredSellers') || '[]');
                const registeredSellerEmails = new Set(registeredSellers.map(s => s.email));
                
                const adminProducts = JSON.parse(localStorage.getItem('products') || '[]');
                const sellerProducts = JSON.parse(localStorage.getItem('sellerProducts') || '[]');
                
                // Combine and filter only approved products from registered sellers
                const approvedProducts = [
                    ...adminProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail)),
                    ...sellerProducts.filter(p => p.status === 'approved' && p.sellerEmail && registeredSellerEmails.has(p.sellerEmail))
                ];
                
                // Remove duplicates
                const uniqueProducts = [];
                const seenIds = new Set();
                
                approvedProducts.forEach(product => {
                    if (!seenIds.has(product.id)) {
                        seenIds.add(product.id);
                        uniqueProducts.push({
                            ...product,
                            sellerEmail: product.sellerEmail || 'pmuiruri9657@gmail.com',
                            sellerName: product.sellerName || 'EcoLoop Kenya',
                            sellerPhone: product.sellerPhone || '+254 712 345 678',
                            sellerLocation: product.sellerLocation || 'Nairobi, Kenya',
                            title: product.title || product.name || 'Untitled Product',
                            price: product.price || 0,
                            category: product.category || 'Uncategorized',
                            rating: product.rating || 4.0,
                            reviews: product.reviews || 0,
                            image: product.image || (product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/250x200/cccccc/ffffff?text=No+Image')
                        });
                    }
                });
                
                let product = uniqueProducts.find(p => p.id == productId);
                
                // If not found in approved products, check all products (for admin view)
                if (!product) {
                    const allProducts = [...adminProducts, ...sellerProducts];
                    product = allProducts.find(p => p.id == productId);
                }
                
                if (product) {
                    console.log('‚úÖ Product found in localStorage:', product.title);
                    // Store product for detail page use
                    localStorage.setItem('currentProductDetail', JSON.stringify(product));
                }
                
                return product;
            } catch (error) {
                console.error('‚ùå Error getting product:', error);
                return null;
            }
        }

        // Render product detail
        function renderProductDetail(product) {
            const images = product.images || [product.image || 'https://via.placeholder.com/600x600/cccccc/ffffff?text=No+Image'];
            const discount = product.originalPrice && product.originalPrice > product.price ? 
                Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100) : 0;
            
            const productHTML = `
                <div class="product-detail-card">
                    <div class="product-images">
                        <div class="main-image-container">
                            <img src="${images[selectedImageIndex]}" alt="${product.title || product.name || 'Product Image'}" class="main-image" id="mainImage">
                            ${product.condition ? `<span class="condition-badge">${product.condition}</span>` : ''}
                        </div>
                        ${images.length > 1 ? `
                            <div class="image-thumbnails">
                                ${images.map((img, index) => `
                                    <div class="thumbnail ${index === selectedImageIndex ? 'active' : ''}" onclick="changeImage(${index})">
                                        <img src="${img}" alt="${product.title || product.name || 'Product Image'} - Image ${index + 1}">
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="product-info">
                        <!-- Product Title and Basic Info -->
                        <div class="product-header">
                            <h1 class="product-title">${product.title || product.name || 'Untitled Product'}</h1>
                            <div class="product-meta">
                                ${product.sku ? `<span class="product-sku">SKU: ${product.sku}</span>` : ''}
                                ${product.condition ? `<span class="condition-tag ${product.condition.toLowerCase().replace(' ', '-')}">${product.condition}</span>` : ''}
                            </div>
                        </div>
                        
                        <!-- Rating and Reviews -->
                        <div class="product-rating">
                            <div class="rating-stars">
                                <span class="stars">${'‚òÖ'.repeat(Math.floor(product.rating || 4))}‚òÜ'.repeat(5 - Math.floor(product.rating || 4))}</span>
                                <span class="rating-number">${product.rating || 4.0}</span>
                            </div>
                            <div class="rating-info">
                                <span class="rating-count">(${product.reviews || 0} reviews)</span>
                                <span class="rating-separator">‚Ä¢</span>
                                <span class="sold-count">${product.soldCount || Math.floor(Math.random() * 100) + 10} sold</span>
                            </div>
                        </div>
                        
                        <!-- Price Section -->
                        <div class="product-price-section">
                            <div class="price-main">
                                <span class="current-price">KES ${product.price.toLocaleString()}</span>
                                ${product.originalPrice && product.originalPrice > product.price ? `
                                    <span class="original-price">KES ${product.originalPrice.toLocaleString()}</span>
                                    <span class="discount-percent">${discount}% OFF</span>
                                ` : ''}
                            </div>
                            <div class="price-info">
                                ${product.shippingCost !== undefined ? `
                                    <span class="shipping-info">
                                        <i class="fas fa-truck"></i>
                                        Shipping: ${product.shippingCost === 0 ? 'FREE' : `KES ${product.shippingCost.toLocaleString()}`}
                                    </span>
                                ` : ''}
                                ${product.warranty ? `
                                    <span class="warranty-info">
                                        <i class="fas fa-shield-alt"></i>
                                        ${product.warranty}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Product Description -->
                        <div class="product-description">
                            <h3>Description</h3>
                            <p>${product.description || 'No description available for this product.'}</p>
                        </div>
                        
                        <!-- Key Specifications -->
                        <div class="product-specifications">
                            <h3>Key Specifications</h3>
                            <div class="specs-grid">
                                ${product.brand ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Brand</span>
                                        <span class="spec-value">${product.brand || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.model ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Model</span>
                                        <span class="spec-value">${product.model || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.color ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Color</span>
                                        <span class="spec-value">${product.color || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.material ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Material</span>
                                        <span class="spec-value">${product.material || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.dimensions ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Dimensions</span>
                                        <span class="spec-value">${product.dimensions || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.weight ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Weight</span>
                                        <span class="spec-value">${product.weight || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.power ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Power</span>
                                        <span class="spec-value">${product.power || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.capacity ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Capacity</span>
                                        <span class="spec-value">${product.capacity || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.connectivity ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Connectivity</span>
                                        <span class="spec-value">${product.connectivity || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.compatibility ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Compatibility</span>
                                        <span class="spec-value">${product.compatibility || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${product.batteryLife ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Battery Life</span>
                                        <span class="spec-value">${product.batteryLife || 'Not specified'}</span>
                                    </div>
                                ` : ''}
                                ${!product.brand && !product.model && !product.color && !product.material && !product.dimensions && !product.weight && !product.power && !product.capacity && !product.connectivity && !product.compatibility && !product.batteryLife ? `
                                    <div class="spec-item">
                                        <span class="spec-label">Product Name</span>
                                        <span class="spec-value">${product.title || product.name || 'Unknown Product'}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Category</span>
                                        <span class="spec-value">${product.category || 'General'}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Condition</span>
                                        <span class="spec-value">${product.condition || 'Not specified'}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Price</span>
                                        <span class="spec-value">KES ${product.price ? product.price.toLocaleString() : 'Not specified'}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Product Variants and Options -->
                        ${product.variants && product.variants.length > 0 ? `
                            <div class="product-variants">
                                <h3>Available Options</h3>
                                ${product.variants.map((variant, index) => `
                                    <div class="variant-group">
                                        <label>${variant.name || `Option ${index + 1}`}:</label>
                                        <div class="variant-options">
                                            ${variant.options.map((option, optIndex) => `
                                                <button class="variant-option ${optIndex === 0 ? 'active' : ''}" 
                                                        onclick="selectVariant(${index}, ${optIndex}, '${option.value}', ${option.priceAdjustment || 0})">
                                                    ${option.label || option.value}
                                                    ${option.priceAdjustment ? `(+KES ${option.priceAdjustment.toLocaleString()})` : ''}
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Product Colors -->
                        ${product.colors && product.colors.length > 0 ? `
                            <div class="product-colors">
                                <h3>Available Colors</h3>
                                <div class="color-options">
                                    ${product.colors.map((color, index) => `
                                        <button class="color-option ${index === 0 ? 'active' : ''}" 
                                                onclick="selectColor(${index}, '${color.name}', '${color.hex}')"
                                                title="${color.name}"
                                                style="background-color: ${color.hex};">
                                            ${color.name}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Product Sizes -->
                        ${product.sizes && product.sizes.length > 0 ? `
                            <div class="product-sizes">
                                <h3>Available Sizes</h3>
                                <div class="size-options">
                                    ${product.sizes.map((size, index) => `
                                        <button class="size-option ${index === 0 ? 'active' : ''}" 
                                                onclick="selectSize(${index}, '${size.value}', ${size.priceAdjustment || 0})"
                                                ${size.inStock === false ? 'disabled' : ''}>
                                            ${size.label || size.value}
                                            ${size.priceAdjustment ? `(+KES ${size.priceAdjustment.toLocaleString()})` : ''}
                                            ${size.inStock === false ? '(Out of Stock)' : ''}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Shipping and Delivery Options -->
                        <div class="shipping-options">
                            <h3>Shipping & Delivery</h3>
                            <div class="shipping-methods">
                                ${product.shippingOptions && product.shippingOptions.length > 0 ? 
                                    product.shippingOptions.map((option, index) => `
                                        <div class="shipping-option ${index === 0 ? 'selected' : ''}" 
                                             onclick="selectShipping(${index}, '${option.method}', ${option.cost || 0}, '${option.time || '2-3 days'}')">
                                            <div class="shipping-header">
                                                <span class="shipping-method">${option.method}</span>
                                                <span class="shipping-cost">${option.cost === 0 ? 'FREE' : `KES ${option.cost.toLocaleString()}`}</span>
                                            </div>
                                            <span class="shipping-time">${option.time || '2-3 business days'}</span>
                                        </div>
                                    `).join('') : `
                                        <div class="shipping-option selected">
                                            <div class="shipping-header">
                                                <span class="shipping-method">Standard Delivery</span>
                                                <span class="shipping-cost">${product.shippingCost === 0 ? 'FREE' : `KES ${(product.shippingCost || 300).toLocaleString()}`}</span>
                                            </div>
                                            <span class="shipping-time">${product.shippingTime || '2-3 business days'}</span>
                                        </div>
                                    `
                                }
                            </div>
                        </div>
                        
                        <!-- Payment Options -->
                        ${product.paymentOptions && product.paymentOptions.length > 0 ? `
                            <div class="payment-options">
                                <h3>Payment Methods</h3>
                                <div class="payment-methods">
                                    ${product.paymentOptions.map(method => `
                                        <div class="payment-method">
                                            <i class="fas ${method.icon || 'fa-credit-card'}"></i>
                                            <span>${method.name}</span>
                                            ${method.available ? '<span class="available">‚úì Available</span>' : '<span class="unavailable">‚úó Unavailable</span>'}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Price Negotiability -->
                        ${product.priceNegotiable ? `
                            <div class="price-negotiable">
                                <div class="negotiable-info">
                                    <i class="fas fa-handshake"></i>
                                    <span>This price is negotiable. Contact the seller to discuss.</span>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Features -->
                        ${product.features && product.features.length > 0 ? `
                            <div class="product-features">
                                <h3>Key Features</h3>
                                <ul class="features-list">
                                    ${product.features.map(feature => `<li><i class="fas fa-check"></i> ${feature}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <!-- What's in the Box -->
                        ${product.includedItems && product.includedItems.length > 0 ? `
                            <div class="whats-in-box">
                                <h3>What's in the Box</h3>
                                <ul class="included-items">
                                    ${product.includedItems.map(item => `<li><i class="fas fa-box"></i> ${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <!-- Technical Specifications -->
                        ${product.specifications && Object.keys(product.specifications).length > 0 ? `
                            <div class="technical-specs">
                                <h3>Technical Specifications</h3>
                                <div class="specs-table">
                                    ${Object.entries(product.specifications).map(([key, value]) => `
                                        <div class="spec-row">
                                            <span class="spec-key">${key || 'Specification'}</span>
                                            <span class="spec-val">${value || 'Not specified'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : `
                            <div class="technical-specs">
                                <h3>Technical Specifications</h3>
                                <div class="specs-table">
                                    <div class="spec-row">
                                        <span class="spec-key">Product Name</span>
                                        <span class="spec-val">${product.title || product.name || 'Unknown Product'}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-key">Category</span>
                                        <span class="spec-val">${product.category || 'General'}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-key">Condition</span>
                                        <span class="spec-val">${product.condition || 'Not specified'}</span>
                                    </div>
                                    ${product.brand ? `
                                        <div class="spec-row">
                                            <span class="spec-key">Brand</span>
                                            <span class="spec-val">${product.brand}</span>
                                        </div>
                                    ` : ''}
                                    ${product.model ? `
                                        <div class="spec-row">
                                            <span class="spec-key">Model</span>
                                            <span class="spec-val">${product.model}</span>
                                        </div>
                                    ` : ''}
                                    <div class="spec-row">
                                        <span class="spec-key">Price</span>
                                        <span class="spec-val">KES ${product.price ? product.price.toLocaleString() : 'Not specified'}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-key">Availability</span>
                                        <span class="spec-val">${product.inStock !== false ? 'In Stock' : 'Out of Stock'}</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-key">Seller</span>
                                        <span class="spec-val">${product.sellerName || 'Unknown Seller'}</span>
                                    </div>
                                </div>
                            </div>
                        `}
                        
                        <!-- Availability and Shipping -->
                        <div class="availability-info">
                            <div class="stock-status">
                                <span class="stock-label">Availability:</span>
                                <span class="stock-value ${product.inStock !== false ? 'in-stock' : 'out-of-stock'}">
                                    ${product.inStock !== false ? '‚úì In Stock' : '‚úó Out of Stock'}
                                </span>
                                ${product.quantity ? `<span class="stock-quantity">(${product.quantity} units available)</span>` : ''}
                            </div>
                            <div class="shipping-info">
                                <span class="shipping-label">Shipping:</span>
                                <span class="shipping-value">
                                    ${product.shippingTime || '2-3 business days'} ${product.shippingCost === 0 ? '(FREE)' : ''}
                                </span>
                            </div>
                            <div class="return-policy">
                                <span class="return-label">Returns:</span>
                                <span class="return-value">${product.returnPolicy || '30 days return policy'}</span>
                            </div>
                        </div>
                        
                        <!-- Seller Information -->
                        <div class="seller-section">
                            <h3>Seller Information</h3>
                            <div class="seller-card">
                                <div class="seller-header">
                                    <div class="seller-avatar">
                                        <i class="fas fa-store"></i>
                                    </div>
                                    <div class="seller-info">
                                        <div class="seller-name">${product.sellerName || 'Unknown Seller'}</div>
                                        <div class="seller-rating">
                                            <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                            <span class="seller-review-count">(${product.sellerReviews || Math.floor(Math.random() * 500) + 50} reviews)</span>
                                        </div>
                                        <div class="seller-badge">
                                            <i class="fas fa-check-circle"></i> Verified Seller
                                        </div>
                                    </div>
                                </div>
                                <div class="seller-details">
                                    <div class="seller-contact">
                                        <div class="contact-item">
                                            <i class="fas fa-envelope"></i>
                                            <span>${product.sellerEmail || 'contact@ecoloopkenya.com'}</span>
                                        </div>
                                        <div class="contact-item">
                                            <i class="fas fa-phone"></i>
                                            <span>${product.sellerPhone || '+254 700 000 000'}</span>
                                        </div>
                                        <div class="contact-item">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span>${product.sellerLocation || 'Nairobi, Kenya'}</span>
                                        </div>
                                    </div>
                                    <div class="seller-stats">
                                        <div class="stat-item">
                                            <span class="stat-number">${product.sellerProducts || Math.floor(Math.random() * 100) + 20}</span>
                                            <span class="stat-label">Products</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-number">${product.sellerResponseTime || '< 1hr'}</span>
                                            <span class="stat-label">Response Time</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-number">${product.sellerJoinDate || '2023'}</span>
                                            <span class="stat-label">Member Since</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product Tags -->
                        ${product.tags && product.tags.length > 0 ? `
                            <div class="product-tags">
                                <h3>Tags</h3>
                                <div class="tags-container">
                                    ${product.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Quantity Selector and Actions -->
                        <div class="purchase-section">
                            <div class="quantity-selector">
                                <label>Quantity:</label>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="decreaseQuantity()">-</button>
                                    <input type="number" class="quantity-input" id="quantityInput" value="1" min="1" max="${product.quantity || 10}">
                                    <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                                </div>
                            </div>
                            
                            <div class="product-actions">
                                <button class="btn btn-primary" onclick="addToCart(${product.id})" ${product.inStock === false ? 'disabled' : ''}>
                                    <i class="fas fa-shopping-cart"></i>
                                    ${product.inStock === false ? 'Out of Stock' : 'Add to Cart'}
                                </button>
                                <button class="btn btn-secondary" onclick="toggleWishlist(${product.id})" id="wishlistBtn">
                                    <i class="fas fa-heart"></i>
                                    <span id="wishlistBtnText">Add to Wishlist</span>
                                </button>
                                <button class="btn btn-secondary" onclick="messageSeller(${product.id}, '${product.sellerEmail || 'support@ecoloopkenya.com'}', '${product.sellerName || 'Seller'}')">
                                    <i class="fas fa-envelope"></i>
                                    Message Seller
                                </button>
                                <button class="btn btn-secondary" onclick="continueShopping()" style="background: var(--info-color); color: white; border: none;">
                                    <i class="fas fa-store"></i>
                                    Continue Shopping
                                </button>
                            </div>
                        </div>
                        
                        <!-- Product History -->
                        <div class="product-history">
                            <div class="history-item">
                                <span class="history-label">Listed:</span>
                                <span class="history-value">${product.uploadedAt ? new Date(product.uploadedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Recently'}</span>
                            </div>
                            <div class="history-item">
                                <span class="history-label">Last Updated:</span>
                                <span class="history-value">${product.lastUpdated ? new Date(product.lastUpdated).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Recently'}</span>
                            </div>
                            <div class="history-item">
                                <span class="history-label">Views:</span>
                                <span class="history-value">${product.views || Math.floor(Math.random() * 1000) + 100} views</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('productDetailContent').innerHTML = productHTML;
            
            // Update wishlist button state
            updateWishlistButton();
            
            // Track product view
            trackProductView(product.id);
        }

        // Change main image
        function changeImage(index) {
            selectedImageIndex = index;
            const mainImage = document.getElementById('mainImage');
            const images = currentProduct.images || [currentProduct.image];
            
            if (mainImage && images[index]) {
                mainImage.src = images[index];
                
                // Update thumbnail active state
                document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === index);
                });
            }
        }

        // Product Options Management
        let selectedOptions = {
            variants: {},
            color: null,
            size: null,
            shipping: null,
            basePrice: 0,
            currentPrice: 0
        };

        // Select variant option
        function selectVariant(variantIndex, optionIndex, value, priceAdjustment) {
            console.log('üéØ Selecting variant:', variantIndex, optionIndex, value, priceAdjustment);
            
            // Update UI
            const variantOptions = document.querySelectorAll('.variant-option');
            variantOptions.forEach((option, index) => {
                option.classList.remove('active');
            });
            
            // Find and activate the clicked option
            const clickedOption = variantOptions[variantIndex * 10 + optionIndex]; // Approximate index
            if (clickedOption) {
                clickedOption.classList.add('active');
            }
            
            // Store selection
            selectedOptions.variants[variantIndex] = {
                value: value,
                priceAdjustment: priceAdjustment || 0
            };
            
            updateProductPrice();
            console.log('‚úÖ Variant selected:', value);
        }

        // Select color
        function selectColor(colorIndex, colorName, colorHex) {
            console.log('üé® Selecting color:', colorName, colorHex);
            
            // Update UI
            const colorOptions = document.querySelectorAll('.color-option');
            colorOptions.forEach((option, index) => {
                option.classList.remove('active');
            });
            
            colorOptions[colorIndex].classList.add('active');
            
            // Store selection
            selectedOptions.color = {
                name: colorName,
                hex: colorHex
            };
            
            console.log('‚úÖ Color selected:', colorName);
        }

        // Select size
        function selectSize(sizeIndex, sizeValue, priceAdjustment) {
            console.log('üìè Selecting size:', sizeValue, priceAdjustment);
            
            // Update UI
            const sizeOptions = document.querySelectorAll('.size-option');
            sizeOptions.forEach((option, index) => {
                option.classList.remove('active');
            });
            
            sizeOptions[sizeIndex].classList.add('active');
            
            // Store selection
            selectedOptions.size = {
                value: sizeValue,
                priceAdjustment: priceAdjustment || 0
            };
            
            updateProductPrice();
            console.log('‚úÖ Size selected:', sizeValue);
        }

        // Select shipping method
        function selectShipping(shippingIndex, method, cost, time) {
            console.log('üöö Selecting shipping:', method, cost, time);
            
            // Update UI
            const shippingOptions = document.querySelectorAll('.shipping-option');
            shippingOptions.forEach((option, index) => {
                option.classList.remove('selected');
            });
            
            shippingOptions[shippingIndex].classList.add('selected');
            
            // Store selection
            selectedOptions.shipping = {
                method: method,
                cost: cost || 0,
                time: time
            };
            
            console.log('‚úÖ Shipping selected:', method);
        }

        // Update product price based on selected options
        function updateProductPrice() {
            if (!currentProduct) return;
            
            let totalPrice = currentProduct.price || 0;
            
            // Add variant price adjustments
            Object.values(selectedOptions.variants).forEach(variant => {
                totalPrice += variant.priceAdjustment || 0;
            });
            
            // Add size price adjustment
            if (selectedOptions.size) {
                totalPrice += selectedOptions.size.priceAdjustment || 0;
            }
            
            selectedOptions.basePrice = currentProduct.price || 0;
            selectedOptions.currentPrice = totalPrice;
            
            // Update price display
            const priceElements = document.querySelectorAll('.current-price');
            priceElements.forEach(element => {
                element.textContent = `KES ${totalPrice.toLocaleString()}`;
            });
            
            console.log('üí∞ Price updated:', currentProduct.price, '->', totalPrice);
        }

        // Get selected product summary
        function getSelectedProductSummary() {
            if (!currentProduct) return null;
            
            return {
                ...currentProduct,
                selectedOptions: selectedOptions,
                finalPrice: selectedOptions.currentPrice || currentProduct.price,
                totalPrice: (selectedOptions.currentPrice || currentProduct.price) + (selectedOptions.shipping?.cost || 0)
            };
        }

        // Validate product selection before adding to cart
        function validateProductSelection() {
            const requiredOptions = [];
            
            // Check if product has required options that aren't selected
            if (currentProduct.variants && currentProduct.variants.length > 0) {
                currentProduct.variants.forEach((variant, index) => {
                    if (!selectedOptions.variants[index]) {
                        requiredOptions.push(variant.name || `Option ${index + 1}`);
                    }
                });
            }
            
            if (currentProduct.colors && currentProduct.colors.length > 0 && !selectedOptions.color) {
                requiredOptions.push('Color');
            }
            
            if (currentProduct.sizes && currentProduct.sizes.length > 0 && !selectedOptions.size) {
                requiredOptions.push('Size');
            }
            
            if (requiredOptions.length > 0) {
                showToast(`Please select: ${requiredOptions.join(', ')}`, 'warning');
                return false;
            }
            
            return true;
        }

        // Quantity controls
        function increaseQuantity() {
            const input = document.getElementById('quantityInput');
            const max = currentProduct.quantity || 10;
            if (parseInt(input.value) < max) {
                input.value = parseInt(input.value) + 1;
            }
        }

        function decreaseQuantity() {
            const input = document.getElementById('quantityInput');
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
            }
        }

        // Add to cart
        function addToCart(productId) {
            console.log('üõí Adding to cart:', productId);
            
            if (!currentProduct || currentProduct.inStock === false) {
                showToast('Product is out of stock', 'error');
                return;
            }
            
            // Validate product selection
            if (!validateProductSelection()) {
                return;
            }
            
            const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
            const selectedProductSummary = getSelectedProductSummary();
            
            if (!selectedProductSummary) {
                showToast('Error preparing product for cart', 'error');
                return;
            }
            
            // Get user-specific cart
            const userCart = getUserCart();
            const existingItem = userCart.find(item => 
                item.id === productId && 
                JSON.stringify(item.selectedOptions) === JSON.stringify(selectedOptions)
            );

            if (existingItem) {
                existingItem.quantity = (existingItem.quantity || 1) + quantity;
                existingItem.addedAt = new Date().toISOString();
                showToast(`${currentProduct.title || currentProduct.name || 'Product'} quantity updated in cart!`, 'success');
            } else {
                const cartItem = {
                    ...selectedProductSummary,
                    quantity: quantity,
                    addedAt: new Date().toISOString(),
                    userId: currentUser?.id || 'guest'
                };
                userCart.push(cartItem);
                saveUserCart(userCart);
                showToast(`${currentProduct.title || currentProduct.name || 'Product'} added to cart!`, 'success');
                
                // Track cart activity
                trackCartActivity(productId, 'add');
                
                // Update cart count
                updateCartCount();
                
                // Animate cart icon
                animateCartIcon();
            }
            
            console.log('‚úÖ Product added to cart successfully');
        }

        // Wishlist functions
        function toggleWishlist(productId) {
            if (isInWishlist(productId)) {
                removeFromWishlist(productId);
                updateWishlistButton();
            } else {
                addToWishlist(productId);
                updateWishlistButton();
            }
        }

        function isInWishlist(productId) {
            const userWishlist = getUserWishlist();
            return userWishlist.some(item => item.id === productId);
        }

        function addToWishlist(productId) {
            const wishlistItem = {
                ...currentProduct,
                addedAt: new Date().toISOString(),
                userId: currentUser?.id || 'guest'
            };
            
            const userWishlist = getUserWishlist();
            userWishlist.push(wishlistItem);
            saveUserWishlist(userWishlist);
            
            showToast(`${currentProduct.title || currentProduct.name || 'Product'} added to wishlist!`, 'wishlist');
            trackWishlistActivity(productId, 'add');
            updateWishlistCount();
            animateWishlistIcon();
        }

        function removeFromWishlist(productId) {
            const userWishlist = getUserWishlist();
            const productIndex = userWishlist.findIndex(item => item.id === productId);
            
            if (productIndex > -1) {
                userWishlist.splice(productIndex, 1);
                saveUserWishlist(userWishlist);
                showToast(`${currentProduct.title || currentProduct.name || 'Product'} removed from wishlist!`, 'wishlist');
                trackWishlistActivity(productId, 'remove');
                updateWishlistCount();
            }
        }

        function updateWishlistButton() {
            if (!currentProduct) return;
            
            const btn = document.getElementById('wishlistBtn');
            const btnText = document.getElementById('wishlistBtnText');
            
            if (isInWishlist(currentProduct.id)) {
                btn.classList.add('in-wishlist');
                btnText.textContent = 'In Wishlist';
            } else {
                btn.classList.remove('in-wishlist');
                btnText.textContent = 'Add to Wishlist';
            }
        }

        // Message seller
        function messageSeller(productId, sellerEmail, sellerName) {
            // Store seller info for messages page
            const currentSeller = {
                productId: productId,
                email: sellerEmail,
                name: sellerName
            };
            localStorage.setItem('currentSeller', JSON.stringify(currentSeller));
            
            // Redirect to messages page
            window.location.href = '../messages.html';
        }

        // Helper functions (reuse from main site)
        function getUserCart() {
            if (currentUser) {
                const userCarts = JSON.parse(localStorage.getItem('userCarts') || '{}');
                return userCarts[currentUser.id] || [];
            } else {
                return JSON.parse(localStorage.getItem('guestCart') || '[]');
            }
        }

        function saveUserCart(userCart) {
            if (currentUser) {
                const userCarts = JSON.parse(localStorage.getItem('userCarts') || '{}');
                userCarts[currentUser.id] = userCart;
                localStorage.setItem('userCarts', JSON.stringify(userCarts));
            } else {
                localStorage.setItem('guestCart', JSON.stringify(userCart));
            }
        }

        function getUserWishlist() {
            if (currentUser) {
                const userWishlists = JSON.parse(localStorage.getItem('userWishlists') || '{}');
                return userWishlists[currentUser.id] || [];
            } else {
                return JSON.parse(localStorage.getItem('guestWishlist') || '[]');
            }
        }

        function saveUserWishlist(userWishlist) {
            if (currentUser) {
                const userWishlists = JSON.parse(localStorage.getItem('userWishlists') || '{}');
                userWishlists[currentUser.id] = userWishlist;
                localStorage.setItem('userWishlists', JSON.stringify(userWishlists));
            } else {
                localStorage.setItem('guestWishlist', JSON.stringify(userWishlist));
            }
        }

        function updateCartCount() {
            const userCart = getUserCart();
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                cartCount.textContent = userCart.length;
                cartCount.style.display = userCart.length > 0 ? 'flex' : 'none';
            }
        }

        function updateWishlistCount() {
            const userWishlist = getUserWishlist();
            const wishlistCount = document.getElementById('wishlistCount');
            if (wishlistCount) {
                wishlistCount.textContent = userWishlist.length;
                wishlistCount.style.display = userWishlist.length > 0 ? 'flex' : 'none';
            }
        }

        function updateMessageCount() {
            if (!currentUser) return;
            
            const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
            const userConversations = conversations.filter(conv => {
                return conv.participants && conv.participants.some(p => p.email === currentUser.email);
            });
            
            const unreadCount = userConversations.reduce((sum, conv) => sum + (conv.unreadCount || 0), 0);
            
            const messageCountElement = document.getElementById('messageCount');
            if (messageCountElement) {
                messageCountElement.textContent = unreadCount;
                messageCountElement.style.display = unreadCount > 0 ? 'flex' : 'none';
            }
        }

        function trackProductView(productId) {
            const activity = {
                userId: currentUser?.id || 'guest',
                productId: productId,
                action: 'view',
                timestamp: new Date().toISOString()
            };
            
            const views = JSON.parse(localStorage.getItem('productViews') || '[]');
            views.push(activity);
            
            // Keep only last 100 views per user
            const userViews = views.filter(v => v.userId === activity.userId).slice(-100);
            const otherViews = views.filter(v => v.userId !== activity.userId);
            localStorage.setItem('productViews', JSON.stringify([...userViews, ...otherViews]));
        }

        function trackCartActivity(productId, action) {
            const activity = {
                userId: currentUser?.id || 'guest',
                productId: productId,
                action: action,
                timestamp: new Date().toISOString()
            };
            
            const cartActivity = JSON.parse(localStorage.getItem('cartActivity') || '[]');
            cartActivity.push(activity);
            
            const userActivity = cartActivity.filter(a => a.userId === activity.userId).slice(-100);
            const otherActivity = cartActivity.filter(a => a.userId !== activity.userId);
            localStorage.setItem('cartActivity', JSON.stringify([...userActivity, ...otherActivity]));
        }

        function trackWishlistActivity(productId, action) {
            const activity = {
                userId: currentUser?.id || 'guest',
                productId: productId,
                action: action,
                timestamp: new Date().toISOString()
            };
            
            const wishlistActivity = JSON.parse(localStorage.getItem('wishlistActivity') || '[]');
            wishlistActivity.push(activity);
            
            const userActivity = wishlistActivity.filter(a => a.userId === activity.userId).slice(-100);
            const otherActivity = wishlistActivity.filter(a => a.userId !== activity.userId);
            localStorage.setItem('wishlistActivity', JSON.stringify([...userActivity, ...otherActivity]));
        }

        function animateCartIcon() {
            const cartIcon = document.querySelector('.fa-shopping-cart').parentElement;
            if (cartIcon) {
                cartIcon.style.transform = 'scale(1.2)';
                cartIcon.style.transition = 'transform 0.3s';
                setTimeout(() => {
                    cartIcon.style.transform = 'scale(1)';
                }, 300);
            }
        }

        function animateWishlistIcon() {
            const wishlistIcon = document.querySelector('.fa-heart').parentElement;
            if (wishlistIcon) {
                wishlistIcon.style.transform = 'scale(1.2)';
                wishlistIcon.style.transition = 'transform 0.3s';
                setTimeout(() => {
                    wishlistIcon.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Enhanced toast notification system
        function showToast(message, type = 'success', customIcon = null) {
            // Remove existing toast if any
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create new toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Add icon based on type
            let icon = '';
            if (customIcon) {
                icon = `<i class="${customIcon}"></i>`;
            } else {
                switch(type) {
                    case 'success':
                        icon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-exclamation-circle"></i>';
                        break;
                    case 'warning':
                        icon = '<i class="fas fa-exclamation-triangle"></i>';
                        break;
                    case 'info':
                        icon = '<i class="fas fa-info-circle"></i>';
                        break;
                    case 'cart':
                        icon = '<i class="fas fa-shopping-cart"></i>';
                        break;
                    case 'wishlist':
                        icon = '<i class="fas fa-heart"></i>';
                        break;
                    default:
                        icon = '<i class="fas fa-info-circle"></i>';
                }
            }
            
            toast.innerHTML = `${icon} ${message}`;
            
            // Add to body
            document.body.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => {
                toast.classList.add('show');
            }, 50);
            
            // Auto hide after 500ms for cart/wishlist, 2000ms for others
            const hideTime = (type === 'cart' || type === 'wishlist') ? 500 : 2000;
            
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('hide');
                
                // Remove from DOM after animation
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 400);
            }, hideTime);
        }

        function goBack() {
            console.log('üîô Back button clicked');
            try {
                // Check if we came from the main website
                if (document.referrer && (document.referrer.includes('index.html') || document.referrer.includes('Shoping-website-main'))) {
                    console.log('üìö Using browser history back');
                    window.history.back();
                } else {
                    // If no referrer or came from elsewhere, go to main shop
                    console.log('üè™ Redirecting to main shop page');
                    window.location.href = '../index.html';
                }
            } catch (error) {
                console.error('‚ùå Error in goBack:', error);
                // Fallback redirect
                window.location.href = '../index.html';
            }
        }

        function goToShop() {
            console.log('üè™ Shop button clicked');
            try {
                // Direct navigation to main shop page
                console.log('üè™ Redirecting to main shop page');
                window.location.href = '../index.html';
            } catch (error) {
                console.error('‚ùå Error in goToShop:', error);
                // Fallback redirect
                window.location.href = '../index.html';
            }
        }

        function goHome() {
            console.log('üè† Home button clicked');
            try {
                // Direct navigation to main home page
                console.log('üè† Redirecting to main home page');
                window.location.href = '../index.html';
            } catch (error) {
                console.error('‚ùå Error in goHome:', error);
                // Fallback redirect
                window.location.href = '../index.html';
            }
        }

        function continueShopping() {
            console.log('üõçÔ∏è Continue shopping clicked');
            try {
                // Enhanced back to shop with category memory
                const lastCategory = sessionStorage.getItem('lastCategory') || 'all';
                console.log('üìÇ Last category:', lastCategory);
                window.location.href = `../index.html#category-${lastCategory}`;
            } catch (error) {
                console.error('‚ùå Error in continueShopping:', error);
                // Fallback redirect
                window.location.href = '../index.html';
            }
        }

        function showError(message) {
            document.getElementById('productDetailContent').innerHTML = `
                <div class="loading">
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--danger-color); margin-bottom: 20px;"></i>
                    <h3>Error</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="goBack()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i> Go Back
                    </button>
                </div>
            `;
        }

        // Modal placeholders (simplified versions)
        function showCartModal() {
            showToast('Cart feature - redirecting to main site...', 'info');
            window.location.href = '../index.html';
        }

        function showWishlistModal() {
            showToast('Wishlist feature - redirecting to main site...', 'info');
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>
