<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages - EcoLoop Kenya</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --success-color: #22c55e;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Header */
        .header {
            background: var(--bg-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .header-action {
            position: relative;
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .header-action:hover {
            background: var(--primary-color);
            color: white;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* Messages Container */
        .messages-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            height: calc(100vh - 120px);
        }

        /* Conversations List */
        .conversations-list {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .conversations-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-primary);
        }

        .conversations-header h2 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .search-box {
            position: relative;
            margin-top: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .search-box i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .conversations-list-content {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }

        .conversation-item:hover {
            background: var(--bg-secondary);
        }

        .conversation-item.active {
            background: #eff6ff;
            border-left: 3px solid var(--primary-color);
        }

        .conversation-item.unread {
            background: #fef3c7;
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .conversation-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .conversation-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .conversation-preview {
            font-size: 0.9rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .unread-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 8px;
            height: 8px;
        }

        /* Chat Area */
        .chat-area {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header-info h3 {
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .chat-header-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            padding: 0.5rem;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-action-btn:hover {
            background: var(--bg-secondary);
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .message.sent {
            align-items: flex-end;
        }

        .message.received {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 1rem;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
        }

        .message.sent .message-bubble {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.received .message-bubble {
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 4px;
        }

        .message-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .message-status {
            font-size: 0.75rem;
        }

        .message-status.read {
            color: var(--primary-color);
        }

        .message-status.pending {
            color: var(--warning-color);
        }

        .chat-input {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            background: var(--bg-primary);
        }

        .chat-input-form {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .chat-input-field {
            flex: 1;
            position: relative;
        }

        .chat-input-field textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            resize: none;
            font-family: inherit;
            font-size: 0.9rem;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input-field textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .chat-send-btn {
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .chat-send-btn:hover {
            background: var(--primary-dark);
        }

        .chat-send-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Loading State */
        .loading-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--text-primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: var(--success-color);
        }

        .toast.error {
            background: var(--danger-color);
        }

        .toast.warning {
            background: var(--warning-color);
        }

        .toast.info {
            background: var(--info-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .messages-container {
                grid-template-columns: 1fr;
                height: calc(100vh - 80px);
            }

            .conversations-list {
                display: none;
            }

            .conversations-list.mobile-show {
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 200;
                max-width: none;
                margin: 0;
                border-radius: 0;
            }

            .chat-area {
                display: none;
            }

            .chat-area.mobile-show {
                display: flex;
            }

            .message-bubble {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <i class="fas fa-recycle"></i> EcoLoop Kenya
            </a>
            <div class="header-actions">
                <a href="index.html" class="header-action">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="header-action" id="messagesLink">
                    <i class="fas fa-envelope"></i>
                    <span>Messages</span>
                    <span class="badge" id="messageBadge" style="display: none;">0</span>
                </a>
                <a href="#" class="header-action" id="profileLink">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Messages Container -->
    <div class="messages-container">
        <!-- Conversations List -->
        <div class="conversations-list" id="conversationsList">
            <div class="conversations-header">
                <h2>Messages</h2>
                <div class="search-box">
                    <input type="text" id="searchConversations" placeholder="Search conversations...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="conversations-list-content" id="conversationsListContent">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading conversations...</p>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <div class="empty-state" id="emptyState">
                <i class="fas fa-comments"></i>
                <h3>Select a conversation</h3>
                <p>Choose a conversation from the list to start messaging</p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Global variables
        let currentUser = null;
        let conversations = [];
        let currentConversation = null;
        let messageRefreshInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeAuth();
            loadConversations();
            setupEventListeners();
        });

        // Authentication
        function initializeAuth() {
            const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
            if (sessionData) {
                const session = JSON.parse(sessionData);
                currentUser = session.user;
                updateProfileLink();
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            }
        }

        function updateProfileLink() {
            const profileLink = document.getElementById('profileLink');
            if (currentUser) {
                profileLink.innerHTML = `
                    <i class="fas fa-user"></i>
                    <span>${currentUser.name}</span>
                `;
                profileLink.onclick = () => {
                    // Show user menu or profile
                    showToast('Profile menu coming soon!', 'info');
                };
            }
        }

        // Event Listeners
        function setupEventListeners() {
            // Search conversations
            document.getElementById('searchConversations').addEventListener('input', function(e) {
                filterConversations(e.target.value);
            });

            // Chat input
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }

            // Mobile back button
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('back-to-conversations')) {
                    showConversationsList();
                }
            });
        }

        // Load Conversations
        async function loadConversations() {
            if (!currentUser) return;

            try {
                const response = await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/conversations/${currentUser.email}`);
                const result = await response.json();

                if (result.success) {
                    conversations = result.conversations;
                    displayConversations();
                    updateMessageBadge();
                } else {
                    showToast('Failed to load conversations', 'error');
                }
            } catch (error) {
                console.error('Error loading conversations:', error);
                showToast('Failed to load conversations', 'error');
            }
        }

        // Display Conversations
        function displayConversations(filteredConversations = null) {
            const container = document.getElementById('conversationsListContent');
            const conversationsToDisplay = filteredConversations || conversations;

            if (conversationsToDisplay.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No conversations yet</h3>
                        <p>Start messaging sellers to see your conversations here</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = conversationsToDisplay.map(conv => {
                const otherParticipant = conv.participants.find(p => p.email !== currentUser.email);
                const isUnread = conv.messages.some(msg => msg.receiver === currentUser.email && !msg.read);
                
                return `
                    <div class="conversation-item ${isUnread ? 'unread' : ''}" data-conversation-id="${conv.id}">
                        ${isUnread ? '<div class="unread-badge"></div>' : ''}
                        <div class="conversation-header">
                            <div class="conversation-name">${otherParticipant.name || otherParticipant.email}</div>
                            <div class="conversation-time">${formatTime(conv.lastTimestamp)}</div>
                        </div>
                        <div class="conversation-preview">${conv.lastMessage}</div>
                    </div>
                `;
            }).join('');

            // Add click listeners
            container.querySelectorAll('.conversation-item').forEach(item => {
                item.addEventListener('click', function() {
                    const conversationId = this.dataset.conversationId;
                    openConversation(conversationId);
                });
            });
        }

        // Filter Conversations
        function filterConversations(searchTerm) {
            if (!searchTerm) {
                displayConversations();
                return;
            }

            const filtered = conversations.filter(conv => {
                const otherParticipant = conv.participants.find(p => p.email !== currentUser.email);
                return (
                    (otherParticipant.name && otherParticipant.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    otherParticipant.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    conv.lastMessage.toLowerCase().includes(searchTerm.toLowerCase())
                );
            });

            displayConversations(filtered);
        }

        // Open Conversation
        async function openConversation(conversationId) {
            currentConversation = conversations.find(c => c.id === conversationId);
            
            if (!currentConversation) return;

            // Update active state
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-conversation-id="${conversationId}"]`).classList.add('active');

            // Mark as read
            await markConversationAsRead(conversationId);

            // Show chat area
            showChatArea();

            // Load messages
            loadMessages();
        }

        // Show Chat Area
        function showChatArea() {
            const chatArea = document.getElementById('chatArea');
            const otherParticipant = currentConversation.participants.find(p => p.email !== currentUser.email);

            chatArea.innerHTML = `
                <div class="chat-header">
                    <div class="chat-header-info">
                        <h3>${otherParticipant.name || otherParticipant.email}</h3>
                        <p>${otherParticipant.email}</p>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn back-to-conversations" title="Back to conversations">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <button class="chat-action-btn" title="View product">
                            <i class="fas fa-box"></i>
                        </button>
                        <button class="chat-action-btn" title="More options">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Loading messages...</p>
                    </div>
                </div>
                <div class="chat-input">
                    <form class="chat-input-form" onsubmit="sendMessage(event)">
                        <div class="chat-input-field">
                            <textarea id="chatInput" placeholder="Type your message..." rows="1"></textarea>
                        </div>
                        <button type="submit" class="chat-send-btn" id="sendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            `;

            // Setup auto-resize for textarea
            const textarea = document.getElementById('chatInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Start message refresh
            startMessageRefresh();
        }

        // Load Messages
        function loadMessages() {
            const messagesContainer = document.getElementById('chatMessages');
            
            if (!currentConversation || !currentConversation.messages || currentConversation.messages.length === 0) {
                messagesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comment"></i>
                        <h3>No messages yet</h3>
                        <p>Start the conversation with a message</p>
                    </div>
                `;
                return;
            }

            messagesContainer.innerHTML = currentConversation.messages.map(msg => {
                const isSent = msg.sender === currentUser.email;
                return `
                    <div class="message ${isSent ? 'sent' : 'received'}">
                        <div class="message-bubble">
                            ${msg.content}
                        </div>
                        <div class="message-info">
                            <span class="message-time">${formatTime(msg.timestamp)}</span>
                            ${isSent ? `<span class="message-status ${msg.read ? 'read' : 'pending'}">${msg.read ? 'Read' : 'Sent'}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Send Message
        async function sendMessage(event) {
            if (event) event.preventDefault();

            const textarea = document.getElementById('chatInput');
            const content = textarea.value.trim();

            if (!content || !currentConversation) return;

            const sendBtn = document.getElementById('sendBtn');
            const originalContent = sendBtn.innerHTML;
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const otherParticipant = currentConversation.participants.find(p => p.email !== currentUser.email);

                const response = await fetch('https://my-backend-1-jk7w.onrender.com/api/messages/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        senderEmail: currentUser.email,
                        receiverEmail: otherParticipant.email,
                        content: content,
                        subject: currentConversation.messages[0]?.subject || 'Chat Message',
                        productId: currentConversation.productId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Clear input
                    textarea.value = '';
                    textarea.style.height = 'auto';

                    // Add message to UI immediately
                    addMessageToUI({
                        sender: currentUser.email,
                        content: content,
                        timestamp: new Date(),
                        read: false
                    });

                    // Update conversation list
                    currentConversation.lastMessage = content;
                    currentConversation.lastTimestamp = new Date();
                    displayConversations();

                    showToast('Message sent successfully', 'success');
                } else {
                    showToast('Failed to send message: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Failed to send message', 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = originalContent;
            }
        }

        // Add Message to UI
        function addMessageToUI(message) {
            const messagesContainer = document.getElementById('chatMessages');
            
            // Remove empty state if it exists
            const emptyState = messagesContainer.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const isSent = message.sender === currentUser.email;
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isSent ? 'sent' : 'received'}`;
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    ${message.content}
                </div>
                <div class="message-info">
                    <span class="message-time">${formatTime(message.timestamp)}</span>
                    ${isSent ? `<span class="message-status pending">Sent</span>` : ''}
                </div>
            `;

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Mark Conversation as Read
        async function markConversationAsRead(conversationId) {
            try {
                await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/read/${conversationId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userEmail: currentUser.email
                    })
                });

                // Update local conversation
                const conv = conversations.find(c => c.id === conversationId);
                if (conv) {
                    conv.messages.forEach(msg => {
                        if (msg.receiver === currentUser.email) {
                            msg.read = true;
                        }
                    });
                }

                updateMessageBadge();
            } catch (error) {
                console.error('Error marking conversation as read:', error);
            }
        }

        // Start Message Refresh
        function startMessageRefresh() {
            if (messageRefreshInterval) {
                clearInterval(messageRefreshInterval);
            }

            messageRefreshInterval = setInterval(async () => {
                if (currentConversation) {
                    try {
                        const response = await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/conversation/${currentUser.email}/${currentConversation.participants.find(p => p.email !== currentUser.email).email}`);
                        const result = await response.json();

                        if (result.success && result.conversation) {
                            currentConversation = result.conversation;
                            loadMessages();
                        }
                    } catch (error) {
                        console.error('Error refreshing messages:', error);
                    }
                }
            }, 5000);
        }

        // Stop Message Refresh
        function stopMessageRefresh() {
            if (messageRefreshInterval) {
                clearInterval(messageRefreshInterval);
                messageRefreshInterval = null;
            }
        }

        // Update Message Badge
        async function updateMessageBadge() {
            try {
                const response = await fetch(`https://my-backend-1-jk7w.onrender.com/api/messages/unread/${currentUser.email}`);
                const result = await response.json();

                if (result.success) {
                    const badge = document.getElementById('messageBadge');
                    if (result.unreadCount > 0) {
                        badge.textContent = result.unreadCount > 99 ? '99+' : result.unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error updating message badge:', error);
            }
        }

        // Utility Functions
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            
            return date.toLocaleDateString();
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showConversationsList() {
            document.getElementById('conversationsList').classList.add('mobile-show');
            document.getElementById('chatArea').classList.remove('mobile-show');
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopMessageRefresh();
        });
    </script>
</body>
</html>
